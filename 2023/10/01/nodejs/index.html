<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>NodeJS | 虾壳</title><meta name="author" content="虾壳"><meta name="copyright" content="虾壳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="视频：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1gM411W7ex 官网：https:&#x2F;&#x2F;nodejs.org  一、NodeJS概述 Node.js是一种javascript运行时环境,它允许js脚本运行在服务器端非浏览器环境。 Node.js主要特征:  非阻塞和事件驱动型的IO模型，避免了同步阻塞带来的性能问题。 基于Chrome V8引擎，js运行速度快，被视为">
<meta property="og:type" content="article">
<meta property="og:title" content="NodeJS">
<meta property="og:url" content="http://yagote.github.io/2023/10/01/nodejs/index.html">
<meta property="og:site_name" content="虾壳">
<meta property="og:description" content="视频：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1gM411W7ex 官网：https:&#x2F;&#x2F;nodejs.org  一、NodeJS概述 Node.js是一种javascript运行时环境,它允许js脚本运行在服务器端非浏览器环境。 Node.js主要特征:  非阻塞和事件驱动型的IO模型，避免了同步阻塞带来的性能问题。 基于Chrome V8引擎，js运行速度快，被视为">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yagote.github.io/img/favicon.png">
<meta property="article:published_time" content="2023-10-01T10:32:21.000Z">
<meta property="article:modified_time" content="2023-10-01T11:32:04.870Z">
<meta property="article:author" content="虾壳">
<meta property="article:tag" content="教程">
<meta property="article:tag" content="NodeJS">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yagote.github.io/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yagote.github.io/2023/10/01/nodejs/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'NodeJS',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-10-01 19:32:04'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">37</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">38</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="虾壳"><span class="site-name">虾壳</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">NodeJS</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-10-01T10:32:21.000Z" title="发表于 2023-10-01 18:32:21">2023-10-01</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-10-01T11:32:04.870Z" title="更新于 2023-10-01 19:32:04">2023-10-01</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/">前端</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E5%89%8D%E7%AB%AF/%E5%89%8D%E7%AB%AF%E6%95%99%E7%A8%8B/">前端教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">22.2k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>96分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="NodeJS"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><blockquote>
<p>视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1gM411W7ex">https://www.bilibili.com/video/BV1gM411W7ex</a></p>
<p>官网：<a target="_blank" rel="noopener" href="https://nodejs.org/">https://nodejs.org</a></p>
</blockquote>
<h2 id="一、NodeJS概述"><a href="#一、NodeJS概述" class="headerlink" title="一、NodeJS概述"></a>一、NodeJS概述</h2><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842553.png" alt="image-20230901103902820"></p>
<p>Node.js是一种javascript运行时环境,它允许js脚本运行在服务器端非浏览器环境。</p>
<p>Node.js主要特征:</p>
<ul>
<li>非阻塞和事件驱动型的IO模型，避免了同步阻塞带来的性能问题。</li>
<li>基于Chrome V8引擎，js运行速度快，被视为前端语言的扩展。</li>
<li>包生态丰富，Node.js包管理器npm是世界上最大的软件注册库。</li>
<li>事件驱动架构使得Node非常适合有大量并发连接的real-time web应用。</li>
<li>Node.js允许在服务器端使用同样的js语法进行开发,降低了开发难度。</li>
</ul>
<p>常见应用:</p>
<ul>
<li>Web服务器：http模块用于开发web服务器,如Express。</li>
<li>API服务器：restful api服务。</li>
<li>实时通信：聊天室,在线音频/视频应用。</li>
<li>系统工具：内容管理,自动化任务。</li>
<li>IOT应用：连接设备,传感器。</li>
<li>轻量应用：electron等技术打包桌面应用。</li>
</ul>
<h2 id="二、Buffer"><a href="#二、Buffer" class="headerlink" title="二、Buffer"></a>二、Buffer</h2><h3 id="1、概念"><a href="#1、概念" class="headerlink" title="1、概念"></a>1、概念</h3><p>Buffer 是一个类似于数组的 对象 ，用于表示固定长度的字节序列。Buffer 本质是一段内存空间，专门用来处理 二进制数据 。</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842554.png" alt="image-20230901104815004"></p>
<h3 id="2、特点"><a href="#2、特点" class="headerlink" title="2、特点"></a>2、特点</h3><ol>
<li>Buffer 大小固定且无法调整 </li>
<li>Buffer 性能较好，可以直接对计算机内存进行操作</li>
<li>每个元素的大小为 1 字节（byte）</li>
</ol>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842555.png" alt="image-20230901104756491"></p>
<h3 id="3、使用"><a href="#3、使用" class="headerlink" title="3、使用"></a>3、使用</h3><h4 id="3-1-创建Buffer"><a href="#3-1-创建Buffer" class="headerlink" title="3.1 创建Buffer"></a>3.1 创建Buffer</h4><p>Node.js 中创建 Buffer 的方式主要如下几种：</p>
<ol>
<li><p>Buffer.alloc</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建了一个长度为 10 字节的 Buffer，相当于申请了 10 字节的内存空间，每个字节的值为 0</span></span><br><span class="line"><span class="keyword">let</span> buf = Buffer.alloc(<span class="number">10</span>);</span><br><span class="line"><span class="built_in">console</span>.log(buf);</span><br></pre></td></tr></table></figure>

<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Buffer<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Buffer.allocUnsafe</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建了一个长度为 10 字节的 Buffer，buffer 中可能存在旧的数据, 可能会影响执行结果，所以叫unsafe</span></span><br><span class="line"><span class="keyword">let</span> buf_2 = Buffer.allocUnsafe(<span class="number">10</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Buffer<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00<span class="number"> 00 </span>00&gt;</span><br></pre></td></tr></table></figure></li>
<li><p>Buffer.from</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//通过字符串创建 Buffer</span></span><br><span class="line"><span class="keyword">let</span> buf_3 = Buffer.from(<span class="string">&#x27;Hello&#x27;</span>);</span><br><span class="line"><span class="comment">//通过数组创建 Buffer</span></span><br><span class="line"><span class="keyword">let</span> buf_4 = Buffer.from([<span class="number">105</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">121</span>, <span class="number">111</span>, <span class="number">117</span>]);</span><br></pre></td></tr></table></figure>

<figure class="highlight tap"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Buffer<span class="number"> 48 </span>65 6c 6c 6f&gt;</span><br><span class="line">&lt;Buffer<span class="number"> 69 </span>6c 6f<span class="number"> 76 </span>65<span class="number"> 79 </span>6f 75&gt;</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-2-Buffer-与字符串的转化"><a href="#3-2-Buffer-与字符串的转化" class="headerlink" title="3.2 Buffer 与字符串的转化"></a>3.2 Buffer 与字符串的转化</h4><p>借助 toString 方法将 Buffer 转为字符串，toString 默认是按照 utf-8 编码方式进行转换的。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> buf_4 = Buffer.from([<span class="number">105</span>, <span class="number">108</span>, <span class="number">111</span>, <span class="number">118</span>, <span class="number">101</span>, <span class="number">121</span>, <span class="number">111</span>, <span class="number">117</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(buf_4.toString());<span class="comment">// utf-8</span></span><br></pre></td></tr></table></figure>

<h4 id="3-3-Buffer-的读写"><a href="#3-3-Buffer-的读写" class="headerlink" title="3.3 Buffer 的读写"></a>3.3 Buffer 的读写</h4><p>Buffer 可以直接通过 <code>[]</code>的方式对数据进行处理。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//读取</span></span><br><span class="line"><span class="built_in">console</span>.log(buf_3[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">//修改</span></span><br><span class="line">buf_3[<span class="number">1</span>] = <span class="number">97</span>;</span><br><span class="line"><span class="comment">//查看字符串结果</span></span><br><span class="line"><span class="built_in">console</span>.log(buf_3.toString());</span><br></pre></td></tr></table></figure>

<h4 id="3-4-溢出"><a href="#3-4-溢出" class="headerlink" title="3.4 溢出"></a>3.4 溢出</h4><p>如果修改的数值超过 255 ，则超过 8 位数据会被舍弃；</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 溢出</span></span><br><span class="line"><span class="keyword">let</span> buf = Buffer.from(<span class="string">&#x27;hello&#x27;</span>);</span><br><span class="line">buf[<span class="number">0</span>] = <span class="number">361</span>;<span class="comment">// 舍弃高位的数字  0001 0110 1001  =&gt; 0110 1001</span></span><br><span class="line"><span class="built_in">console</span>.log(buf);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight llvm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;Buffer <span class="number">69</span> <span class="number">65</span> <span class="number">6</span><span class="keyword">c</span> <span class="number">6</span><span class="keyword">c</span> <span class="number">6</span>f&gt;</span><br></pre></td></tr></table></figure>

<h4 id="3-5-中文"><a href="#3-5-中文" class="headerlink" title="3.5 中文"></a>3.5 中文</h4><p>一个 utf-8 的中文字符 一般 占 3 个字节。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> buf = Buffer.from(<span class="string">&#x27;你好&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(buf);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight mipsasm"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;<span class="keyword">Buffer </span>e4 <span class="keyword">bd </span><span class="built_in">a0</span> e5 <span class="built_in">a5</span> <span class="keyword">bd&gt;</span></span><br></pre></td></tr></table></figure>



<h2 id="三、fs模块"><a href="#三、fs模块" class="headerlink" title="三、fs模块"></a>三、fs模块</h2><h3 id="1、介绍"><a href="#1、介绍" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>fs 全称为 file system ，称之为 文件系统 ，是 Node.js 中的 内置模块 ，可以对计算机中的磁盘进行操作。</p>
<h3 id="2、文件写入"><a href="#2、文件写入" class="headerlink" title="2、文件写入"></a>2、文件写入</h3><p>文件写入就是将 数据 保存到 文件 中，可以使用如下几个方法来实现该效果：</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842556.png" alt="image-20230901112248596"></p>
<h4 id="2-1-writeFile-异步写入"><a href="#2-1-writeFile-异步写入" class="headerlink" title="2.1 writeFile 异步写入"></a>2.1 writeFile 异步写入</h4><p>语法： <code>fs.writeFile(file, data[, options], callback)</code></p>
<p>参数说明：</p>
<ul>
<li><p>file 文件名</p>
</li>
<li><p>data 待写入的数据</p>
</li>
<li><p>options 选项设置 （可选）</p>
</li>
<li><p>callback 写入回调</p>
</li>
</ul>
<p>返回值： undefined</p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// require 是 Node.js 环境中的&#x27;全局&#x27;变量，用来导入模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">//将 『三人行，必有我师焉。』 写入到当前文件夹下的『座右铭.txt』文件中</span></span><br><span class="line">fs.writeFile(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="string">&#x27;三人行，必有我师焉。&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">//如果写入失败，则回调函数调用时，会传入错误对象，如写入成功，会传入 null</span></span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;写入成功&#x27;</span>)；</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="2-2-writeFileSync-同步写入"><a href="#2-2-writeFileSync-同步写入" class="headerlink" title="2.2  writeFileSync 同步写入"></a>2.2  writeFileSync 同步写入</h4><p>语法：fs.writeFileSync(file, data[, options])`<br>参数与 fs.writeFile 大体一致，只是没有 callback 参数<br>返回值：undefined</p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	fs.writeFileSync(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="string">&#x27;三人行，必有我师焉。&#x27;</span>);</span><br><span class="line">&#125;<span class="keyword">catch</span>(e)&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Node.js 中的磁盘操作是由其他 <strong>线程</strong> 完成的，结果的处理有两种模式：</p>
<p>同步处理：JavaScript 主线程 <strong>会等待</strong> 其他线程的执行结果，然后再继续执行主线程的代码，<strong>效率较低</strong></p>
<p>异步处理：JavaScript 主线程 <strong>不会等待</strong> 其他线程的执行结果，直接执行后续的主线程代码，<strong>效率较好</strong></p>
</blockquote>
<h4 id="2-3-appendFile-appendFileSync-追加写入"><a href="#2-3-appendFile-appendFileSync-追加写入" class="headerlink" title="2.3  appendFile / appendFileSync 追加写入"></a>2.3  appendFile / appendFileSync 追加写入</h4><p>appendFile 作用是在文件尾部追加内容，appendFile 语法与 writeFile 语法完全相同<br>语法:<br><code>fs.appendFile(file, data[, options], callback)</code><br><code>fs.appendFileSync(file, data[, options])</code><br>返回值： 二者都为 <code>undefined</code><br>实例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">fs.appendFile(<span class="string">&#x27;./座右铭.txt&#x27;</span>,<span class="string">&#x27;择其善者而从之，其不善者而改之。&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">&#x27;追加成功&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line">fs.appendFileSync(<span class="string">&#x27;./座右铭.txt&#x27;</span>,<span class="string">&#x27;\r\n温故而知新, 可以为师矣&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="2-4-createWriteStream-流式写入"><a href="#2-4-createWriteStream-流式写入" class="headerlink" title="2.4 createWriteStream 流式写入"></a>2.4 createWriteStream 流式写入</h4><p>语法： <code>fs.createWriteStream(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件路径</li>
<li>options 选项配置（ 可选 ）</li>
</ul>
<p>返回值： <code>Object</code></p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> ws = fs.createWriteStream(<span class="string">&#x27;./观书有感.txt&#x27;</span>);</span><br><span class="line">ws.write(<span class="string">&#x27;半亩方塘一鉴开\r\n&#x27;</span>);</span><br><span class="line">ws.write(<span class="string">&#x27;天光云影共徘徊\r\n&#x27;</span>);</span><br><span class="line">ws.write(<span class="string">&#x27;问渠那得清如许\r\n&#x27;</span>);</span><br><span class="line">ws.write(<span class="string">&#x27;为有源头活水来\r\n&#x27;</span>);</span><br><span class="line">ws.end();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>程序打开一个文件是需要消耗资源的 ，流式写入可以减少打开关闭文件的次数。<br>流式写入方式适用于 <code>大文件写入或者频繁写入</code> 的场景, writeFile 适合于 <code>写入频率较低的场景</code></p>
</blockquote>
<h4 id="2-5-写入文件的场景"><a href="#2-5-写入文件的场景" class="headerlink" title="2.5 写入文件的场景"></a>2.5 写入文件的场景</h4><p>文件写入 在计算机中是一个非常常见的操作，下面的场景都用到了文件写入<br>下载文件<br>安装软件<br>保存程序日志，如 Git<br>编辑器保存文件<br>视频录制</p>
<blockquote>
<p>当 需要持久化保存数据 的时候，应该想到 文件写入</p>
</blockquote>
<h3 id="3、文件读取"><a href="#3、文件读取" class="headerlink" title="3、文件读取"></a>3、文件读取</h3><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842557.png" alt="image-20230901142516037"></p>
<h4 id="3-1-readFile-异步读取"><a href="#3-1-readFile-异步读取" class="headerlink" title="3.1 readFile 异步读取"></a>3.1 readFile 异步读取</h4><p>语法： <code>fs.readFile(path[, options], callback)</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件路径</li>
<li>options 选项配置</li>
<li>callback 回调函数</li>
</ul>
<p>返回值： <code>undefined</code></p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.readFile(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line">fs.readFile(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>,<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-2-readFileSync-同步读取"><a href="#3-2-readFileSync-同步读取" class="headerlink" title="3.2 readFileSync 同步读取"></a>3.2 readFileSync 同步读取</h4><p>语法： <code>fs.readFileSync(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件路径</li>
<li>options 选项配置</li>
</ul>
<p>返回值： string | Buffer</p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> data = fs.readFileSync(<span class="string">&#x27;./座右铭.txt&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> data2 = fs.readFileSync(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="string">&#x27;utf-8&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h4 id="3-3-createReadStream-流式读取"><a href="#3-3-createReadStream-流式读取" class="headerlink" title="3.3 createReadStream 流式读取"></a>3.3 createReadStream 流式读取</h4><p>语法： <code>fs.createReadStream(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li><p>path 文件路径</p>
</li>
<li><p>options 选项配置（ 可选 ）</p>
</li>
</ul>
<p>返回值： <code>Object</code></p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//创建读取流对象</span></span><br><span class="line"><span class="keyword">let</span> rs = fs.createReadStream(<span class="string">&#x27;./观书有感.txt&#x27;</span>);</span><br><span class="line"><span class="comment">//每次取出 64k 数据后执行一次 data 回调</span></span><br><span class="line">rs.on(<span class="string">&#x27;data&#x27;</span>, <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="built_in">console</span>.log(data.length);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//读取完毕后, 执行 end 回调</span></span><br><span class="line">rs.on(<span class="string">&#x27;end&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;读取完成&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-4-读取文件应用场景"><a href="#3-4-读取文件应用场景" class="headerlink" title="3.4 读取文件应用场景"></a>3.4 读取文件应用场景</h4><p>电脑开机<br>程序运行<br>编辑器打开文件<br>查看图片<br>播放视频<br>播放音乐<br>Git 查看日志<br>上传文件<br>查看聊天记录</p>
<h3 id="4、文件移动与重命名"><a href="#4、文件移动与重命名" class="headerlink" title="4、文件移动与重命名"></a>4、文件移动与重命名</h3><p>在 Node.js 中，可以使用 <code>rename</code> 或 <code>renameSync</code> 来移动或重命名 文件或文件夹</p>
<p>语法：<br><code>fs.rename(oldPath, newPath, callback)</code><br><code>fs.renameSync(oldPath, newPath)</code></p>
<p>参数说明：</p>
<ul>
<li><p>oldPath 文件当前的路径</p>
</li>
<li><p>newPath 文件新的路径</p>
</li>
<li><p>callback 操作后的回调</p>
</li>
</ul>
<p>文件重命名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.rename(<span class="string">&#x27;./座右铭.txt&#x27;</span>, <span class="string">&#x27;./论语.txt&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;操作失败~&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>文件移动</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line">fs.rename(<span class="string">&#x27;./data.txt&#x27;</span>, <span class="string">&#x27;../资料/data.txt&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;操作失败~&#x27;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;操作成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="5、文件删除"><a href="#5、文件删除" class="headerlink" title="5、文件删除"></a>5、文件删除</h3><p>在 Node.js 中，可以使用 <code>unlink</code>或 <code>unlinkSync</code> 来删除文件</p>
<p>语法：<br><code>fs.unlink(path, callback)</code><br><code>fs.unlinkSync(path)</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件路径</li>
<li>callback 操作后的回调</li>
</ul>
<p>方法1：调用 unlink 方法 </p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.unlink(<span class="string">&#x27;./观书有感.txt&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;删除失败~&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>方法2：调用<code>unlinkSync</code> 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.unlinkSync(<span class="string">&#x27;./test2.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>方法3：调用 rm 方法</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">fs.rm(<span class="string">&#x27;./论语.txt&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span> (err) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;删除失败~&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<h3 id="6、文件夹操作"><a href="#6、文件夹操作" class="headerlink" title="6、文件夹操作"></a>6、文件夹操作</h3><p>可以对文件夹进 <code>创建、读取、删除</code>等操作</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842558.png" alt="image-20230901144518834"></p>
<h4 id="6-1-mkdir-创建文件夹"><a href="#6-1-mkdir-创建文件夹" class="headerlink" title="6.1 mkdir 创建文件夹"></a>6.1 mkdir 创建文件夹</h4><p>使用 <code>mkdir</code> 或 <code>mkdirSync</code> 来创建文件夹</p>
<p>语法：<br><code>fs.mkdir(path[, options], callback)</code><br><code>fs.mkdirSync(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件夹路径</li>
<li>options 选项配置（ 可选 ）</li>
<li>callback 操作后的回调</li>
</ul>
<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步创建文件夹</span></span><br><span class="line">fs.mkdir(<span class="string">&#x27;./page&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;创建成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//递归异步创建</span></span><br><span class="line">fs.mkdir(<span class="string">&#x27;./1/2/3&#x27;</span>, &#123;<span class="attr">recursive</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;递归创建成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//递归同步创建文件夹</span></span><br><span class="line">fs.mkdirSync(<span class="string">&#x27;./x/y/z&#x27;</span>, &#123;<span class="attr">recursive</span>: <span class="literal">true</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="6-2-readdir-读取文件夹"><a href="#6-2-readdir-读取文件夹" class="headerlink" title="6.2 readdir 读取文件夹"></a>6.2 readdir 读取文件夹</h4><p>在 Node.js 中，我们可以使用 readdir 或 readdirSync 来读取文件夹</p>
<p>语法：</p>
<p><code>fs.readdir(path[, options], callback)</code><br><code>fs.readdirSync(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件夹路径</li>
<li>options 选项配置（ 可选 ）</li>
<li>callback 操作后的回调</li>
</ul>
<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步读取</span></span><br><span class="line">fs.readdir(<span class="string">&#x27;./论语&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//同步读取</span></span><br><span class="line"><span class="keyword">let</span> data = fs.readdirSync(<span class="string">&#x27;./论语&#x27;</span>);</span><br><span class="line"><span class="built_in">console</span>.log(data);</span><br></pre></td></tr></table></figure>

<h4 id="6-3-rmdir-删除文件夹"><a href="#6-3-rmdir-删除文件夹" class="headerlink" title="6.3 rmdir 删除文件夹"></a>6.3 rmdir 删除文件夹</h4><p>在 Node.js 中，我们可以使用 rmdir 或 rmdirSync 来删除文件夹</p>
<p>语法：</p>
<p><code>fs.rmdir(path[, options], callback)</code><br><code>fs.rmdirSync(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件夹路径</li>
<li>options 选项配置（ 可选 ）</li>
<li>callback 操作后的回调</li>
</ul>
<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步删除文件夹</span></span><br><span class="line">fs.rmdir(<span class="string">&#x27;./page&#x27;</span>, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//异步递归删除文件夹</span></span><br><span class="line">fs.rmdir(<span class="string">&#x27;./1&#x27;</span>, &#123;<span class="attr">recursive</span>: <span class="literal">true</span>&#125;, <span class="function"><span class="params">err</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;递归删除&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//同步递归删除文件夹</span></span><br><span class="line">fs.rmdirSync(<span class="string">&#x27;./x&#x27;</span>, &#123;<span class="attr">recursive</span>: <span class="literal">true</span>&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="7、查看资源状态"><a href="#7、查看资源状态" class="headerlink" title="7、查看资源状态"></a>7、查看资源状态</h3><p>在 Node.js 中，我们可以使用 stat 或 statSync 来查看资源的详细信息</p>
<p>语法：</p>
<p><code>fs.stat(path[, options], callback)</code><br><code>fs.statSync(path[, options])</code></p>
<p>参数说明：</p>
<ul>
<li>path 文件夹路径</li>
<li>options 选项配置（ 可选 ）</li>
<li>callback 操作后的回调</li>
</ul>
<p>示例代码：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//异步获取状态</span></span><br><span class="line">fs.stat(<span class="string">&#x27;./data.txt&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//同步获取状态</span></span><br><span class="line"><span class="keyword">let</span> data = fs.statSync(<span class="string">&#x27;./data.txt&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>结果值对象结构：</p>
<ul>
<li>size 文件体积</li>
<li>birthtime 创建时间</li>
<li>mtime 最后修改时间</li>
<li>isFile 检测是否为文件</li>
<li>isDirectory 检测是否为文件夹</li>
<li>….</li>
</ul>
<h3 id="8、两种路径"><a href="#8、两种路径" class="headerlink" title="8、两种路径"></a>8、两种路径</h3><p>fs 模块对资源进行操作时，路径的写法有两种：</p>
<ul>
<li><p>相对路径</p>
<ul>
<li><code>./座右铭.txt</code> 当前目录下的座右铭.txt</li>
<li><code>座右铭.txt</code> 等效于上面的写法</li>
<li><code>../座右铭.txt</code> 当前目录的上一级目录中的座右铭.txt</li>
</ul>
</li>
<li><p>绝对路径</p>
<ul>
<li><code>D:/Program Files</code> windows 系统下的绝对路径</li>
<li><code>/usr/bin</code> Linux 系统下的绝对路径</li>
</ul>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//相对路径</span></span><br><span class="line">fs.appendFileSync (<span class="string">&#x27;./相对路径-1.txt&#x27;</span>, <span class="string">&#x27;相对路径-1&#x27;</span>);</span><br><span class="line">fs.appendFileSync (<span class="string">&#x27;相对路径-2.txt&#x27;</span>, <span class="string">&#x27;相对路径-2&#x27;</span>);</span><br><span class="line">fs.appendFileSync (<span class="string">&#x27;../相对路径-3.txt&#x27;</span>, <span class="string">&#x27;相对路径-3&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//绝对路径</span></span><br><span class="line">fs.appendFileSync(<span class="string">&#x27;D:/绝对路径-1.txt&#x27;</span>, <span class="string">&#x27;绝对路径-1&#x27;</span>);</span><br><span class="line">fs.appendFileSync (<span class="string">&#x27;绝对路径-2.txt&#x27;</span>, <span class="string">&#x27;绝对路径-2&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>相对路径中所谓的 <code>当前目录</code> ，指的是 <code>命令行的工作目录</code> ，而并非是文件的所在目录</p>
</blockquote>
<h3 id="9、-dirname"><a href="#9、-dirname" class="headerlink" title="9、__dirname"></a>9、__dirname</h3><p><code>__dirname</code> 与 <code>require</code> 类似，都是 Node.js 环境中的’全局’变量</p>
<p><code>__dirname</code> 保存着 <code>当前文件所在目录的绝对路径</code> ，可以使用 __dirname 与文件名拼接成绝对路径</p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 相对路径参照物: 命令行的工作目录,所以下面两个路径是一样的</span></span><br><span class="line">fs.writeFileSync(<span class="string">&#x27;./相对路径参照物-1.txt&#x27;</span>, <span class="string">&#x27;相对路径参照物-1&#x27;</span>);</span><br><span class="line">fs.writeFileSync(<span class="string">&#x27;相对路径参照物-2.txt&#x27;</span>, <span class="string">&#x27;相对路径参照物-2&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//绝对路径 &#x27;全局变量&#x27; 保存的是: 所在文件的所在目录的绝对路径（以后路径推荐这种方法）</span></span><br><span class="line"><span class="built_in">console</span>.log(__dirname);</span><br><span class="line">fs.writeFileSync(__dirname + <span class="string">&#x27;/路径拼接.txt&#x27;</span>, <span class="string">&#x27;路径拼接&#x27;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用 fs 模块的时候，尽量使用 __dirname 将路径转化为绝对路径，这样可以避免相对路径产生的Bug</p>
</blockquote>
<h3 id="10、练习"><a href="#10、练习" class="headerlink" title="10、练习"></a>10、练习</h3><ol>
<li><p>编写一个 JS 文件，实现复制文件的功能</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> process = <span class="built_in">require</span>(<span class="string">&#x27;process&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//方式一 readFile</span></span><br><span class="line"><span class="comment">//读取文件内容</span></span><br><span class="line"><span class="comment">// let data = fs.readFileSync(&#x27;../资料/笑看风云.mp4&#x27;);</span></span><br><span class="line"><span class="comment">// //写入文件</span></span><br><span class="line"><span class="comment">// fs.writeFileSync(&#x27;../资料/笑看风云-2.mp4&#x27;, data);</span></span><br><span class="line"><span class="comment">// console.log(process.memoryUsage()); // rss    110710784 字节   105MB</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//方式二 流式操作</span></span><br><span class="line"><span class="comment">//创建读取流对象</span></span><br><span class="line"><span class="keyword">const</span> rs = fs.createReadStream(<span class="string">&#x27;../资料/笑看风云.mp4&#x27;</span>);</span><br><span class="line"><span class="comment">//创建写入流对象</span></span><br><span class="line"><span class="keyword">const</span> ws = fs.createWriteStream(<span class="string">&#x27;../资料/笑看风云-3.mp4&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//绑定 data 事件</span></span><br><span class="line"><span class="comment">// rs.on(&#x27;data&#x27;, chunk =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   ws.write(chunk);</span></span><br><span class="line"><span class="comment">// &#125;);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// rs.on(&#x27;end&#x27;, () =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   console.log(process.memoryUsage());  // 43106304   =&gt;  41M</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">rs.pipe(ws);</span><br></pre></td></tr></table></figure></li>
<li><p>文件重命名</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 fs 模块</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//读取 13-练习-文件重命名 文件夹</span></span><br><span class="line"><span class="keyword">const</span> files = fs.readdirSync(<span class="string">&#x27;./13-练习-文件重命名&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//遍历数组</span></span><br><span class="line">files.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//拆分文件名</span></span><br><span class="line">    <span class="keyword">let</span> data = item.split(<span class="string">&#x27;-&#x27;</span>);</span><br><span class="line">    <span class="keyword">let</span> [num, name] = data;</span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(<span class="built_in">Number</span>(num) &lt; <span class="number">10</span>)&#123;</span><br><span class="line">        num = <span class="string">&#x27;0&#x27;</span> + num;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//创建新的文件名</span></span><br><span class="line">    <span class="keyword">let</span> newName = num + <span class="string">&#x27;-&#x27;</span> + name;</span><br><span class="line">    <span class="comment">//重命名</span></span><br><span class="line">    fs.renameSync(<span class="string">`./13-练习-文件重命名/<span class="subst">$&#123;item&#125;</span>`</span>, <span class="string">`./13-练习-文件重命名/重命名后的文件/<span class="subst">$&#123;newName&#125;</span>`</span>);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li>
</ol>
<h2 id="四、path模块"><a href="#四、path模块" class="headerlink" title="四、path模块"></a>四、path模块</h2><p>path 模块提供了 操作路径 的功能，我们将介绍如下几个较为常用的几个 API：</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842559.png" alt="image-20230901150044590"></p>
<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">//获取路径分隔符</span></span><br><span class="line"><span class="built_in">console</span>.log(path.sep);</span><br><span class="line"><span class="comment">//拼接绝对路径</span></span><br><span class="line"><span class="built_in">console</span>.log(path.resolve(__dirname, <span class="string">&#x27;test&#x27;</span>));	<span class="comment">// D:\MyITData\WebStorm\NodejsStu\03-path模块\lowdb操作演示</span></span><br><span class="line"><span class="built_in">console</span>.log(path.resolve(__dirname, <span class="string">&#x27;/path.txt&#x27;</span>, <span class="string">&#x27;./lowdb操作演示&#x27;</span>));	<span class="comment">// D:\path.txt\lowdb操作演示</span></span><br><span class="line"><span class="comment">//解析路径</span></span><br><span class="line"><span class="keyword">let</span> pathname = <span class="string">&#x27;D:/program file/nodejs/node.exe&#x27;</span>;</span><br><span class="line"><span class="built_in">console</span>.log(path.parse(pathname));</span><br><span class="line"><span class="comment">//获取路径基础名称</span></span><br><span class="line"><span class="built_in">console</span>.log(path.basename(pathname))</span><br><span class="line"><span class="comment">//获取路径的目录名</span></span><br><span class="line"><span class="built_in">console</span>.log(path.dirname(pathname));</span><br><span class="line"><span class="comment">//获取路径的扩展名</span></span><br><span class="line"><span class="built_in">console</span>.log(path.extname(pathname));</span><br></pre></td></tr></table></figure>



<h2 id="五、http模块"><a href="#五、http模块" class="headerlink" title="五、http模块"></a>五、http模块</h2><h3 id="1、HTTP协议"><a href="#1、HTTP协议" class="headerlink" title="1、HTTP协议"></a>1、HTTP协议</h3><h4 id="1-1-概念"><a href="#1-1-概念" class="headerlink" title="1.1 概念"></a>1.1 概念</h4><p>HTTP（hypertext transport protocol）协议；中文叫<strong>超文本传输协议</strong>，是一种基于TCP/IP的应用层通信协议，这个协议详细规定了 浏览器 和万维网 服务器 之间互相通信的规则。协议中主要规定了两个方面的内容：<br>客户端：用来向服务器发送数据，可以被称之为<strong>请求报文</strong><br>服务端：向客户端返回数据，可以被称之为<strong>响应报文</strong></p>
<p>请求报文的组成：请求行、请求头、空行、请求体</p>
<h4 id="1-2-HTTP-的请求行"><a href="#1-2-HTTP-的请求行" class="headerlink" title="1.2 HTTP 的请求行"></a>1.2 HTTP 的请求行</h4><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842560.png" alt="image-20230901151350452"></p>
<h4 id="1-3-HTTP-请求头"><a href="#1-3-HTTP-请求头" class="headerlink" title="1.3 HTTP 请求头"></a>1.3 HTTP 请求头</h4><p>格式：『头名：头值』<br>常见的请求头有：</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842561.png" alt="image-20230901151511251"></p>
<h4 id="1-4-HTTP-的请求体"><a href="#1-4-HTTP-的请求体" class="headerlink" title="1.4 HTTP 的请求体"></a>1.4 HTTP 的请求体</h4><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842562.png" alt="image-20230901151553769"></p>
<h4 id="1-5-响应报文的组成"><a href="#1-5-响应报文的组成" class="headerlink" title="1.5 响应报文的组成"></a>1.5 响应报文的组成</h4><ul>
<li><p>响应行</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">HTTP</span>/<span class="number">1</span>.<span class="number">1</span> <span class="number">200</span> OK</span><br></pre></td></tr></table></figure>

<ul>
<li><p>HTTP/1.1：HTTP协议版本号</p>
</li>
<li><p>200：响应状态码 404 Not Found 500 Internal Server Error，还有一些状态码，参考：<a target="_blank" rel="noopener" href="https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status">https://developer.mozilla.org/zh-CN/docs/Web/HTTP/Status</a></p>
</li>
<li><p>OK：响应状态描述</p>
<blockquote>
<p>响应状态码和响应字符串关系是一一对应的。</p>
</blockquote>
</li>
</ul>
</li>
<li><p>响应头</p>
<figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="section">Cache-Control:缓存控制 private 私有的，只允许客户端缓存数据</span></span><br><span class="line">Connection 链接设置</span><br><span class="line"><span class="section">Content-Type:text/html;charset=utf-8 设置响应体的数据类型以及字符集,响应体为html，字符集utf-8</span></span><br><span class="line"><span class="section">Content-Length:响应体的长度，单位为字节</span></span><br></pre></td></tr></table></figure></li>
<li><p>空行</p>
</li>
<li><p>响应体</p>
<p>响应体内容的类型是非常灵活的，常见的类型有 HTML、CSS、JS、图片、JSON</p>
</li>
</ul>
<h4 id="1-6-浏览器查看HTTP报文"><a href="#1-6-浏览器查看HTTP报文" class="headerlink" title="1.6 浏览器查看HTTP报文"></a>1.6 浏览器查看HTTP报文</h4><p>网络–标头–请求标头–查看解析结果</p>
<h3 id="2、创建-HTTP-服务"><a href="#2、创建-HTTP-服务" class="headerlink" title="2、创建 HTTP 服务"></a>2、创建 HTTP 服务</h3><h4 id="2-1-操作步骤"><a href="#2-1-操作步骤" class="headerlink" title="2.1 操作步骤"></a>2.1 操作步骤</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 http 模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"><span class="comment">//2. 创建服务对象 create 创建 server 服务</span></span><br><span class="line"><span class="comment">// request 意为请求. 是对请求报文的封装对象, 通过 request 对象可以获得请求报文的数据</span></span><br><span class="line"><span class="comment">// response 意为响应. 是对响应报文的封装对象, 通过 response 对象可以设置响应报文</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    response.end(<span class="string">&#x27;Hello HTTP server&#x27;</span>);	<span class="comment">//设置响应体</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//3. 监听端口, 启动服务</span></span><br><span class="line">server.listen(<span class="number">9000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口 9000 监听中...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><code>http.createServer</code> 里的回调函数的执行时机： 当接收到 HTTP 请求的时候，就会执行</p>
<h4 id="2-2-测试"><a href="#2-2-测试" class="headerlink" title="2.2 测试"></a>2.2 测试</h4><p>浏览器请求对应端口</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">http:<span class="regexp">//</span><span class="number">127.0</span>.<span class="number">0.1</span>:<span class="number">9000</span></span><br></pre></td></tr></table></figure>

<h4 id="2-3-注意事项"><a href="#2-3-注意事项" class="headerlink" title="2.3 注意事项"></a>2.3 注意事项</h4><ul>
<li>命令行 ctrl + c 停止服务</li>
<li>当服务启动后，更新代码 必须重启服务才能生效</li>
<li>响应内容中文乱码的解决办法</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">response.setHeader(<span class="string">&#x27;content-type&#x27;</span>,<span class="string">&#x27;text/html;charset=utf-8&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>端口号被占用</p>
<figure class="highlight subunit"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">Error: </span>listen EADDRINUSE: address already in use :::9000</span><br></pre></td></tr></table></figure>

<p>1）关闭当前正在运行监听端口的服务 （ 使用较多 ）</p>
<p>2）修改其他端口号</p>
</li>
<li><p>HTTP 协议默认端口是 80 。HTTPS 协议的默认端口是 443, HTTP 服务开发常用端口有 3000，8080，8090，9000 等</p>
</li>
</ul>
<blockquote>
<p>如果端口被其他程序占用，可以使用 资源监视器 找到占用端口的程序，然后使用 任务管理器 关闭对应的程序</p>
</blockquote>
<h3 id="3、获取-HTTP-请求报文"><a href="#3、获取-HTTP-请求报文" class="headerlink" title="3、获取 HTTP 请求报文"></a>3、获取 HTTP 请求报文</h3><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842563.png" alt="image-20230901152615288"></p>
<p>注意事项：</p>
<ol>
<li>request.url 只能获取路径以及查询字符串，无法获取 URL 中的域名以及协议的内容</li>
<li>request.headers 将请求信息转化成一个对象，并将属性名都转化成了『小写』</li>
<li>关于路径：如果访问网站的时候，只填写了 IP 地址或者是域名信息，此时请求的路径为『 / 』</li>
<li>关于 favicon.ico：这个请求是属于浏览器自动发送的请求</li>
</ol>
<p>代码示例：按照以下要求搭建 HTTP 服务</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842564.png" alt="image-20230901152717977"></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1、引入http模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&quot;http&quot;</span>);</span><br><span class="line"><span class="comment">//2、建立服务</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">let</span> &#123;url,method&#125; = request; <span class="comment">//对象的解构赋值</span></span><br><span class="line"><span class="comment">//设置响应头信息</span></span><br><span class="line"><span class="comment">//解决中文乱码</span></span><br><span class="line">    response.setHeader(<span class="string">&quot;Content-Type&quot;</span>,<span class="string">&quot;text/html;charset=utf-8&quot;</span>)</span><br><span class="line">    <span class="keyword">if</span>(url == <span class="string">&quot;/register&quot;</span> &amp;&amp; method == <span class="string">&quot;GET&quot;</span>)&#123;</span><br><span class="line">        response.end(<span class="string">&quot;注册页面&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(url==<span class="string">&quot;/login&quot;</span> &amp;&amp; method == <span class="string">&quot;GET&quot;</span>)&#123;</span><br><span class="line">        response.end(<span class="string">&quot;登录页面&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        response.end(<span class="string">&quot;&lt;h1&gt;404 Not Found&lt;/h1&gt;&quot;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//3、监听端口</span></span><br><span class="line">server.listen(<span class="number">8000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务启动中....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="4、设置-HTTP-响应报文"><a href="#4、设置-HTTP-响应报文" class="headerlink" title="4、设置 HTTP 响应报文"></a>4、设置 HTTP 响应报文</h3><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842565.png" alt="image-20230901152847207"></p>
<p>write 和 end 的两种使用情况：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. write 和 end 的结合使用 响应体相对分散</span></span><br><span class="line">response.write(<span class="string">&#x27;xx&#x27;</span>);</span><br><span class="line">response.write(<span class="string">&#x27;xx&#x27;</span>);</span><br><span class="line">response.write(<span class="string">&#x27;xx&#x27;</span>);</span><br><span class="line">response.end(); <span class="comment">//每一个请求，在处理的时候必须要执行 end 方法的</span></span><br><span class="line"><span class="comment">//2. 单独使用 end 方法 响应体相对集中</span></span><br><span class="line">response.end(<span class="string">&#x27;xxx&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>练习：搭建 HTTP 服务，响应一个 4 行 3 列的表格，并且要求表格有 隔行换色效果 ，且 点击 单元格能 高亮显示</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 http 模块</span></span><br><span class="line"><span class="keyword">const</span> http = <span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建服务对象</span></span><br><span class="line"><span class="keyword">const</span> server = http.createServer(<span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    response.end(<span class="string">`</span></span><br><span class="line"><span class="string">    &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">    &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;head&gt;</span></span><br><span class="line"><span class="string">      &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">      &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">      &lt;style&gt;</span></span><br><span class="line"><span class="string">        td&#123;</span></span><br><span class="line"><span class="string">          padding: 20px 40px;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        table tr:nth-child(odd)&#123;</span></span><br><span class="line"><span class="string">          background: #aef;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        table tr:nth-child(even)&#123;</span></span><br><span class="line"><span class="string">          background: #fcb;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">        table, td&#123;</span></span><br><span class="line"><span class="string">          border-collapse: collapse;</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &lt;/style&gt;</span></span><br><span class="line"><span class="string">    &lt;/head&gt;</span></span><br><span class="line"><span class="string">    &lt;body&gt;</span></span><br><span class="line"><span class="string">      &lt;table border=&quot;1&quot;&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span></span><br><span class="line"><span class="string">        &lt;tr&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;</span></span><br><span class="line"><span class="string">      &lt;/table&gt;</span></span><br><span class="line"><span class="string">      &lt;script&gt;</span></span><br><span class="line"><span class="string">        //获取所有的 td</span></span><br><span class="line"><span class="string">        let tds = document.querySelectorAll(&#x27;td&#x27;);</span></span><br><span class="line"><span class="string">        //遍历</span></span><br><span class="line"><span class="string">        tds.forEach(item =&gt; &#123;</span></span><br><span class="line"><span class="string">          item.onclick = function()&#123;</span></span><br><span class="line"><span class="string">            this.style.background = &#x27;#222&#x27;;</span></span><br><span class="line"><span class="string">          &#125;</span></span><br><span class="line"><span class="string">        &#125;)</span></span><br><span class="line"><span class="string">      &lt;/script&gt;</span></span><br><span class="line"><span class="string">    &lt;/body&gt;</span></span><br><span class="line"><span class="string">    &lt;/html&gt;</span></span><br><span class="line"><span class="string">  `</span>); <span class="comment">//设置响应体</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口, 启动服务</span></span><br><span class="line">server.listen(<span class="number">9000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动....&#x27;</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842566.png" alt="image-20230902164546507"></p>
<h3 id="5、静态资源服务"><a href="#5、静态资源服务" class="headerlink" title="5、静态资源服务"></a>5、静态资源服务</h3><p>静态资源是指 内容长时间不发生改变的资源 ，例如图片，视频，CSS 文件，JS文件，HTML文件，字体文件等；动态资源是指 内容经常更新的资源 ，例如百度首页，网易首页，京东搜索列表页面等。</p>
<p>网站根目录或静态资源目录：HTTP 服务在哪个文件夹中寻找静态资源，那个文件夹就是 静态资源目录 ，也称之为 <strong>网站根目录</strong>。</p>
<h4 id="5-1-网页中的-URL"><a href="#5-1-网页中的-URL" class="headerlink" title="5.1 网页中的 URL"></a>5.1 网页中的 URL</h4><p>网页中的 URL 主要分为两大类：相对路径与绝对路径</p>
<h5 id="5-1-1-绝对路径"><a href="#5-1-1-绝对路径" class="headerlink" title="5.1.1 绝对路径"></a>5.1.1 绝对路径</h5><p>绝对路径可靠性强，而且相对容易理解，在项目中运用较多</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842567.png" alt="image-20230901153707899"></p>
<h5 id="5-1-2-相对路径"><a href="#5-1-2-相对路径" class="headerlink" title="5.1.2 相对路径"></a>5.1.2 相对路径</h5><p>相对路径在发送请求时，需要与当前页面 URL 路径进行 计算 ，得到完整 URL 后，再发送请求，学习阶段用的较多。例如当前网页 url 为 <a target="_blank" rel="noopener" href="http://www.atguigu.com/course/h5.html">http://www.atguigu.com/course/h5.html</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842568.png" alt="image-20230901153813972"></p>
<h5 id="5-1-3-网页中使用-URL-的场景小结"><a href="#5-1-3-网页中使用-URL-的场景小结" class="headerlink" title="5.1.3 网页中使用 URL 的场景小结"></a>5.1.3 网页中使用 URL 的场景小结</h5><p>包括但不限于如下场景：</p>
<ul>
<li>a 标签 href</li>
<li>link 标签 href</li>
<li>script 标签 src</li>
<li>img 标签 srcvideo audio 标签 src</li>
<li>form 中的 action</li>
<li>AJAX 请求中的 URL</li>
</ul>
<h4 id="5-2-设置资源类型（mime类型）"><a href="#5-2-设置资源类型（mime类型）" class="headerlink" title="5.2 设置资源类型（mime类型）"></a>5.2 设置资源类型（mime类型）</h4><p>媒体类型（通常称为 Multipurpose Internet Mail Extensions 或 MIME 类型 ）是一种标准，用来表示文档、文件或字节流的性质和格式。</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mime 类型结构： [<span class="built_in">type</span>]/[subType]</span><br><span class="line">例如： <span class="built_in">text</span>/html <span class="built_in">text</span>/css <span class="built_in">image</span>/jpeg <span class="built_in">image</span>/png application/json</span><br></pre></td></tr></table></figure>

<p>HTTP 服务可以设置响应头 Content-Type 来表明响应体的 MIME 类型，浏览器会根据该类型决定如何处理资源，下面是常见文件对应的 mime 类型</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">html: <span class="string">&#x27;text/html&#x27;</span>,</span><br><span class="line"><span class="attr">css</span>: <span class="string">&#x27;text/css&#x27;</span>,</span><br><span class="line"><span class="attr">js</span>: <span class="string">&#x27;text/javascript&#x27;</span>,</span><br><span class="line"><span class="attr">png</span>: <span class="string">&#x27;image/png&#x27;</span>,</span><br><span class="line"><span class="attr">jpg</span>: <span class="string">&#x27;image/jpeg&#x27;</span>,</span><br><span class="line"><span class="attr">gif</span>: <span class="string">&#x27;image/gif&#x27;</span>,</span><br><span class="line"><span class="attr">mp4</span>: <span class="string">&#x27;video/mp4&#x27;</span>,</span><br><span class="line"><span class="attr">mp3</span>: <span class="string">&#x27;audio/mpeg&#x27;</span>,</span><br><span class="line"><span class="attr">json</span>: <span class="string">&#x27;application/json&#x27;</span></span><br></pre></td></tr></table></figure>

<p>对于未知的资源类型，可以选择 <code>application/octet-stream</code> 类型，浏览器在遇到该类型的响应时，会对响应体内容进行独立存储，也就是我们常见的 <code>下载</code> 效果。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//获取请求的方法已经路径</span></span><br><span class="line">    <span class="keyword">let</span> &#123;url,method&#125; = request;</span><br><span class="line">	<span class="comment">//判断请求方式以及请求路径</span></span><br><span class="line">    <span class="keyword">if</span>(method == <span class="string">&quot;GET&quot;</span> &amp;&amp; url == <span class="string">&quot;/index.html&quot;</span>)&#123;</span><br><span class="line">		<span class="comment">//需要响应文件中的内容</span></span><br><span class="line">        <span class="keyword">let</span> data = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).readFileSync(__dirname + <span class="string">&#x27;/index.html&#x27;</span>);</span><br><span class="line">        response.end(data);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(method == <span class="string">&quot;GET&quot;</span> &amp;&amp; url == <span class="string">&quot;/css/app.css&quot;</span>)&#123;</span><br><span class="line">		<span class="comment">//需要响应文件中的内容</span></span><br><span class="line">        <span class="keyword">let</span> data = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).readFileSync(__dirname + <span class="string">&#x27;/public/css/app.css&#x27;</span>);</span><br><span class="line">        response.end(data);</span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>(method == <span class="string">&quot;GET&quot;</span> &amp;&amp; url == <span class="string">&quot;/js/app.js&quot;</span>)&#123;</span><br><span class="line">		<span class="comment">//需要响应文件中的内容</span></span><br><span class="line">        <span class="keyword">let</span> data = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>).readFileSync(__dirname + <span class="string">&#x27;/public/js/app.js&#x27;</span>);</span><br><span class="line">        response.end(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span>&#123;</span><br><span class="line">		<span class="comment">//404响应</span></span><br><span class="line">        response.statusCode = <span class="number">404</span>;</span><br><span class="line">        response.end(<span class="string">&quot;&lt;h1&gt;404 Not Found&lt;/h1&gt;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;).listen(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;80端口正在启动中....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>很明显上面的代码，当只要有一个请求路径就需要进行判断，显然这种方式不够完美，那么我们需要封装</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>(<span class="string">&#x27;http&#x27;</span>).createServer(<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//获取请求的方法已经路径</span></span><br><span class="line">    <span class="keyword">let</span> &#123;url,method&#125; = request;</span><br><span class="line">    <span class="comment">//文件夹路径</span></span><br><span class="line">    <span class="keyword">let</span> rootDir = __dirname + <span class="string">&#x27;/public&#x27;</span>;</span><br><span class="line">    <span class="comment">//拼接文件路径</span></span><br><span class="line">    <span class="keyword">let</span> filePath = rootDir + url;</span><br><span class="line">    <span class="comment">//读取文件内容</span></span><br><span class="line">    fs.readFile(filePath,<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">//判断</span></span><br><span class="line">        <span class="keyword">if</span>(err)&#123;</span><br><span class="line">            <span class="comment">//如果出现错误，响应404状态码</span></span><br><span class="line">            response.statusCode = <span class="number">404</span>;</span><br><span class="line">            response.end(<span class="string">&#x27;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="comment">//响应文件内容</span></span><br><span class="line">            response.end(data);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;).listen(<span class="number">80</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;80端口正在启动中....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-3-GET-和-POST-请求场景小结"><a href="#5-3-GET-和-POST-请求场景小结" class="headerlink" title="5.3  GET 和 POST 请求场景小结"></a>5.3  GET 和 POST 请求场景小结</h4><p>GET 请求的情况：</p>
<ul>
<li>在地址栏直接输入 url 访问</li>
<li>点击 a 链接</li>
<li>link 标签引入 css</li>
<li>script 标签引入 js</li>
<li>img 标签引入图片</li>
<li>form 标签中的 method 为 get （不区分大小写）</li>
<li>ajax 中的 get 请求</li>
</ul>
<p>POST 请求的情况：</p>
<ul>
<li>form 标签中的 method 为 post（不区分大小写）</li>
<li>AJAX 的 post 请求</li>
</ul>
<h3 id="6、GET和POST请求的区别"><a href="#6、GET和POST请求的区别" class="headerlink" title="6、GET和POST请求的区别"></a>6、GET和POST请求的区别</h3><p>GET 和 POST 是 HTTP 协议请求的两种方式。</p>
<ul>
<li>GET 主要用来获取数据，POST 主要用来提交数据</li>
<li>GET 带参数请求是将参数缀到 URL 之后，在地址栏中输入 url 访问网站就是 GET 请求，POST 带参数请求是将参数放到请求体中</li>
<li>POST 请求相对 GET 安全一些，因为在浏览器中参数会暴露在地址栏</li>
<li>GET 请求大小有限制，一般为 2K，而 POST 请求则没有大小限制</li>
</ul>
<h2 id="六、模块化"><a href="#六、模块化" class="headerlink" title="六、模块化"></a>六、模块化</h2><h3 id="1、介绍-1"><a href="#1、介绍-1" class="headerlink" title="1、介绍"></a>1、介绍</h3><h4 id="1-1-什么是模块化与模块"><a href="#1-1-什么是模块化与模块" class="headerlink" title="1.1 什么是模块化与模块 ?"></a>1.1 什么是模块化与模块 ?</h4><p>将一个复杂的程序文件依据一定规则（规范）拆分成多个文件的过程称之为 <strong>模块化</strong>。其中拆分出的 <strong>每个文件就是一个模块</strong> ，模块的内部数据是私有的，不过模块可以暴露内部数据以便其他模块使用。</p>
<h4 id="1-2-什么是模块化项目"><a href="#1-2-什么是模块化项目" class="headerlink" title="1.2 什么是模块化项目 ?"></a>1.2 什么是模块化项目 ?</h4><p>编码时是按照模块一个一个编码的， 整个项目就是一个模块化的项目。</p>
<h4 id="1-3-模块化好处"><a href="#1-3-模块化好处" class="headerlink" title="1.3 模块化好处"></a>1.3 模块化好处</h4><p>下面是模块化的一些好处：</p>
<ul>
<li>防止命名冲突</li>
<li>高复用性</li>
<li>高维护性</li>
</ul>
<h3 id="2、模块暴露数据"><a href="#2、模块暴露数据" class="headerlink" title="2、模块暴露数据"></a>2、模块暴露数据</h3><h4 id="2-1-模块初体验"><a href="#2-1-模块初体验" class="headerlink" title="2.1 模块初体验"></a>2.1 模块初体验</h4><p>创建 me.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//声明函数</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">tiemo</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;贴膜....&#x27;</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//暴露数据</span></span><br><span class="line"><span class="built_in">module</span>.exports = tiemo;</span><br></pre></td></tr></table></figure>

<p>创建 math.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入模块</span></span><br><span class="line"><span class="keyword">const</span> tiemo = <span class="built_in">require</span>(<span class="string">&#x27;./me.js&#x27;</span>);</span><br><span class="line"><span class="comment">//调用函数</span></span><br><span class="line">tiemo();</span><br></pre></td></tr></table></figure>

<h4 id="2-2-暴露数据"><a href="#2-2-暴露数据" class="headerlink" title="2.2 暴露数据"></a>2.2 暴露数据</h4><p>模块暴露数据的方式有两种：</p>
<ol>
<li>module.exports = value</li>
<li>exports.name = value</li>
</ol>
<blockquote>
<p>使用时有几点注意：</p>
<ul>
<li><p>module.exports 可以暴露 <code>任意</code> 数据</p>
</li>
<li><p>不能使用 <code>exports = value</code> 的形式暴露数据，模块内部 module 与 exports 的隐式关系<code>exports = module.exports = &#123;&#125;</code> ，require 返回的是目标模块中 <code>module.exports</code> 的值</p>
</li>
</ul>
</blockquote>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842569.png" alt="image-20230901155711874"></p>
<h3 id="3、导入（引入）模块"><a href="#3、导入（引入）模块" class="headerlink" title="3、导入（引入）模块"></a>3、导入（引入）模块</h3><p>【代码在：05-模块化/04_导入文件夹】</p>
<p>在模块中使用 require 传入文件路径即可引入文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> test = <span class="built_in">require</span>(<span class="string">&#x27;./me.js&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>require 使用的一些注意事项：</p>
<ol>
<li>对于自己创建的模块，导入时路径建议写 <code>相对路径</code> ，且不能省略<code> ./</code> 和 <code>../</code></li>
<li><code>js</code> 和 <code>json</code> 文件导入时可以不用写后缀，c/c++编写的 node 扩展文件也可以不写后缀，但是一般用不到</li>
<li>如果导入其他类型的文件，会以 <code>js</code> 文件进行处理。</li>
<li>如果导入的路径是个文件夹，则会 <code>首先</code> 检测该文件夹下 <code>package.json</code> 文件中 <code>main</code> 属性对应的文件，如果存在则导入，反之如果文件不存在会报错。如果 main 属性不存在，或者 package.json 不存在，则会尝试导入文件夹下的 <code>math.js</code> 和<code>index.json</code> ，如果还是没找到，就会报错。</li>
<li>导入 node.js 内置模块时，直接 require 模块的名字即可，无需加 <code>./</code> 和<code>../</code></li>
</ol>
<h3 id="4、导入模块的基本流程"><a href="#4、导入模块的基本流程" class="headerlink" title="4、导入模块的基本流程"></a>4、导入模块的基本流程</h3><p>这里我们介绍一下 <code>require</code> 导入 <code>自定义模块</code> 的基本流程</p>
<ol>
<li>将相对路径转为绝对路径，定位目标文件</li>
<li>缓存检测</li>
<li>读取目标文件代码</li>
<li>包裹为一个函数并执行（自执行函数）。通过 <code>arguments.callee.toString()</code> 查看自执行函数</li>
<li>缓存模块的值</li>
<li>返回 <code>module.exports</code> 的值</li>
</ol>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842570.png" alt="image-20230901160256310"></p>
<h3 id="5、CommonJS-规范"><a href="#5、CommonJS-规范" class="headerlink" title="5、CommonJS 规范"></a>5、CommonJS 规范</h3><p><code>module.exports</code> 、 <code>exports</code> 以及 <code>require</code> 这些都是 <code>CommonJS</code> 模块化规范中的内容。而 Node.js 是实现了 CommonJS 模块化规范，二者关系有点像 JavaScript 与 ECMAScript</p>
<h2 id="七、包管理工具"><a href="#七、包管理工具" class="headerlink" title="七、包管理工具"></a>七、包管理工具</h2><p>前端常用的包管理工具：npm、yarn、cnpm</p>
<h3 id="1、npm初始化"><a href="#1、npm初始化" class="headerlink" title="1、npm初始化"></a>1、npm初始化</h3><p>创建一个空目录，然后以此目录作为工作目录<code> 启动命令行工具</code> ，执行 <code>npm init</code></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842571.png" alt="image-20230901161235949"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842572.png" alt="image-20230901160951139"></p>
<p>npm init 命令的作用是将文件夹初始化为一个『包』， 交互式创建 <code>package.json</code> 文件，package.json 内容示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;npm-lowdb操作演示&quot;</span>, #包的名字</span><br><span class="line">    <span class="attr">&quot;version&quot;</span>: <span class="string">&quot;1.0.0&quot;</span>, #包的版本</span><br><span class="line">    <span class="attr">&quot;description&quot;</span>: <span class="string">&quot;&quot;</span>, #包的描述</span><br><span class="line">    <span class="attr">&quot;main&quot;</span>: <span class="string">&quot;math.js&quot;</span>, #包的入口文件</span><br><span class="line">    <span class="attr">&quot;scripts&quot;</span>: &#123; #脚本配置</span><br><span class="line">        <span class="attr">&quot;test&quot;</span>: <span class="string">&quot;echo \&quot;Error: no lowdb操作演示 specified\&quot; &amp;&amp; exit 1&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;author&quot;</span>: <span class="string">&quot;&quot;</span>, #作者</span><br><span class="line">    <span class="attr">&quot;license&quot;</span>: <span class="string">&quot;ISC&quot;</span> #开源证书</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>初始化的过程中还有一些注意事项：</p>
<ol>
<li>package name ( 包名 ) 不能使用中文、大写，默认值是 文件夹的名称 ，所以文件夹名称也不能使用中文和大写。</li>
<li>version ( 版本号 )要求 x.x.x 的形式定义， x 必须是数字，默认值是 1.0.0</li>
<li>ISC 证书与 MIT 证书功能上是相同的，关于开源证书扩展阅读<a target="_blank" rel="noopener" href="http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html">http://www.ruanyifeng.com/blog/2011/05/how_to_choose_free_software_licenses.html</a></li>
<li>package.json 可以手动创建与修改</li>
<li>使用 <code>npm init -y</code> 或者 <code>npm init --yes</code> 极速创建 package.json</li>
</ol>
<h3 id="2、npm搜索包"><a href="#2、npm搜索包" class="headerlink" title="2、npm搜索包"></a>2、npm搜索包</h3><p>搜索包的方式有两种：</p>
<ol>
<li>命令行 『npm s/search 关键字』</li>
<li>网站搜索 网址是 <a target="_blank" rel="noopener" href="https://www.npmjs.com/">https://www.npmjs.com/</a></li>
</ol>
<p>可以通过 <code>npm install 包名</code> 和 <code>npm i 包名</code> 命令安装包，运行之后文件夹下会增加两个资源：<code>node_modules</code> 文件夹 存放下载的包，<code>package-lock.json</code> 包的锁文件 ，用来锁定包的版本。</p>
<h3 id="3、开发依赖与生产依赖"><a href="#3、开发依赖与生产依赖" class="headerlink" title="3、开发依赖与生产依赖"></a>3、开发依赖与生产依赖</h3><p>可以在安装时设置选项来区分 依赖的类型 ，目前分为两类：</p>
<p>开发：npm i -D 包名</p>
<p>生产：npm i -S 包名</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842573.png" alt="image-20230901162822406"></p>
<h3 id="4、全局安装"><a href="#4、全局安装" class="headerlink" title="4、全局安装"></a>4、全局安装</h3><p>可以执行安装选项 -g 进行全局安装</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i -g nodemon</span><br></pre></td></tr></table></figure>

<p>全局安装完成之后就可以在命令行的任何位置运行 <code>nodemon</code> 命令，该命令的作用是 <code>自动重启 node 应用程序</code></p>
<blockquote>
<p>说明：</p>
<ul>
<li><p>全局安装的命令不受工作目录位置影响</p>
</li>
<li><p>可以通过 <code>npm root -g</code> 可以查看全局安装包的位置</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842574.png" alt="image-20230901163131953"></p>
</li>
<li><p><strong>不是所有的包都适合全局安装</strong> ， 只有全局类的工具才适合，可以通过 查看包的官方文档来确定<br>安装方式 </p>
</li>
<li><p>windows 下查找命令的所在位置</p>
<ul>
<li>cmd 命令行 中执行 <code>where nodemon</code></li>
<li>powershell命令行 执行 <code>get-command nodemon</code></li>
</ul>
</li>
</ul>
</blockquote>
<h3 id="5、npm安装指定版本的包"><a href="#5、npm安装指定版本的包" class="headerlink" title="5、npm安装指定版本的包"></a>5、npm安装指定版本的包</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 格式</span></span></span><br><span class="line">npm i &lt;包名@版本号&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 示例</span></span></span><br><span class="line">npm i jquery@1.11.2</span><br></pre></td></tr></table></figure>

<h3 id="6、删除依赖"><a href="#6、删除依赖" class="headerlink" title="6、删除依赖"></a>6、删除依赖</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 局部删除</span></span></span><br><span class="line">npm remove uniq</span><br><span class="line">npm r uniq</span><br><span class="line"><span class="meta">#</span><span class="bash"><span class="comment"># 全局删除</span></span></span><br><span class="line">npm remove -g nodemon</span><br></pre></td></tr></table></figure>

<h3 id="7、配置命令别名"><a href="#7、配置命令别名" class="headerlink" title="7、配置命令别名"></a>7、配置命令别名</h3><p>通过配置命令别名可以更简单的执行命令，配置 package.json 中的 scripts 属性</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">  <span class="attr">&quot;scripts&quot;</span>: &#123;</span><br><span class="line">	<span class="attr">&quot;server&quot;</span>: <span class="string">&quot;node server.js&quot;</span>,</span><br><span class="line">	<span class="attr">&quot;start&quot;</span>: <span class="string">&quot;node math.js&quot;</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  .</span><br><span class="line">  .</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置完成之后，可以使用别名执行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm run server</span><br><span class="line">npm run start</span><br></pre></td></tr></table></figure>

<p>不过 start 别名比较特别，使用时可以省略 run</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm start</span><br></pre></td></tr></table></figure>

<blockquote>
<p>补充说明：</p>
<ul>
<li>npm start 是项目中常用的一个命令，一般用来启动项目</li>
<li>npm run 有自动向上级目录查找的特性，跟 require 函数也一样</li>
<li>对于陌生的项目，可以通过查看 scripts 属性来参考项目的一些操作</li>
</ul>
</blockquote>
<h3 id="8、cnpm"><a href="#8、cnpm" class="headerlink" title="8、cnpm"></a>8、cnpm</h3><p>cnpm 是一个淘宝构建的 npmjs.com 的完整镜像，也称为淘宝镜像，网址 <a target="_blank" rel="noopener" href="https://npmmirror.com/">https://npmmirror.com/</a> </p>
<p>cnpm 服务部署在国内 阿里云服务器上 ， 可以提高包的下载速度，官方也提供了一个<strong>全局工具包 cnpm</strong> ，操作命令与 npm 大体相同。</p>
<p>安装cnpm 工具</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install -g cnpm --registry=https://registry.npmmirror.com</span><br></pre></td></tr></table></figure>

<p>操作命令</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842576.png" alt="image-20230901164131116"></p>
<h3 id="9、配置淘宝镜像"><a href="#9、配置淘宝镜像" class="headerlink" title="9、配置淘宝镜像"></a>9、配置淘宝镜像</h3><ul>
<li>直接配置</li>
</ul>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm config set registry https://registry.npmmirror.com/</span><br></pre></td></tr></table></figure>

<ul>
<li><p>工具配置（推荐）</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">npm i -g nrm	# 安装 nrm</span><br><span class="line">nrm use taobao	# 修改镜像</span><br><span class="line">npm config list		# 检查是否配置成功（选做）</span><br></pre></td></tr></table></figure>

<p>检查 registry 地址是否为 <a target="_blank" rel="noopener" href="https://registry.npmmirror.com/">https://registry.npmmirror.com/</a> , 如果 是 则表明成功。</p>
</li>
</ul>
<h3 id="10、yarn介绍"><a href="#10、yarn介绍" class="headerlink" title="10、yarn介绍"></a>10、yarn介绍</h3><p>yarn 是由 Facebook 在 2016 年推出的新的 Javascript 包管理工具，官方网址：<a target="_blank" rel="noopener" href="https://yarnpkg.com/">https://yarnpkg.com/</a></p>
<p>（1）安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g yarn</span><br></pre></td></tr></table></figure>

<p>（2）yarn常用命令</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842577.png" alt="image-20230901165132780"></p>
<p>yarn 全局安装包的位置可以通过 yarn global bin来查看。</p>
<p>（3）yarn 配置淘宝镜像</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn config set registry https://registry.npmmirror.com/</span><br></pre></td></tr></table></figure>

<p>可以通过 yarn config list 查看 yarn 的配置项</p>
<blockquote>
<p>包管理工具 不要混着用，切记，切记，切记</p>
</blockquote>
<h3 id="11、npm管理发布包"><a href="#11、npm管理发布包" class="headerlink" title="11、npm管理发布包"></a>11、npm管理发布包</h3><h4 id="11-1-创建与发布"><a href="#11-1-创建与发布" class="headerlink" title="11.1 创建与发布"></a>11.1 创建与发布</h4><p>我们可以将自己开发的工具包发布到 npm 服务上，方便自己和其他开发者使用，操作步骤如下：</p>
<ol>
<li>创建文件夹，并创建文件 math.js， 在文件中声明函数，使用 module.exports 暴露</li>
<li>npm 初始化工具包，package.json 填写包的信息 (包的名字是唯一的)</li>
<li>注册账号 <a target="_blank" rel="noopener" href="https://www.npmjs.com/signup">https://www.npmjs.com/signup</a></li>
<li>激活账号 （ 一定要激活账号 ）</li>
<li>修改为官方的官方镜像 (命令行中运行 nrm use npm )</li>
<li>命令行下 npm login 填写相关用户信息</li>
<li>命令行下 npm publish 提交包</li>
</ol>
<h4 id="11-2-更新包"><a href="#11-2-更新包" class="headerlink" title="11.2 更新包"></a>11.2 更新包</h4><p>后续可以对自己发布的包进行更新，操作步骤如下</p>
<ol>
<li><p>更新包中的代码</p>
</li>
<li><p>测试代码是否可用</p>
</li>
<li><p>修改 package.json 中的版本号</p>
</li>
<li><p>发布更新</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm publish</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="11-3-删除包"><a href="#11-3-删除包" class="headerlink" title="11.3 删除包"></a>11.3 删除包</h4><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm unpublish --force</span><br></pre></td></tr></table></figure>

<blockquote>
<p>删除包需要满足一定的条件，<a target="_blank" rel="noopener" href="https://docs.npmjs.com/policies/unpublish">https://docs.npmjs.com/policies/unpublish</a></p>
<ul>
<li>你是包的作者</li>
<li>发布小于 24 小时</li>
<li>大于 24 小时后，没有其他包依赖，并且每周小于 300 下载量，并且只有一个维护者</li>
</ul>
</blockquote>
<h3 id="12、nvm"><a href="#12、nvm" class="headerlink" title="12、nvm"></a>12、nvm</h3><p>nvm 全称 Node Version Manager，用来管理node的版本。</p>
<p>下载地址 <a target="_blank" rel="noopener" href="https://github.com/coreybutler/nvm-windows/releases%EF%BC%8C%E9%80%89%E6%8B%A9">https://github.com/coreybutler/nvm-windows/releases，选择</a> nvm-setup.exe 下载即可。</p>
<p>常用命令</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842578.png" alt="image-20230901170203352"></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842579.png" alt="image-20230902185825271" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842580.png" alt="image-20230902185905537"></p>
<h2 id="八、express框架"><a href="#八、express框架" class="headerlink" title="八、express框架"></a>八、express框架</h2><h3 id="1、介绍-2"><a href="#1、介绍-2" class="headerlink" title="1、介绍"></a>1、介绍</h3><p>express 是一个基于 Node.js 平台的极简、灵活的 WEB 应用开发框架，官方网址：<a target="_blank" rel="noopener" href="https://www.expressjs.com.cn/">https://www.expressjs.com.cn/</a><br>简单来说，express 是一个封装好的工具包，封装了很多功能，便于我们开发 WEB 应用（HTTP 服务）</p>
<h3 id="2、测试使用"><a href="#2、测试使用" class="headerlink" title="2、测试使用"></a>2、测试使用</h3><p>安装</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm init</span><br><span class="line">npm i express</span><br></pre></td></tr></table></figure>

<p>创建 JS 文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//2. 创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//3. 创建路由规则</span></span><br><span class="line">app.get(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.end(<span class="string">&#x27;hello express server&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4. 监听端口 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口监听为 3000...&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p> 命令行下执行该脚本</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">node &lt;文件名&gt;</span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">nodemon &lt;文件名&gt;</span><br></pre></td></tr></table></figure>

<p>然后在浏览器就可以访问 <a target="_blank" rel="noopener" href="http://127.0.0.1:3000/home">http://127.0.0.1:3000/home</a></p>
<h3 id="3、express路由"><a href="#3、express路由" class="headerlink" title="3、express路由"></a>3、express路由</h3><h4 id="3-1-路由的使用"><a href="#3-1-路由的使用" class="headerlink" title="3.1 路由的使用"></a>3.1 路由的使用</h4><p>一个路由的组成有 <code>请求方法</code> ， <code>路径</code> 和 <code>回调函数</code> 组成。express 中提供了一系列方法，可以很方便的使用路由，使用格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.&lt;method&gt;(path，callback)</span><br></pre></td></tr></table></figure>

<p>代码示例：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//创建 get 路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;网站首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//首页路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req,res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;我才是真正的首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//创建 post 路由</span></span><br><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;登录成功&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//匹配所有的请求方法</span></span><br><span class="line">app.all(<span class="string">&#x27;/search&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;1 秒钟为您找到相关结果约 100,000,000 个&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//自定义 404 路由</span></span><br><span class="line">app.all(<span class="string">&quot;*&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#x27;</span>)</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//监听端口 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口监听为 3000&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-2-获取请求参数"><a href="#3-2-获取请求参数" class="headerlink" title="3.2 获取请求参数"></a>3.2 获取请求参数</h4><p>express 框架封装了一些 API 来方便获取请求报文中的数据，并且兼容原生 HTTP 模块的获取方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//获取请求的路由规则</span></span><br><span class="line">app.get(<span class="string">&#x27;/request&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">//1. 获取报文的方式与原生 HTTP 获取方式是兼容的</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.method);</span><br><span class="line">    <span class="built_in">console</span>.log(req.url);</span><br><span class="line">    <span class="built_in">console</span>.log(req.httpVersion);</span><br><span class="line">    <span class="built_in">console</span>.log(req.headers);</span><br><span class="line">	<span class="comment">//2. express 独有的获取报文的方式</span></span><br><span class="line">	<span class="comment">//获取查询字符串</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.query); <span class="comment">// 『相对重要』</span></span><br><span class="line">	<span class="comment">// 获取指定的请求头</span></span><br><span class="line">    <span class="built_in">console</span>.log(req.get(<span class="string">&#x27;host&#x27;</span>));</span><br><span class="line">    res.send(<span class="string">&#x27;请求报文的获取&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;启动成功....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="3-3-获取路由参数"><a href="#3-3-获取路由参数" class="headerlink" title="3.3 获取路由参数"></a>3.3 获取路由参数</h4><p>路由参数指的是 <code>URL 路径中的参数（数据）</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/:id.html&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;商品详情, 商品 id 为&#x27;</span> + req.params.id);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="3-4-路由参数练习"><a href="#3-4-路由参数练习" class="headerlink" title="3.4 路由参数练习"></a>3.4 路由参数练习</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//导入 json 文件</span></span><br><span class="line"><span class="keyword">const</span> &#123;singers&#125; = <span class="built_in">require</span>(<span class="string">&#x27;./singers.json&#x27;</span>);</span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/singer/:id.html&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取路由参数</span></span><br><span class="line">  <span class="keyword">let</span> &#123;id&#125; = req.params;</span><br><span class="line">  <span class="comment">//在数组中寻找对应 id 的数据</span></span><br><span class="line">  <span class="keyword">let</span> result = singers.find(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(item.id === <span class="built_in">Number</span>(id))&#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//判断</span></span><br><span class="line">  <span class="keyword">if</span>(!result)&#123;</span><br><span class="line">    res.statusCode = <span class="number">404</span>;</span><br><span class="line">    res.end(<span class="string">`&lt;h1&gt;404 Not Found&lt;/h1&gt;`</span>)</span><br><span class="line">    <span class="keyword">return</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  res.end(<span class="string">`</span></span><br><span class="line"><span class="string">  &lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="string">  &lt;html lang=&quot;en&quot;&gt;</span></span><br><span class="line"><span class="string">  &lt;head&gt;</span></span><br><span class="line"><span class="string">    &lt;meta charset=&quot;UTF-8&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta http-equiv=&quot;X-UA-Compatible&quot; content=&quot;IE=edge&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;meta name=&quot;viewport&quot; content=&quot;width=device-width, initial-scale=1.0&quot;&gt;</span></span><br><span class="line"><span class="string">    &lt;title&gt;Document&lt;/title&gt;</span></span><br><span class="line"><span class="string">  &lt;/head&gt;</span></span><br><span class="line"><span class="string">  &lt;body&gt;</span></span><br><span class="line"><span class="string">    &lt;h2&gt;<span class="subst">$&#123;result.singer_name&#125;</span>&lt;/h2&gt;</span></span><br><span class="line"><span class="string">    &lt;img src=&#x27;<span class="subst">$&#123;result.singer_pic&#125;</span>&#x27; /&gt;</span></span><br><span class="line"><span class="string">  &lt;/body&gt;</span></span><br><span class="line"><span class="string">  &lt;/html&gt;`</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口, 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口 3000 正在监听中....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<p><a target="_blank" rel="noopener" href="http://localhost:3000/singer/1.html">http://localhost:3000/singer/1.html</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842581.png" alt="image-20230902224348325"></p>
<h3 id="4、express-响应设置"><a href="#4、express-响应设置" class="headerlink" title="4、express 响应设置"></a>4、express 响应设置</h3><p>express 框架封装了一些 API 来方便给客户端响应数据，并且兼容原生 HTTP 模块的获取方式</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//获取请求的路由规则</span></span><br><span class="line">app.get(<span class="string">&quot;/response&quot;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">	<span class="comment">//1. express 中设置响应的方式兼容 HTTP 模块的方式</span></span><br><span class="line">    res.statusCode = <span class="number">404</span>;</span><br><span class="line">    res.statusMessage = <span class="string">&#x27;xxx&#x27;</span>;</span><br><span class="line">    res.setHeader(<span class="string">&#x27;abc&#x27;</span>,<span class="string">&#x27;xyz&#x27;</span>);</span><br><span class="line">    res.write(<span class="string">&#x27;响应体&#x27;</span>);</span><br><span class="line">    res.end(<span class="string">&#x27;xxx&#x27;</span>);</span><br><span class="line">	<span class="comment">//2. express 的响应方法</span></span><br><span class="line">    res.status(<span class="number">500</span>); <span class="comment">//设置响应状态码</span></span><br><span class="line">    res.set(<span class="string">&#x27;xxx&#x27;</span>,<span class="string">&#x27;yyy&#x27;</span>);<span class="comment">//设置响应头</span></span><br><span class="line">    res.send(<span class="string">&#x27;中文响应不乱码&#x27;</span>);<span class="comment">//设置响应体</span></span><br><span class="line">	<span class="comment">//连贯操作</span></span><br><span class="line">    res.status(<span class="number">404</span>).set(<span class="string">&#x27;xxx&#x27;</span>,<span class="string">&#x27;yyy&#x27;</span>).send(<span class="string">&#x27;你好朋友&#x27;</span>)</span><br><span class="line">	<span class="comment">//3. 其他响应</span></span><br><span class="line">    res.redirect(<span class="string">&#x27;http://atguigu.com&#x27;</span>)<span class="comment">//重定向</span></span><br><span class="line">    res.download(<span class="string">&#x27;./package.json&#x27;</span>);<span class="comment">//下载响应</span></span><br><span class="line">    res.json();<span class="comment">//响应 JSON</span></span><br><span class="line">    res.sendFile(__dirname + <span class="string">&#x27;/home.html&#x27;</span>) <span class="comment">//响应文件内容</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="5、express中间件"><a href="#5、express中间件" class="headerlink" title="5、express中间件"></a>5、express中间件</h3><h4 id="5-1-介绍"><a href="#5-1-介绍" class="headerlink" title="5.1 介绍"></a>5.1 介绍</h4><p>中间件（Middleware）本质是一个回调函数，中间件函数 可以像路由回调一样访问 请求对象（request） ， 响应对象（response）。</p>
<p>中间件的作用：使用函数封装公共操作，简化代码。</p>
<p>中间件的类型：全局中间件、路由中间件。</p>
<h4 id="5-2-全局中间件"><a href="#5-2-全局中间件" class="headerlink" title="5.2 全局中间件"></a>5.2 全局中间件</h4><p>每一个请求 到达服务端之后 都会执行全局中间件函数，声明中间件函数：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> recordMiddleware = <span class="function"><span class="keyword">function</span>(<span class="params">request,response,next</span>)</span>&#123;</span><br><span class="line">    <span class="comment">//实现功能代码</span></span><br><span class="line">    <span class="comment">//.....</span></span><br><span class="line">    <span class="comment">//执行next函数(当如果希望执行完中间件函数之后，仍然继续执行路由中的回调函数，必须调用next)</span></span><br><span class="line">    next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842582.png" alt="image-20230901172014749"></p>
<p>应用中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(recordMiddleware);</span><br></pre></td></tr></table></figure>

<p>声明时可以直接将匿名函数传递给 <code>use</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">request, response, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;定义第一个中间件&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-3-多个全局中间件"><a href="#5-3-多个全局中间件" class="headerlink" title="5.3 多个全局中间件"></a>5.3 多个全局中间件</h4><p>express 允许使用 app.use() 定义多个全局中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">request, response, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;定义第一个中间件&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span> (<span class="params">request, response, next</span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;定义第二个中间件&#x27;</span>);</span><br><span class="line">    next();</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="5-4-路由中间件"><a href="#5-4-路由中间件" class="headerlink" title="5.4 路由中间件"></a>5.4 路由中间件</h4><p>如果<strong>只需要对某一些路由进行功能封装</strong>，则就需要路由中间件，调用格式如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">app.get(<span class="string">&#x27;/路径&#x27;</span>,<span class="string">`中间件函数`</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line">app.get(<span class="string">&#x27;/路径&#x27;</span>,<span class="string">`中间件函数1`</span>,<span class="string">`中间件函数2`</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="5-5-静态资源中间件"><a href="#5-5-静态资源中间件" class="headerlink" title="5.5 静态资源中间件"></a>5.5 静态资源中间件</h4><h5 id="5-5-1-基本使用"><a href="#5-5-1-基本使用" class="headerlink" title="5.5.1 基本使用"></a>5.5.1 基本使用</h5><p>express 内置处理静态资源的中间件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//引入express框架</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//创建服务对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//静态资源中间件的设置，将当前文件夹下的public目录作为网站的根目录</span></span><br><span class="line">app.use(express.static(<span class="string">&#x27;./public&#x27;</span>)); <span class="comment">//当然这个目录中都是一些静态资源</span></span><br><span class="line"><span class="comment">//如果访问的内容经常变化，还是需要设置路由</span></span><br><span class="line"><span class="comment">//但是，在这里有一个问题，如果public目录下有index.html文件，单独也有index.html的路由，</span></span><br><span class="line"><span class="comment">//则谁书写在前，优先执行谁</span></span><br><span class="line">app.get(<span class="string">&#x27;/index.html&#x27;</span>,<span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">    respsonse.send(<span class="string">&#x27;首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//监听端口</span></span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;3000 端口启动....&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意事项:</p>
<ol>
<li>index.html 文件为默认打开的资源</li>
<li>如果静态资源与路由规则同时匹配，谁先匹配谁就响应</li>
<li>路由响应动态资源，静态资源中间件响应静态资源</li>
</ol>
</blockquote>
<h5 id="5-5-2-案例练习"><a href="#5-5-2-案例练习" class="headerlink" title="5.5.2 案例练习"></a>5.5.2 案例练习</h5><p>局域网内可以访问<code>尚品汇</code>的网页</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置静态资源中间件</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/尚品汇&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口, 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口 3000 正在监听中....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842583.png" alt="image-20230902225824822"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842584.png" alt="image-20230902230023065"></p>
<h3 id="6、获取请求体数据"><a href="#6、获取请求体数据" class="headerlink" title="6、获取请求体数据"></a>6、获取请求体数据</h3><p>express 可以使用 <code>body-parser</code> 包处理请求体。</p>
<p>第一步：安装</p>
<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="selector-tag">i</span> <span class="selector-tag">body</span>-parser</span><br></pre></td></tr></table></figure>

<p>第二步：导入 body-parser 包</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> bodyParser = <span class="built_in">require</span>(<span class="string">&#x27;body-parser&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>第三步：获取中间件函数</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//处理 querystring 格式的请求体</span></span><br><span class="line"><span class="keyword">let</span> urlParser = bodyParser.urlencoded(&#123;<span class="attr">extended</span>:<span class="literal">false</span>&#125;);</span><br><span class="line"><span class="comment">//处理 JSON 格式的请求体</span></span><br><span class="line"><span class="keyword">let</span> jsonParser = bodyParser.json();</span><br></pre></td></tr></table></figure>

<p>第四步：设置路由中间件，然后使用 request.body 来获取请求体数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">app.post(<span class="string">&#x27;/login&#x27;</span>, urlParser, <span class="function">(<span class="params">request,response</span>)=&gt;</span>&#123;</span><br><span class="line">	<span class="comment">//获取请求体数据</span></span><br><span class="line">	<span class="comment">//console.log(request.body);</span></span><br><span class="line">	<span class="comment">//用户名</span></span><br><span class="line">    <span class="built_in">console</span>.log(request.body.username);</span><br><span class="line">	<span class="comment">//密码</span></span><br><span class="line">    <span class="built_in">console</span>.log(request.body.userpass);</span><br><span class="line">    response.send(<span class="string">&#x27;获取请求体数据&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>获取到的请求体数据：</p>
<figure class="highlight 1c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[Object: <span class="literal">null</span> prototype] &#123; username: &#x27;admin&#x27;, userpass: &#x27;<span class="number">123456</span>&#x27; &#125;</span><br></pre></td></tr></table></figure>



<h3 id="7、防盗链实践"><a href="#7、防盗链实践" class="headerlink" title="7、防盗链实践"></a>7、防盗链实践</h3><p>只允许设置的ip访问，禁止其它ip访问资源</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 10_静态资源中间件.js</span></span><br><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明中间件</span></span><br><span class="line">app.use(<span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//检测请求头中的 referer 是否为 127.0.0.1</span></span><br><span class="line">  <span class="comment">//获取 referer</span></span><br><span class="line">  <span class="keyword">let</span> referer = req.get(<span class="string">&#x27;referer&#x27;</span>);</span><br><span class="line">  <span class="keyword">if</span>(referer)&#123;</span><br><span class="line">    <span class="comment">//实例化</span></span><br><span class="line">    <span class="keyword">let</span> url = <span class="keyword">new</span> URL(referer);</span><br><span class="line">    <span class="comment">//获取 hostname</span></span><br><span class="line">    <span class="keyword">let</span> hostname = url.hostname;</span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(hostname !== <span class="string">&#x27;127.0.0.1&#x27;</span>)&#123;</span><br><span class="line">      <span class="comment">//响应 404 </span></span><br><span class="line">      res.status(<span class="number">404</span>).send(<span class="string">&#x27;&lt;h1&gt;404 Not Found&lt;/h1&gt;&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//静态资源中间件设置</span></span><br><span class="line">app.use(express.static(__dirname + <span class="string">&#x27;/public&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口, 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口 3000 正在监听中....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842585.png" alt="image-20230902230547017"></p>
<p>这里设置了允许ip为127.0.0.1的主机访问静态资源，<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/%E5%8F%AF%E4%BB%A5%E8%AE%BF%E9%97%AE%E8%B5%84%E6%BA%90">http://127.0.0.1:3000/可以访问资源</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842586.png" alt="image-20230902230405822"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/%E8%AE%BF%E9%97%AE%E4%B8%8D%E5%88%B0%E8%B5%84%E6%BA%90">http://localhost:3000/访问不到资源</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842587.png" alt="image-20230902230327473"></p>
<h3 id="8、路由模块化"><a href="#8、路由模块化" class="headerlink" title="8、路由模块化"></a>8、路由模块化</h3><p>express 中的 Router 是一个完整的中间件和路由系统，可以看做是一个小型的 app 对象。对路由进行模块化，更好的管理路由。</p>
<p>创建独立的 JS 文件（homeRouter.js、adminRouter.js）</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//2. 创建路由器对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"><span class="comment">//3. 在 router 对象身上添加路由</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;首页&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line">router.get(<span class="string">&#x27;/cart&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;购物车&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4. 暴露</span></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//2. 创建路由对象</span></span><br><span class="line"><span class="keyword">const</span> router = express.Router();</span><br><span class="line"></span><br><span class="line"><span class="comment">// router.use()</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//后台</span></span><br><span class="line">router.get(<span class="string">&#x27;/admin&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;后台首页&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//后台设置</span></span><br><span class="line">router.get(<span class="string">&#x27;/setting&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;设置页面&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>主文件</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//5.引入子路由文件</span></span><br><span class="line"><span class="keyword">const</span> homeRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/homeRouter&#x27;</span>);</span><br><span class="line"><span class="comment">//6.设置和使用中间件</span></span><br><span class="line">app.use(homeRouter);</span><br><span class="line">app.listen(<span class="number">3000</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;3000 端口启动....&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:3000/home">http://localhost:3000/home</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842588.png" alt="image-20230902230958002"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/admin">http://localhost:3000/admin</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842589.png" alt="image-20230902231016394"></p>
<h3 id="9、EJS模板引擎"><a href="#9、EJS模板引擎" class="headerlink" title="9、EJS模板引擎"></a>9、EJS模板引擎</h3><h4 id="9-1-EJS介绍"><a href="#9-1-EJS介绍" class="headerlink" title="9.1 EJS介绍"></a>9.1 EJS介绍</h4><p>模板引擎是分离 <strong>用户界面和业务数据</strong> 的一种技术。<br>EJS 是一个高效的 Javascript 的模板引擎，官网: <a target="_blank" rel="noopener" href="https://ejs.co/">https://ejs.co/</a> 中文站：<a target="_blank" rel="noopener" href="https://ejs.bootcss.com/">https://ejs.bootcss.com/</a></p>
<p>安装</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i ejs</span><br></pre></td></tr></table></figure>

<p>代码示例</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.引入ejs</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">//2.定义数据</span></span><br><span class="line"><span class="keyword">let</span> person = [<span class="string">&#x27;张三&#x27;</span>,<span class="string">&#x27;李四&#x27;</span>,<span class="string">&#x27;王二麻子&#x27;</span>];</span><br><span class="line"><span class="comment">//3.ejs解析模板返回结构</span></span><br><span class="line"><span class="comment">//&lt;%= %&gt; 是ejs解析内容的标记，作用是输出当前表达式的执行结构</span></span><br><span class="line"><span class="keyword">let</span> html = ejs.render(<span class="string">&#x27;&lt;%= person.join(&quot;,&quot;) %&gt;&#x27;</span>, &#123;<span class="attr">person</span>:person&#125;);</span><br><span class="line"><span class="comment">//4.输出结果</span></span><br><span class="line"><span class="built_in">console</span>.log(html);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">张三,李四,王二麻子</span><br></pre></td></tr></table></figure>



<blockquote>
<p>EJS常用语法：</p>
<p>执行JS代码</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;% code %&gt;</span><br></pre></td></tr></table></figure>

<p>输出转义的数据到模板上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%= code %&gt;</span><br></pre></td></tr></table></figure>

<p>输出非转义的数据到模板上</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;%- code %&gt;</span><br></pre></td></tr></table></figure>
</blockquote>
<h4 id="9-2-EJS列表渲染"><a href="#9-2-EJS列表渲染" class="headerlink" title="9.2 EJS列表渲染"></a>9.2 EJS列表渲染</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="comment">//西游记</span></span><br><span class="line"><span class="keyword">const</span> xiyou = [<span class="string">&#x27;唐僧&#x27;</span>,<span class="string">&#x27;孙悟空&#x27;</span>,<span class="string">&#x27;猪八戒&#x27;</span>,<span class="string">&#x27;沙僧&#x27;</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">//原生 JS</span></span><br><span class="line"><span class="comment">// let str = &#x27;&lt;ul&gt;&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// xiyou.forEach(item =&gt; &#123;</span></span><br><span class="line"><span class="comment">//   str += `&lt;li&gt;$&#123;item&#125;&lt;/li&gt;`;</span></span><br><span class="line"><span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// //闭合 ul</span></span><br><span class="line"><span class="comment">// str += &#x27;&lt;/ul&gt;&#x27;;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// console.log(str);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// EJS 实现</span></span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="keyword">let</span> html = fs.readFileSync(<span class="string">&#x27;./02_西游.html&#x27;</span>).toString();</span><br><span class="line"><span class="keyword">let</span> result = ejs.render(html, &#123;<span class="attr">xiyou</span>:xiyou&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>西游四人组<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>西游四人组<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    &lt;% xiyou.forEach(item =&gt; &#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>&lt;%= item %&gt;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    &lt;% &#125;) %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>西游四人组<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">h2</span>&gt;</span>西游四人组<span class="tag">&lt;/<span class="name">h2</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>唐僧<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>孙悟空<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>猪八戒<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">li</span>&gt;</span>沙僧<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="9-3-EJS条件渲染"><a href="#9-3-EJS条件渲染" class="headerlink" title="9.3 EJS条件渲染"></a>9.3 EJS条件渲染</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 通过 isLogin 决定最终的输出内容</span></span><br><span class="line"><span class="comment"> * true   输出『&lt;span&gt;欢迎回来&lt;/span&gt;』</span></span><br><span class="line"><span class="comment"> * false  输出『&lt;button&gt;登录&lt;/button&gt;  &lt;button&gt;注册&lt;/button&gt;』</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// 导入 ejs</span></span><br><span class="line"><span class="keyword">const</span> ejs = <span class="built_in">require</span>(<span class="string">&#x27;ejs&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> fs = <span class="built_in">require</span>(<span class="string">&#x27;fs&#x27;</span>);</span><br><span class="line"><span class="comment">//变量</span></span><br><span class="line"><span class="keyword">let</span> isLogin = <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//原生 JS</span></span><br><span class="line"><span class="comment">// if(isLogin)&#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;&lt;span&gt;欢迎回来&lt;/span&gt;&#x27;)</span></span><br><span class="line"><span class="comment">// &#125;else&#123;</span></span><br><span class="line"><span class="comment">//   console.log(&#x27;&lt;button&gt;登录&lt;/button&gt;  &lt;button&gt;注册&lt;/button&gt;&#x27;);</span></span><br><span class="line"><span class="comment">// &#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//EJS 实现</span></span><br><span class="line"><span class="comment">//读取 HTML 内容</span></span><br><span class="line"><span class="keyword">let</span> html = fs.readFileSync(<span class="string">&#x27;./03_home.html&#x27;</span>).toString();</span><br><span class="line"><span class="keyword">let</span> result = ejs.render(html, &#123;<span class="attr">isLogin</span>: isLogin&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(result);</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    &lt;% if(isLogin)&#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎回来<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    &lt;% &#125;else&#123; %&gt;</span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span>&gt;</span>登录<span class="tag">&lt;/<span class="name">button</span>&gt;</span>  <span class="tag">&lt;<span class="name">button</span>&gt;</span>注册<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    &lt;% &#125; %&gt;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">header</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>欢迎回来<span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">    </span><br><span class="line">  <span class="tag">&lt;/<span class="name">header</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<h4 id="9-4-express中使用EJS"><a href="#9-4-express中使用EJS" class="headerlink" title="9.4 express中使用EJS"></a>9.4 express中使用EJS</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//导入 path</span></span><br><span class="line"><span class="keyword">const</span> path = <span class="built_in">require</span>(<span class="string">&#x27;path&#x27;</span>);</span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//1. 设置模板引擎</span></span><br><span class="line">app.set(<span class="string">&#x27;view engine&#x27;</span>, <span class="string">&#x27;ejs&#x27;</span>);<span class="comment">// pug  twing</span></span><br><span class="line"><span class="comment">//2. 设置模板文件存放位置   模板文件: 具有模板语法内容的文件</span></span><br><span class="line">app.set(<span class="string">&#x27;views&#x27;</span>, path.resolve(__dirname, <span class="string">&#x27;./views&#x27;</span>));</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/home&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//3. render 响应</span></span><br><span class="line">  <span class="comment">// res.render(&#x27;模板的文件名&#x27;, &#x27;数据&#x27;);</span></span><br><span class="line">  <span class="comment">//声明变量</span></span><br><span class="line">  <span class="keyword">let</span> title = <span class="string">&#x27;express中使用ejs&#x27;</span>;</span><br><span class="line">  res.render(<span class="string">&#x27;home&#x27;</span>, &#123;title&#125;);</span><br><span class="line">  <span class="comment">//4. 创建模板文件</span></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//监听端口, 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动, 端口 3000 正在监听中....&#x27;</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>home.ejs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;Document&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h2&gt;&lt;%= title %&gt;&lt;/h2&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:3000/home">http://localhost:3000/home</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842590.png" alt="image-20230902231809916" style="zoom:80%;" />

<h3 id="10、express-generator"><a href="#10、express-generator" class="headerlink" title="10、express-generator"></a>10、express-generator</h3><p>express应用生成器</p>
<figure class="highlight cmake"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm <span class="keyword">install</span> g express-generator</span><br></pre></td></tr></table></figure>

<figure class="highlight maxima"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">express</span> -e 项目名称</span><br><span class="line"><span class="built_in">express</span> -e <span class="number">15</span>-generator</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842591.png" alt="image-20230902232530411"></p>
<p>运行</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> start</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://localhost:3000/">http://localhost:3000/</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842592.png" alt="image-20230902233055280" style="zoom:80%;" />

<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i formidable</span><br></pre></td></tr></table></figure>

<p>portrait.ejs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt; </span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;文件上传&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h2&gt;文件上传&lt;/h2&gt;</span><br><span class="line">  &lt;hr&gt;</span><br><span class="line">  &lt;!--                                            文件上传的必需的属性             --&gt;</span><br><span class="line">  &lt;form action=&quot;/portrait&quot; method=&quot;post&quot; enctype=&quot;multipart/form-data&quot;&gt;</span><br><span class="line">    用户名: &lt;input type=&quot;text&quot; name=&quot;username&quot;&gt;&lt;br&gt;</span><br><span class="line">    头像: &lt;input type=&quot;file&quot; name=&quot;portrait&quot;&gt;&lt;br&gt;</span><br><span class="line">    &lt;hr&gt;</span><br><span class="line">    &lt;button&gt;点击提交&lt;/button&gt;</span><br><span class="line">  &lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="comment">//导入</span></span><br><span class="line"><span class="keyword">const</span> formidable = <span class="built_in">require</span>(<span class="string">&#x27;formidable&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">/* GET home page. */</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  res.render(<span class="string">&#x27;index&#x27;</span>, &#123; <span class="attr">title</span>: <span class="string">&#x27;Express&#x27;</span> &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//显示网页的 (表单)</span></span><br><span class="line">router.get(<span class="string">&#x27;/portrait&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.render(<span class="string">&#x27;portrait&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//处理文件上传</span></span><br><span class="line">router.post(<span class="string">&#x27;/portrait&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//创建 form 对象</span></span><br><span class="line">  <span class="keyword">const</span> form = formidable(&#123; </span><br><span class="line">    <span class="attr">multiples</span>: <span class="literal">true</span> ,</span><br><span class="line">    <span class="comment">//设置上传文件的保存目录</span></span><br><span class="line">    <span class="attr">uploadDir</span>: __dirname + <span class="string">&#x27;/../public/images&#x27;</span>,</span><br><span class="line">    <span class="comment">//保持文件后缀</span></span><br><span class="line">    <span class="attr">keepExtensions</span>: <span class="literal">true</span></span><br><span class="line">  &#125;);</span><br><span class="line">  <span class="comment">//解析请求报文</span></span><br><span class="line">  form.parse(req, <span class="function">(<span class="params">err, fields, files</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      next(err);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// console.log(fields);// text  radio  checkbox  select</span></span><br><span class="line">    <span class="comment">// console.log(files); // file</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">//服务器保存该图片的访问 URL</span></span><br><span class="line">    <span class="comment">// /images/8ad3d5e36012212ba7642c000.jpg</span></span><br><span class="line">    <span class="keyword">let</span> url = <span class="string">&#x27;/images/&#x27;</span> + files.portrait.newFilename;<span class="comment">// 将来将此数据保存在数据库中</span></span><br><span class="line">    </span><br><span class="line">    res.send(url);</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://localhost:3000/portrait">http://localhost:3000/portrait</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842593.png" alt="image-20230902233247002" style="zoom:80%;" />



<h3 id="12、案例实践——记账本"><a href="#12、案例实践——记账本" class="headerlink" title="12、案例实践——记账本"></a>12、案例实践——记账本</h3><p>【这个项目是基于express的项目】</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842594.png" alt="image-20230903103850109" style="zoom:80%;" />

<h4 id="12-1-收入与支出"><a href="#12-1-收入与支出" class="headerlink" title="12.1 收入与支出"></a>12.1 收入与支出</h4><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">  &lt;head&gt;</span><br><span class="line">    &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">    &lt;title&gt;添加记录&lt;/title&gt;</span><br><span class="line">    &lt;link</span><br><span class="line">      href=&quot;/css/bootstrap.css&quot;</span><br><span class="line">      rel=&quot;stylesheet&quot;</span><br><span class="line">    /&gt;</span><br><span class="line">    &lt;link href=&quot;/css/bootstrap-datepicker.css&quot; rel=&quot;stylesheet&quot;&gt;</span><br><span class="line">  &lt;/head&gt;</span><br><span class="line">  &lt;body&gt;</span><br><span class="line">    &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">        &lt;div class=&quot;col-xs-12 col-lg-8 col-lg-offset-2&quot;&gt;</span><br><span class="line">          &lt;h2&gt;添加记录&lt;/h2&gt;</span><br><span class="line">          &lt;hr /&gt;</span><br><span class="line">          &lt;form method=&quot;post&quot; action=&quot;/account&quot;&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">              &lt;label for=&quot;item&quot;&gt;事项&lt;/label&gt;</span><br><span class="line">              &lt;input</span><br><span class="line">                name=&quot;title&quot;</span><br><span class="line">                type=&quot;text&quot;</span><br><span class="line">                class=&quot;form-control&quot;</span><br><span class="line">                id=&quot;item&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">              &lt;label for=&quot;time&quot;&gt;时间&lt;/label&gt;</span><br><span class="line">              &lt;input</span><br><span class="line">                name=&quot;time&quot;</span><br><span class="line">                type=&quot;text&quot;</span><br><span class="line">                class=&quot;form-control&quot;</span><br><span class="line">                id=&quot;time&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">              &lt;label for=&quot;type&quot;&gt;类型&lt;/label&gt;</span><br><span class="line">              &lt;select name=&quot;type&quot; class=&quot;form-control&quot; id=&quot;type&quot;&gt;</span><br><span class="line">                &lt;option value=&quot;-1&quot;&gt;支出&lt;/option&gt;</span><br><span class="line">                &lt;option value=&quot;1&quot;&gt;收入&lt;/option&gt;</span><br><span class="line">              &lt;/select&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">              &lt;label for=&quot;account&quot;&gt;金额&lt;/label&gt;</span><br><span class="line">              &lt;input</span><br><span class="line">                name=&quot;account&quot;</span><br><span class="line">                type=&quot;text&quot;</span><br><span class="line">                class=&quot;form-control&quot;</span><br><span class="line">                id=&quot;account&quot;</span><br><span class="line">              /&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            </span><br><span class="line">            &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">              &lt;label for=&quot;remarks&quot;&gt;备注&lt;/label&gt;</span><br><span class="line">              &lt;textarea name=&quot;remarks&quot; class=&quot;form-control&quot; id=&quot;remarks&quot;&gt;&lt;/textarea&gt;</span><br><span class="line">            &lt;/div&gt;</span><br><span class="line">            &lt;hr&gt;</span><br><span class="line">            &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-block&quot;&gt;添加&lt;/button&gt;</span><br><span class="line">          &lt;/form&gt;</span><br><span class="line">        &lt;/div&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script src=&quot;/js/jquery.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/js/bootstrap.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/js/bootstrap-datepicker.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/js/bootstrap-datepicker.zh-CN.min.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">    &lt;script src=&quot;/js/main.js&quot;&gt;&lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1:3000/account">http://127.0.0.1:3000/account</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842595.png" alt="image-20230903103929912" style="zoom:80%;" />

<p><a target="_blank" rel="noopener" href="http://127.0.0.1:3000/account/create">http://127.0.0.1:3000/account/create</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842596.png" alt="image-20230903104013278" style="zoom:80%;" />



<h4 id="12-2-lowdb"><a href="#12-2-lowdb" class="headerlink" title="12.2 lowdb"></a>12.2 lowdb</h4><p>对数据进行管理</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">npm</span> i lowdb@<span class="number">1</span>.<span class="number">0</span>.<span class="number">0</span></span><br></pre></td></tr></table></figure>

<p>数据操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 lowdb</span></span><br><span class="line"><span class="keyword">const</span> low = <span class="built_in">require</span>(<span class="string">&#x27;lowdb&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> FileSync = <span class="built_in">require</span>(<span class="string">&#x27;lowdb/adapters/FileSync&#x27;</span>)</span><br><span class="line"><span class="keyword">const</span> adapter = <span class="keyword">new</span> FileSync(<span class="string">&#x27;db.json&#x27;</span>);</span><br><span class="line"><span class="comment">//获取 db 对象</span></span><br><span class="line"><span class="keyword">const</span> db = low(adapter);</span><br><span class="line"></span><br><span class="line"><span class="comment">//初始化数据</span></span><br><span class="line">db.defaults(&#123; <span class="attr">posts</span>: [], <span class="attr">user</span>: &#123;&#125; &#125;).write()</span><br><span class="line"></span><br><span class="line"><span class="comment">//写入数据</span></span><br><span class="line">db.get(<span class="string">&#x27;posts&#x27;</span>).push(&#123;<span class="attr">id</span>: <span class="number">2</span>, <span class="attr">title</span>: <span class="string">&#x27;今天天气还不错~~&#x27;</span>&#125;).write();</span><br><span class="line">db.get(<span class="string">&#x27;posts&#x27;</span>).unshift(&#123;<span class="attr">id</span>: <span class="number">3</span>, <span class="attr">title</span>: <span class="string">&#x27;今天天气还不错~~&#x27;</span>&#125;).write();</span><br><span class="line"><span class="comment">//获取单条数据</span></span><br><span class="line"><span class="keyword">let</span> res = db.get(<span class="string">&#x27;posts&#x27;</span>).find(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;).value();</span><br><span class="line"><span class="built_in">console</span>.log(res);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取数据</span></span><br><span class="line"><span class="built_in">console</span>.log(db.get(<span class="string">&#x27;posts&#x27;</span>).value());</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除数据</span></span><br><span class="line"><span class="comment">// let res = db.get(&#x27;posts&#x27;).remove(&#123;id: 2&#125;).write();</span></span><br><span class="line"><span class="comment">// console.log(res);</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//更新数据</span></span><br><span class="line">db.get(<span class="string">&#x27;posts&#x27;</span>).find(&#123;<span class="attr">id</span>: <span class="number">1</span>&#125;).assign(&#123;<span class="attr">title</span>: <span class="string">&#x27;吃饭了!!!&#x27;</span>&#125;).write()</span><br></pre></td></tr></table></figure>

<p>输出到db.json保存</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;posts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;今天天气还不错~~&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;吃饭了!!!&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;今天天气还不错~~&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>控制台输出</p>
<figure class="highlight qml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123; <span class="attribute">id:</span><span class="string"> 1, title</span>: <span class="string">&#x27;今天下雨啦!!!&#x27;</span> &#125;</span><br><span class="line">[</span><br><span class="line">  &#123; <span class="attribute">id:</span><span class="string"> 3, title</span>: <span class="string">&#x27;今天天气还不错~~&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attribute">id:</span><span class="string"> 1, title</span>: <span class="string">&#x27;今天下雨啦!!!&#x27;</span> &#125;,</span><br><span class="line">  &#123; <span class="attribute">id:</span><span class="string"> 2, title</span>: <span class="string">&#x27;今天天气还不错~~&#x27;</span> &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure>



<h2 id="九、MongoDB"><a href="#九、MongoDB" class="headerlink" title="九、MongoDB"></a>九、MongoDB</h2><p>MongoDB 是一个基于分布式文件存储的数据库，官方地址 <a target="_blank" rel="noopener" href="https://www.mongodb.com/">https://www.mongodb.com/</a></p>
<h3 id="1、下载安装"><a href="#1、下载安装" class="headerlink" title="1、下载安装"></a>1、下载安装</h3><p>第5版本</p>
<p>下载地址： <a target="_blank" rel="noopener" href="https://www.mongodb.com/try/download/community">https://www.mongodb.com/try/download/community</a>  建议选择 zip 类型， 通用性更强。</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842597.png" alt="image-20230903105446975" style="zoom:80%;" />

<p>配置步骤如下：解压在哪个盘就在哪个盘的根目录下创建data&gt;db文件夹。配置环境变量后可使用命令<code>mongod</code>q=启动服务端，<code>mongo</code>启动客户端。服务端的端口是27017</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842598.png" alt="image-20230903112418183" style="zoom:80%;" />

<blockquote>
<p>注意：</p>
<ul>
<li>为了方便后续方便使用 mongod 命令，可以将 bin 目录配置到环境变量 Path 中</li>
<li>千万不要选中服务端窗口的内容 ，选中会停止服务，可以 敲回车 取消选中</li>
</ul>
</blockquote>
<p>​    </p>
<h3 id="2、核心概念"><a href="#2、核心概念" class="headerlink" title="2、核心概念"></a>2、核心概念</h3><p>Mongodb 中有三个重要概念需要掌握</p>
<ul>
<li>数据库（database） 数据库是一个数据仓库，数据库服务下可以创建很多数据库，数据库中可以存放很多集合</li>
<li>集合（collection） 集合类似于 JS 中的数组，在集合中可以存放很多文档</li>
<li>文档（document） 文档是数据库中的最小单位，类似于 JS 中的对象</li>
</ul>
<p>JSON 文件示例：</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;accounts&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;3-YLju5f3&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;买电脑&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;time&quot;</span>: <span class="string">&quot;2023-02-08&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;account&quot;</span>: <span class="string">&quot;5500&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;remarks&quot;</span>: <span class="string">&quot;为了上网课&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;3-YLju5f4&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;请女朋友吃饭&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;time&quot;</span>: <span class="string">&quot;2023-02-08&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;-1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;account&quot;</span>: <span class="string">&quot;214&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;remarks&quot;</span>: <span class="string">&quot;情人节聚餐&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="string">&quot;mRQiD4s3K&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>: <span class="string">&quot;发工资&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;time&quot;</span>: <span class="string">&quot;2023-02-19&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;1&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;account&quot;</span>: <span class="string">&quot;4396&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;remarks&quot;</span>: <span class="string">&quot;终于发工资啦!~~&quot;</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;users&quot;</span>:[</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;zhangsan&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">18</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;lisi&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">20</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;wangwu&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;age&quot;</span>: <span class="number">22</span></span><br><span class="line">    &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>一个 <strong>JSON 文件</strong>好比是一个数据库 ，一个 Mongodb 服务下可以有 N 个数据库</li>
<li>JSON 文件中的<strong>一级属性的数组值</strong>好比是<strong>集合</strong></li>
<li>数组中的对象好比是 <strong>文档</strong></li>
<li>对象中的属性有时也称之为 <strong>字段</strong></li>
</ul>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842599.png" alt="image-20230903105240254" style="zoom:80%;" />

<blockquote>
<p>一般情况下：</p>
<ul>
<li>一个项目使用一个数据库</li>
<li>一个集合会存储同一种类型的数据</li>
</ul>
</blockquote>
<h3 id="3、命令行交互"><a href="#3、命令行交互" class="headerlink" title="3、命令行交互"></a>3、命令行交互</h3><h4 id="3-1-数据库命令"><a href="#3-1-数据库命令" class="headerlink" title="3.1 数据库命令"></a>3.1 数据库命令</h4><ol>
<li><p>显示所有的数据库</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> dbs</span><br></pre></td></tr></table></figure></li>
<li><p>切换到指定的数据库，如果数据库不存在会自动创建数据库</p>
<figure class="highlight actionscript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 数据库名</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前所在的数据库</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">db</span></span><br></pre></td></tr></table></figure></li>
<li><p>删除当前数据库</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">use</span> 库名</span><br><span class="line"><span class="keyword">db</span>.dropDatabase()</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-2-集合命令"><a href="#3-2-集合命令" class="headerlink" title="3.2 集合命令"></a>3.2 集合命令</h4><ol>
<li><p>创建集合</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span><span class="selector-class">.createCollection</span>(<span class="string">&#x27;集合名称&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
<li><p>显示当前数据库中的所有集合</p>
<figure class="highlight dart"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">show</span> collections</span><br></pre></td></tr></table></figure></li>
<li><p>删除某个集合</p>
<figure class="highlight stata"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">db</span>.集合名.<span class="keyword">drop</span>()</span><br></pre></td></tr></table></figure></li>
<li><p>重命名集合</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-tag">db</span>.集合名<span class="selector-class">.renameCollection</span>(<span class="string">&#x27;newName&#x27;</span>)</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="3-3-文档命令"><a href="#3-3-文档命令" class="headerlink" title="3.3 文档命令"></a>3.3 文档命令</h4><ol>
<li><p>插入文档</p>
<figure class="highlight abnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.insert(文档对象)<span class="comment">;</span></span><br></pre></td></tr></table></figure></li>
<li><p>查询文档</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="builtin-name">find</span>(查询条件)</span><br></pre></td></tr></table></figure>

<p>_id 是 mongodb 自动生成的唯一编号，用来唯一标识文档</p>
</li>
<li><p>更新文档</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="keyword">update</span>(查询条件,新的文档)</span><br><span class="line">db.集合名.<span class="keyword">update</span>(&#123;<span class="type">name</span>:<span class="string">&#x27;张三&#x27;</span>&#125;,&#123;$<span class="keyword">set</span>:&#123;age:<span class="number">19</span>&#125;&#125;)</span><br></pre></td></tr></table></figure></li>
<li><p>删除文档</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.集合名.<span class="builtin-name">remove</span>(查询条件)</span><br></pre></td></tr></table></figure></li>
</ol>
<h3 id="4、应用场景"><a href="#4、应用场景" class="headerlink" title="4、应用场景"></a>4、应用场景</h3><ul>
<li>新增：<br>用户注册<br>发布视频<br>发布商品<br>发朋友圈<br>发评论<br>发微博<br>发弹幕<br>…….</li>
<li>删除<br>删除评论<br>删除商品<br>删除文章<br>删除视频<br>删除微博<br>……</li>
<li>更新<br>更新个人信息<br>修改商品价格<br>修改文章内容<br>……</li>
<li>查询<br>商品列表<br>视频列表<br>朋友圈列表<br>微博列表<br>搜索功能<br>……</li>
</ul>
<h2 id="十、Mongoose"><a href="#十、Mongoose" class="headerlink" title="十、Mongoose"></a>十、Mongoose</h2><h3 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h3><p>Mongoose 是一个对象文档模型库，方便使用代码操作 mongodb 数据库。官网 <a target="_blank" rel="noopener" href="http://www.mongoosejs.net/">http://www.mongoosejs.net/</a></p>
<h3 id="2、使用"><a href="#2、使用" class="headerlink" title="2、使用"></a>2、使用</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i mongoose</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 安装 mongoose</span></span><br><span class="line"><span class="comment">//2. 导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">//3. 连接数据库</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"><span class="comment">//4. 设置连接回调</span></span><br><span class="line"><span class="comment">//连接成功</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接成功&#x27;</span>);</span><br><span class="line">    <span class="comment">//5. 创建文档结构对象</span></span><br><span class="line">    <span class="keyword">let</span> BookSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">price</span>: <span class="built_in">Number</span></span><br><span class="line">    &#125;);</span><br><span class="line">    <span class="comment">//6. 创建文档模型对象</span></span><br><span class="line">    <span class="keyword">let</span> BookModel = mongoose.model(<span class="string">&#x27;book&#x27;</span>, BookSchema);</span><br><span class="line">    <span class="comment">//7. 插入文档</span></span><br><span class="line">    BookModel.create(&#123;</span><br><span class="line">        <span class="attr">title</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">        <span class="attr">author</span>: <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">        <span class="attr">price</span>: <span class="number">19.9</span></span><br><span class="line">    &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="comment">//输出 data 对象</span></span><br><span class="line">        <span class="built_in">console</span>.log(data);</span><br><span class="line">        <span class="comment">//8. 断开连接</span></span><br><span class="line">        mongoose.disconnect();</span><br><span class="line">    &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//连接出错</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接出错~~&#x27;</span>);</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//连接关闭</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">连接成功</span><br></pre></td></tr></table></figure>



<h3 id="3、创建新文档"><a href="#3、创建新文档" class="headerlink" title="3、创建新文档"></a>3、创建新文档</h3><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 安装 mongoose</span></span><br><span class="line"><span class="comment">//2. 导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置 strictQuery 为 true</span></span><br><span class="line">mongoose.set(<span class="string">&#x27;strictQuery&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 连接 mongodb 服务                        数据库的名称</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 设置回调</span></span><br><span class="line"><span class="comment">// 设置连接成功的回调  once 一次   事件回调函数只执行一次</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//5. 创建文档的结构对象</span></span><br><span class="line">  <span class="comment">//设置集合中文档的属性以及属性值的类型</span></span><br><span class="line">  <span class="keyword">let</span> BookSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="built_in">Number</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//6. 创建模型对象  对文档操作的封装对象</span></span><br><span class="line">  <span class="keyword">let</span> BookModel = mongoose.model(<span class="string">&#x27;books&#x27;</span>, BookSchema);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//7. 新增</span></span><br><span class="line">  BookModel.create(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="number">19.9</span></span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断是否有错误</span></span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果没有出错, 则输出插入后的文档对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//8. 关闭数据库连接 (项目运行过程中, 不会添加该代码)</span></span><br><span class="line">    mongoose.disconnect();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置连接错误的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">//设置连接关闭的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">name</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">  author: <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">  price: <span class="number">19.9</span>,</span><br><span class="line">  <span class="variable">_id</span>: new ObjectId(<span class="string">&quot;64f4016fced34b20f2409753&quot;</span>),</span><br><span class="line">  <span class="variable">__v</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">连接关闭</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842600.png" alt="image-20230903114713668" style="zoom:80%;" />

<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842601.png" alt="image-20230903114735432" style="zoom:80%;" />

<h3 id="4、字段类型"><a href="#4、字段类型" class="headerlink" title="4、字段类型"></a>4、字段类型</h3><p>文档结构可选的常用字段类型列表：</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842602.png" alt="image-20230901210131229" style="zoom: 67%;" />

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 安装 mongoose</span></span><br><span class="line"><span class="comment">//2. 导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置 strictQuery 为 true</span></span><br><span class="line">mongoose.set(<span class="string">&#x27;strictQuery&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 连接 mongodb 服务                        数据库的名称</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 设置回调</span></span><br><span class="line"><span class="comment">// 设置连接成功的回调  once 一次   事件回调函数只执行一次</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//5. 创建文档的结构对象</span></span><br><span class="line">  <span class="comment">//设置集合中文档的属性以及属性值的类型</span></span><br><span class="line">  <span class="keyword">let</span> BookSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="built_in">Number</span>,</span><br><span class="line">    <span class="attr">is_hot</span>: <span class="built_in">Boolean</span>,</span><br><span class="line">    <span class="attr">tags</span>: <span class="built_in">Array</span>,</span><br><span class="line">    <span class="attr">pub_time</span>: <span class="built_in">Date</span>,</span><br><span class="line">    <span class="attr">test</span>: mongoose.Schema.Types.Mixed <span class="comment">// 文档 ID</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//6. 创建模型对象  对文档操作的封装对象</span></span><br><span class="line">  <span class="keyword">let</span> BookModel = mongoose.model(<span class="string">&#x27;books&#x27;</span>, BookSchema);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//7. 新增</span></span><br><span class="line">  BookModel.create(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="number">19.9</span>,</span><br><span class="line">    <span class="attr">is_hot</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">tags</span>: [<span class="string">&#x27;鬼怪&#x27;</span>,<span class="string">&#x27;励志&#x27;</span>,<span class="string">&#x27;社会&#x27;</span>],</span><br><span class="line">    <span class="attr">pub_time</span>: <span class="keyword">new</span> <span class="built_in">Date</span>(),</span><br><span class="line">    <span class="attr">test</span>: <span class="keyword">new</span> <span class="built_in">Date</span>()</span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断是否有错误</span></span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果没有出错, 则输出插入后的文档对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//8. 关闭数据库连接 (项目运行过程中, 不会添加该代码)</span></span><br><span class="line">    mongoose.disconnect();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置连接错误的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">//设置连接关闭的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">name:</span> <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">  <span class="attr">author:</span> <span class="string">&#x27;吴承恩&#x27;</span>,</span><br><span class="line">  <span class="attr">price:</span> <span class="number">19.9</span>,</span><br><span class="line">  <span class="attr">is_hot:</span> <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">tags:</span> [ <span class="string">&#x27;鬼怪&#x27;</span>, <span class="string">&#x27;励志&#x27;</span>, <span class="string">&#x27;社会&#x27;</span> ],</span><br><span class="line">  <span class="attr">pub_time:</span> <span class="number">2023-09-03T03:47:57.259Z</span>,</span><br><span class="line">  <span class="attr">test:</span> <span class="number">2023-09-03T03:47:57.259Z</span>,</span><br><span class="line">  <span class="attr">_id:</span> <span class="string">new</span> <span class="string">ObjectId(&quot;64f401ed76df817adffa5b9c&quot;)</span>,</span><br><span class="line">  <span class="attr">__v:</span> <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="string">连接关闭</span></span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842603.png" alt="image-20230903114854398" style="zoom:80%;" />

<h3 id="5、字段值验证"><a href="#5、字段值验证" class="headerlink" title="5、字段值验证"></a>5、字段值验证</h3><p>Mongoose 有一些内建验证器，可以对字段值进行验证。</p>
<h4 id="5-1-必填项"><a href="#5-1-必填项" class="headerlink" title="5.1 必填项"></a>5.1 必填项</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">title: &#123;</span><br><span class="line">    type: String,</span><br><span class="line">    required: <span class="literal">true</span> <span class="comment">// 设置必填项</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="5-2-默认值"><a href="#5-2-默认值" class="headerlink" title="5.2  默认值"></a>5.2  默认值</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">author: &#123;</span><br><span class="line">	type: String,</span><br><span class="line">	default: &#x27;匿名&#x27; <span class="comment">//默认值</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="5-3-枚举值"><a href="#5-3-枚举值" class="headerlink" title="5.3 枚举值"></a>5.3 枚举值</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gender: &#123;</span><br><span class="line">	type: String,</span><br><span class="line">	enum: [&#x27;男&#x27;,&#x27;女&#x27;] <span class="comment">//设置的值必须是数组中的</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<h4 id="5-4-唯一值"><a href="#5-4-唯一值" class="headerlink" title="5.4 唯一值"></a>5.4 唯一值</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">username: &#123;</span><br><span class="line">	type: String,</span><br><span class="line">	unique: <span class="literal">true</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>

<blockquote>
<p>unique 需要<strong>重建集合</strong>才能有效果</p>
</blockquote>
<h4 id="5-5-举例"><a href="#5-5-举例" class="headerlink" title="5.5 举例"></a>5.5 举例</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 安装 mongoose</span></span><br><span class="line"><span class="comment">//2. 导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置 strictQuery 为 true</span></span><br><span class="line">mongoose.set(<span class="string">&#x27;strictQuery&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 连接 mongodb 服务                        数据库的名称</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 设置回调</span></span><br><span class="line"><span class="comment">// 设置连接成功的回调  once 一次   事件回调函数只执行一次</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//5. 创建文档的结构对象</span></span><br><span class="line">  <span class="comment">//设置集合中文档的属性以及属性值的类型</span></span><br><span class="line">  <span class="keyword">let</span> BookSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    <span class="attr">name</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">required</span>: <span class="literal">true</span>, <span class="comment">// 表明该属性必须不为空</span></span><br><span class="line">      <span class="attr">unique</span>: <span class="literal">true</span><span class="comment">// 设置为独一无二的</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">author</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="attr">default</span>: <span class="string">&#x27;匿名&#x27;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">//类型</span></span><br><span class="line">    <span class="attr">style</span>: &#123;</span><br><span class="line">      <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">      <span class="comment">//枚举</span></span><br><span class="line">      <span class="attr">enum</span>: [<span class="string">&#x27;言情&#x27;</span>,<span class="string">&#x27;城市&#x27;</span>,<span class="string">&#x27;志怪&#x27;</span>,<span class="string">&#x27;恐怖&#x27;</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">price</span>: <span class="built_in">Number</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//6. 创建模型对象  对文档操作的封装对象</span></span><br><span class="line">  <span class="keyword">let</span> BookModel = mongoose.model(<span class="string">&#x27;books&#x27;</span>, BookSchema);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//7. 新增</span></span><br><span class="line">  BookModel.create(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">    <span class="comment">// author: &#x27;吴承恩&#x27;,</span></span><br><span class="line">    <span class="attr">price</span>: <span class="number">19.9</span>,</span><br><span class="line">    <span class="attr">style</span>: <span class="string">&#x27;志怪&#x27;</span></span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断是否有错误</span></span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(err);</span><br><span class="line">      <span class="comment">// console.log(&#x27;插入失败~~~&#x27;);</span></span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//如果没有出错, 则输出插入后的文档对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    <span class="comment">//8. 关闭数据库连接 (项目运行过程中, 不会添加该代码)</span></span><br><span class="line">    mongoose.disconnect();</span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置连接错误的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);</span><br><span class="line">&#125;); </span><br><span class="line"></span><br><span class="line"><span class="comment">//设置连接关闭的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;); </span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight sqf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="built_in">name</span>: <span class="string">&#x27;西游记&#x27;</span>,</span><br><span class="line">  author: <span class="string">&#x27;匿名&#x27;</span>,</span><br><span class="line">  style: <span class="string">&#x27;志怪&#x27;</span>,</span><br><span class="line">  price: <span class="number">19.9</span>,</span><br><span class="line">  <span class="variable">_id</span>: new ObjectId(<span class="string">&quot;64f4024c3884b178dc4008e2&quot;</span>),</span><br><span class="line">  <span class="variable">__v</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br><span class="line">连接关闭</span><br></pre></td></tr></table></figure>

<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842604.png" alt="image-20230903114957885" style="zoom:80%;" />

<h3 id="6、CRUD"><a href="#6、CRUD" class="headerlink" title="6、CRUD"></a>6、CRUD</h3><p>数据库的基本操作包括四个，增加（create），删除（delete），修改（update），查（read）</p>
<h4 id="6-1-增加文档"><a href="#6-1-增加文档" class="headerlink" title="6.1 增加文档"></a>6.1 增加文档</h4><p>插入一条</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">SongModel.create(&#123;</span><br><span class="line">    <span class="attr">title</span>:<span class="string">&#x27;给我一首歌的时间&#x27;</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="string">&#x27;Jay&#x27;</span></span><br><span class="line">&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line"><span class="comment">//错误</span></span><br><span class="line">    <span class="built_in">console</span>.log(err);</span><br><span class="line"><span class="comment">//插入后的数据对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量插入</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.引入mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">//2.链接mongodb数据库 connect 连接</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/project&#x27;</span>);</span><br><span class="line"><span class="comment">//3.设置连接的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;open&#x27;</span>,<span class="function">()=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">//4.声明文档结构</span></span><br><span class="line">    <span class="keyword">const</span> PhoneSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">        <span class="attr">brand</span>:<span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">color</span>:<span class="built_in">String</span>,</span><br><span class="line">        <span class="attr">price</span>:<span class="built_in">Number</span>,</span><br><span class="line">        <span class="attr">tags</span>:<span class="built_in">Array</span></span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="comment">//6.创建模型对象</span></span><br><span class="line">    <span class="keyword">const</span> PhoneModel = mongoose.model(<span class="string">&#x27;phone&#x27;</span>,PhoneSchema);</span><br><span class="line">    PhoneModel.insertMany([</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">brand</span>:<span class="string">&#x27;华为&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>:<span class="string">&#x27;灰色&#x27;</span>,</span><br><span class="line">            <span class="attr">price</span>:<span class="number">2399</span>,</span><br><span class="line">            <span class="attr">tags</span>:[<span class="string">&#x27;电量大&#x27;</span>,<span class="string">&#x27;屏幕大&#x27;</span>,<span class="string">&#x27;信号好&#x27;</span>]</span><br><span class="line">        &#125;,</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">brand</span>:<span class="string">&#x27;小米&#x27;</span>,</span><br><span class="line">            <span class="attr">color</span>:<span class="string">&#x27;白色&#x27;</span>,</span><br><span class="line">            <span class="attr">price</span>:<span class="number">2099</span>,</span><br><span class="line">            <span class="attr">tags</span>:[<span class="string">&#x27;电量大&#x27;</span>,<span class="string">&#x27;屏幕大&#x27;</span>,<span class="string">&#x27;信号好&#x27;</span>]</span><br><span class="line">        &#125;</span><br><span class="line">    ],<span class="function">(<span class="params">err,data</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">&#x27;写入成功&#x27;</span>);</span><br><span class="line">        mongoose.connection.close();</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h4 id="6-2-删除文档"><a href="#6-2-删除文档" class="headerlink" title="6.2 删除文档"></a>6.2 删除文档</h4><p>删除一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SongModel.deleteOne(&#123;<span class="attr">_id</span>:<span class="string">&#x27;5dd65f32be6401035cb5b1ed&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量删除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">SongModel.deleteMany(&#123;<span class="attr">author</span>:<span class="string">&#x27;Jay&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;删除成功&#x27;</span>);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="6-3-更新文档"><a href="#6-3-更新文档" class="headerlink" title="6.3 更新文档"></a>6.3 更新文档</h4><p>更新一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SongModel.updateOne(&#123;<span class="attr">author</span>: <span class="string">&#x27;JJ Lin&#x27;</span>&#125;, &#123;<span class="attr">author</span>: <span class="string">&#x27;林俊杰&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量更新数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">SongModel.updateMany(&#123;<span class="attr">author</span>: <span class="string">&#x27;Leehom Wang&#x27;</span>&#125;, &#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h4 id="6-4-读取文档"><a href="#6-4-读取文档" class="headerlink" title="6.4 读取文档"></a>6.4 读取文档</h4><p>查询一条数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">SongModel.findOne(&#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//根据 id 查询数据</span></span><br><span class="line">SongModel.findById(<span class="string">&#x27;5dd662b5381fc316b44ce167&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>批量查询数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//不加条件查询</span></span><br><span class="line">SongModel.find(<span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//加条件查询</span></span><br><span class="line">SongModel.find(&#123;<span class="attr">author</span>: <span class="string">&#x27;王力宏&#x27;</span>&#125;, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="7、条件控制"><a href="#7、条件控制" class="headerlink" title="7、条件控制"></a>7、条件控制</h3><h4 id="7-1-运算符"><a href="#7-1-运算符" class="headerlink" title="7.1 运算符"></a>7.1 运算符</h4><p>在 mongodb 不能 &gt; &lt; &gt;= &lt;= !== 等运算符，需要使用替代符号</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&gt; 使用 <span class="symbol">$</span><span class="keyword">gt</span></span><br><span class="line">&lt; 使用 <span class="symbol">$</span><span class="keyword">lt</span></span><br><span class="line">&gt;= 使用 <span class="symbol">$</span>gte</span><br><span class="line">&lt;= 使用 <span class="symbol">$</span>lte</span><br><span class="line">!== 使用 <span class="symbol">$</span><span class="keyword">ne</span></span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.students.find(&#123;<span class="attr">id</span>:&#123;<span class="attr">$gt</span>:<span class="number">3</span>&#125;&#125;); id号比<span class="number">3</span>大的所有的记录</span><br></pre></td></tr></table></figure>

<h4 id="7-2-逻辑运算"><a href="#7-2-逻辑运算" class="headerlink" title="7.2 逻辑运算"></a>7.2 逻辑运算</h4><p><code>$or</code> 逻辑或的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.students.find(&#123;<span class="attr">$or</span>:[&#123;<span class="attr">age</span>:<span class="number">18</span>&#125;,&#123;<span class="attr">age</span>:<span class="number">24</span>&#125;]&#125;);</span><br></pre></td></tr></table></figure>

<p><code>$and</code> 逻辑与的情况</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.students.find(&#123;<span class="attr">$and</span>: [&#123;<span class="attr">age</span>: &#123;<span class="attr">$lt</span>:<span class="number">20</span>&#125;&#125;, &#123;<span class="attr">age</span>: &#123;<span class="attr">$gt</span>: <span class="number">15</span>&#125;&#125;]&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-3-正则匹配"><a href="#7-3-正则匹配" class="headerlink" title="7.3 正则匹配"></a>7.3 正则匹配</h4><p>条件中可以直接使用 JS 的正则语法，通过正则可以进行模糊查询</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">db.students.find(&#123;<span class="attr">name</span>:<span class="regexp">/imissyou/</span>&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="7-4-举例"><a href="#7-4-举例" class="headerlink" title="7.4 举例"></a>7.4 举例</h4><p>数据库是bilibili，集合是<code>novels</code>，先运行<code>创建集合.js</code>创建集合<code>novels</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1. 安装 mongoose</span></span><br><span class="line"><span class="comment">//2. 导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置 strictQuery 为 true</span></span><br><span class="line">mongoose.set(<span class="string">&#x27;strictQuery&#x27;</span>, <span class="literal">true</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//3. 连接 mongodb 服务                        数据库的名称</span></span><br><span class="line">mongoose.connect(<span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//4. 设置回调</span></span><br><span class="line"><span class="comment">// 设置连接成功的回调  once 一次   事件回调函数只执行一次</span></span><br><span class="line">mongoose.connection.once(<span class="string">&#x27;open&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//5. 创建文档的结构对象</span></span><br><span class="line">  <span class="comment">//设置集合中文档的属性以及属性值的类型</span></span><br><span class="line">  <span class="keyword">let</span> BookSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">    <span class="attr">name</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">author</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">price</span>: <span class="built_in">Number</span>,</span><br><span class="line">    <span class="attr">is_hot</span>: <span class="built_in">Boolean</span></span><br><span class="line">  &#125;);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//6. 创建模型对象  对文档操作的封装对象    mongoose 会使用集合名称的复数, 创建集合</span></span><br><span class="line">  <span class="keyword">let</span> BookModel = mongoose.model(<span class="string">&#x27;novel&#x27;</span>, BookSchema);</span><br><span class="line"></span><br><span class="line">  <span class="comment">//价格小于 20 的图书</span></span><br><span class="line">  <span class="comment">// BookModel.find(&#123;price: &#123;$lt: 20&#125;&#125;, (err, data) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   if(err) &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;读取失败~~&#x27;);</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   console.log(data);</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//曹雪芹 或者 余华的书</span></span><br><span class="line">  <span class="comment">// BookModel.find(&#123;$or: [&#123;author: &#x27;曹雪芹&#x27;&#125;, &#123;author: &#x27;余华&#x27;&#125;]&#125;, (err, data) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   if (err) &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;读取失败~~&#x27;);</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   console.log(data);</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//价格大于 30 且小于 70</span></span><br><span class="line">  <span class="comment">// BookModel.find(&#123;$and: [&#123;price: &#123;$gt: 30&#125;&#125;, &#123;price: &#123;$lt: 70&#125;&#125;]&#125;, (err, data) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   if (err) &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;读取失败~~&#x27;);</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   console.log(data);</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">//正则表达式, 搜索书籍名称中带有 `三` 的图书</span></span><br><span class="line">  <span class="comment">// BookModel.find(&#123;name: /三/&#125;, (err, data) =&gt; &#123;</span></span><br><span class="line">  <span class="comment">//   if (err) &#123;</span></span><br><span class="line">  <span class="comment">//     console.log(&#x27;读取失败~~&#x27;);</span></span><br><span class="line">  <span class="comment">//     return;</span></span><br><span class="line">  <span class="comment">//   &#125;</span></span><br><span class="line">  <span class="comment">//   console.log(data);</span></span><br><span class="line">  <span class="comment">// &#125;)</span></span><br><span class="line"></span><br><span class="line">  BookModel.find(&#123;<span class="attr">name</span>: <span class="keyword">new</span> <span class="built_in">RegExp</span>(<span class="string">&#x27;三&#x27;</span>)&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">&#x27;读取失败~~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 设置连接错误的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;error&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接失败&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//设置连接关闭的回调</span></span><br><span class="line">mongoose.connection.on(<span class="string">&#x27;close&#x27;</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">&#x27;连接关闭&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="8、个性化读取"><a href="#8、个性化读取" class="headerlink" title="8、个性化读取"></a>8、个性化读取</h3><h4 id="8-1-字段筛选"><a href="#8-1-字段筛选" class="headerlink" title="8.1 字段筛选"></a>8.1 字段筛选</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//0:不要的字段</span></span><br><span class="line"><span class="comment">//1:要的字段</span></span><br><span class="line">SongModel.find().select(&#123;<span class="attr">_id</span>:<span class="number">0</span>,<span class="attr">title</span>:<span class="number">1</span>&#125;).exec(<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="8-2-数据排序"><a href="#8-2-数据排序" class="headerlink" title="8.2 数据排序"></a>8.2 数据排序</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//sort 排序</span></span><br><span class="line"><span class="comment">//1:升序</span></span><br><span class="line"><span class="comment">//-1:倒序</span></span><br><span class="line">SongModel.find().sort(&#123;<span class="attr">hot</span>:<span class="number">1</span>&#125;).exec(<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="8-3-数据截取"><a href="#8-3-数据截取" class="headerlink" title="8.3 数据截取"></a>8.3 数据截取</h4><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//skip 跳过 limit 限定</span></span><br><span class="line">SongModel.find().skip(<span class="number">10</span>).limit(<span class="number">10</span>).exec(<span class="function"><span class="keyword">function</span>(<span class="params">err,data</span>)</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">    <span class="built_in">console</span>.log(data);</span><br><span class="line">    mongoose.connection.close();</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="9、代码模块化"><a href="#9、代码模块化" class="headerlink" title="9、代码模块化"></a>9、代码模块化</h3><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842605.png" alt="image-20230903120618914" style="zoom:80%;" />

<h3 id="10、MongoDB图形化工具"><a href="#10、MongoDB图形化工具" class="headerlink" title="10、MongoDB图形化工具"></a>10、MongoDB图形化工具</h3><p>可以使用图形化的管理工具来对 Mongodb 进行交互：</p>
<p>Robo 3T 免费 <a target="_blank" rel="noopener" href="https://github.com/Studio3T/robomongo/releases">https://github.com/Studio3T/robomongo/releases</a><br>Navicat 收费 <a target="_blank" rel="noopener" href="https://www.navicat.com.cn/">https://www.navicat.com.cn/</a></p>
<h3 id="11、案例实践——记账本结合数据库"><a href="#11、案例实践——记账本结合数据库" class="headerlink" title="11、案例实践——记账本结合数据库"></a>11、案例实践——记账本结合数据库</h3><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842606.png" alt="image-20230903124453439" style="zoom:80%;" />

<h4 id="11-1-www文件"><a href="#11-1-www文件" class="headerlink" title="11.1 www文件"></a>11.1 www文件</h4><p>导入db</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 db 函数</span></span><br><span class="line"><span class="keyword">const</span> db = <span class="built_in">require</span>(<span class="string">&#x27;../db/db&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>将之前的文件使用db括起来</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">db(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    之前的代码（http服务）</span><br><span class="line"> &#125;)</span><br></pre></td></tr></table></figure>

<h4 id="11-2-创建模型"><a href="#11-2-创建模型" class="headerlink" title="11.2 创建模型"></a>11.2 创建模型</h4><p>在models文件夹下创建模型AccountModel.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 mongoose</span></span><br><span class="line"><span class="keyword">const</span> mongoose = <span class="built_in">require</span>(<span class="string">&#x27;mongoose&#x27;</span>);</span><br><span class="line"><span class="comment">//创建文档的结构对象</span></span><br><span class="line"><span class="comment">//设置集合中文档的属性以及属性值的类型</span></span><br><span class="line"><span class="keyword">let</span> AccountSchema = <span class="keyword">new</span> mongoose.Schema(&#123;</span><br><span class="line">  <span class="comment">//标题</span></span><br><span class="line">  <span class="attr">title</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//时间</span></span><br><span class="line">  <span class="attr">time</span>: <span class="built_in">Date</span>,</span><br><span class="line">  <span class="comment">//类型</span></span><br><span class="line">  <span class="attr">type</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">    <span class="attr">default</span>: -<span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//金额</span></span><br><span class="line">  <span class="attr">account</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">Number</span>,</span><br><span class="line">    <span class="attr">required</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="comment">//备注</span></span><br><span class="line">  <span class="attr">remarks</span>: &#123;</span><br><span class="line">    <span class="attr">type</span>: <span class="built_in">String</span> </span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建模型对象  对文档操作的封装对象</span></span><br><span class="line"><span class="keyword">let</span> AccountModel = mongoose.model(<span class="string">&#x27;accounts&#x27;</span>, AccountSchema);</span><br><span class="line"></span><br><span class="line"><span class="comment">//暴露模型对象</span></span><br><span class="line"><span class="built_in">module</span>.exports = AccountModel;</span><br></pre></td></tr></table></figure>

<h4 id="11-3-CRUD"><a href="#11-3-CRUD" class="headerlink" title="11.3 CRUD"></a>11.3 CRUD</h4><p>安装moment，这个包可以将字符串转为日期</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i moment</span><br></pre></td></tr></table></figure>

<p>在index.js中导入moment</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>插入数据，在index.js中修改代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//新增记录</span></span><br><span class="line">router.post(<span class="string">&#x27;/account&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//插入数据库</span></span><br><span class="line">  AccountModel.create(&#123;</span><br><span class="line">    ...req.body,</span><br><span class="line">    <span class="comment">//修改 time 属性的值</span></span><br><span class="line">    <span class="attr">time</span>: moment(req.body.time).toDate()</span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">&#x27;插入失败~~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功提醒</span></span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;添加成功哦~~~&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/account&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>读取数据</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/account&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//获取所有的账单信息</span></span><br><span class="line">  <span class="comment">// let accounts = db.get(&#x27;accounts&#x27;).value();</span></span><br><span class="line">  <span class="comment">//读取集合信息</span></span><br><span class="line">  AccountModel.find().sort(&#123;<span class="attr">time</span>: -<span class="number">1</span>&#125;).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">&#x27;读取失败~~~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//响应成功的提示</span></span><br><span class="line">    res.render(<span class="string">&#x27;list&#x27;</span>, &#123;<span class="attr">accounts</span>: data, <span class="attr">moment</span>: moment&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>删除</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">router.get(<span class="string">&#x27;/account/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取 params 的 id 参数</span></span><br><span class="line">  <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">  <span class="comment">//删除</span></span><br><span class="line">  AccountModel.deleteOne(&#123;<span class="attr">_id</span>: id&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">&#x27;删除失败~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提醒</span></span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;删除成功~~~&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/account&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:3000/account">http://localhost:3000/account</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842607.png" alt="image-20230903124623165" style="zoom:80%;" />

<h2 id="十一、接口"><a href="#十一、接口" class="headerlink" title="十一、接口"></a>十一、接口</h2><h3 id="1、接口介绍"><a href="#1、接口介绍" class="headerlink" title="1、接口介绍"></a>1、接口介绍</h3><p>接口的英文单词是 API (Application Program Interface)，所以有时也称之为 API 接口，接口是 前后端通信的桥梁。简单理解：一个接口就是 服务中的一个路由规则 ，根据请求响应结果。</p>
<p>一个接口一般由如下几个部分组成：</p>
<ul>
<li><p>请求方法</p>
</li>
<li><p>接口地址（URL）</p>
</li>
<li><p>请求参数</p>
</li>
<li><p>响应结果</p>
</li>
</ul>
<p>一个接口示例 <a target="_blank" rel="noopener" href="https://www.free-api.com/doc/325">https://www.free-api.com/doc/325</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842608.png" alt="image-20230901223807217" style="zoom:80%;" />



<h3 id="2、RESTful-API"><a href="#2、RESTful-API" class="headerlink" title="2、RESTful API"></a>2、RESTful API</h3><p>RESTful API 是一种特殊风格的接口，主要特点有如下几个：</p>
<ul>
<li><p>URL 中的路径表示 资源 ，路径中不能有 动词 ，例如 create , delete , update 等这些都不能有</p>
</li>
<li><p>操作资源要与 HTTP 请求方法 对应</p>
</li>
<li><p>操作结果要与 HTTP 响应状态码 对应</p>
</li>
</ul>
<p>规则示例：</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842609.png" alt="image-20230901224050106" style="zoom: 67%;" />

<blockquote>
<p>扩展阅读：<a target="_blank" rel="noopener" href="https://www.ruanyifeng.com/blog/2014/05/restful_api.html">https://www.ruanyifeng.com/blog/2014/05/restful_api.html</a></p>
</blockquote>
<h3 id="3、json-server"><a href="#3、json-server" class="headerlink" title="3、json-server"></a>3、json-server</h3><p>json-server 本身是一个 JS 编写的工具包，可以快速搭建 RESTful API 服务<br>官方地址: <a target="_blank" rel="noopener" href="https://github.com/typicode/json-server">https://github.com/typicode/json-server</a><br>操作步骤：</p>
<ol>
<li><p>全局安装 json-server</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i -g <span class="type">json</span>-<span class="keyword">server</span></span><br></pre></td></tr></table></figure></li>
<li><p>创建 JSON 文件（db.json），编写基本结构</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;song&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">1</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;干杯&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;singer&quot;</span>: <span class="string">&quot;五月天&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">2</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;当&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;singer&quot;</span>: <span class="string">&quot;动力火车&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">3</span>,</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;不能说的秘密&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;singer&quot;</span>: <span class="string">&quot;Jay&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;name&quot;</span>: <span class="string">&quot;双节棍&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;singer&quot;</span>: <span class="string">&quot;Jay&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;id&quot;</span>: <span class="number">4</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;user&quot;</span>: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p>以 JSON 文件所在文件夹作为工作目录 ，执行如下命令</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">json</span>-<span class="keyword">server</span> <span class="comment">--watch db.json</span></span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight livecodeserver"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">http</span>://localhost:<span class="number">3000</span>/song</span><br><span class="line"><span class="keyword">http</span>://localhost:<span class="number">3000</span>/user</span><br><span class="line">   </span><br><span class="line">Home</span><br><span class="line"><span class="keyword">http</span>://localhost:<span class="number">3000</span></span><br><span class="line">   </span><br><span class="line">Type s + enter <span class="keyword">at</span> <span class="keyword">any</span> <span class="built_in">time</span> <span class="built_in">to</span> <span class="built_in">create</span> <span class="keyword">a</span> snapshot <span class="keyword">of</span> <span class="keyword">the</span> database</span><br><span class="line">Watching...</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:3000/song">http://localhost:3000/song</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842610.png" alt="image-20230903125600151" style="zoom:67%;" />

<p><a target="_blank" rel="noopener" href="http://localhost:3000/user">http://localhost:3000/user</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842611.png" alt="image-20230903125648101"></p>
</li>
</ol>
<h3 id="4、接口测试工具"><a href="#4、接口测试工具" class="headerlink" title="4、接口测试工具"></a>4、接口测试工具</h3><p>apipost <a target="_blank" rel="noopener" href="https://www.apipost.cn/">https://www.apipost.cn/</a> (中文)<br>apifox <a target="_blank" rel="noopener" href="https://www.apifox.cn/">https://www.apifox.cn/</a> (中文)<br>postman <a target="_blank" rel="noopener" href="https://www.postman.com/">https://www.postman.com/</a> (英文)</p>
<h3 id="5、案例实践——记账本结合API"><a href="#5、案例实践——记账本结合API" class="headerlink" title="5、案例实践——记账本结合API"></a>5、案例实践——记账本结合API</h3><p>删掉<code>/routes/users.js</code>文件，app.js中删掉</p>
<figure class="highlight ebnf"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">var usersRouter</span> = require(<span class="string">&#x27;./routes/users&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>路由改造</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842612.png" alt="image-20230903130855207"></p>
<p>account.js存放与账单相关的接口，增删改查</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="comment">//导入 moment</span></span><br><span class="line"><span class="keyword">const</span> moment = <span class="built_in">require</span>(<span class="string">&#x27;moment&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> AccountModel = <span class="built_in">require</span>(<span class="string">&#x27;../../models/AccountModel&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//记账本的列表</span></span><br><span class="line">router.get(<span class="string">&#x27;/account&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//获取所有的账单信息</span></span><br><span class="line">  <span class="comment">// let accounts = db.get(&#x27;accounts&#x27;).value();</span></span><br><span class="line">  <span class="comment">//读取集合信息</span></span><br><span class="line">  AccountModel.find().sort(&#123;<span class="attr">time</span>: -<span class="number">1</span>&#125;).exec(<span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;1001&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;读取失败~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//响应成功的提示</span></span><br><span class="line">    res.json(&#123;</span><br><span class="line">      <span class="comment">//响应编号</span></span><br><span class="line">      <span class="attr">code</span>:  <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">      <span class="comment">//响应的信息</span></span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;读取成功&#x27;</span>,</span><br><span class="line">      <span class="comment">//响应的数据</span></span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//新增记录</span></span><br><span class="line">router.post(<span class="string">&#x27;/account&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//表单验证</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">//插入数据库</span></span><br><span class="line">  AccountModel.create(&#123;</span><br><span class="line">    ...req.body,</span><br><span class="line">    <span class="comment">//修改 time 属性的值</span></span><br><span class="line">    <span class="attr">time</span>: moment(req.body.time).toDate()</span><br><span class="line">  &#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;1002&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;创建失败~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功提醒</span></span><br><span class="line">    res.json(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;创建成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: data</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//删除记录</span></span><br><span class="line">router.delete(<span class="string">&#x27;/account/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取 params 的 id 参数</span></span><br><span class="line">  <span class="keyword">let</span> id = req.params.id;</span><br><span class="line">  <span class="comment">//删除</span></span><br><span class="line">  AccountModel.deleteOne(&#123;<span class="attr">_id</span>: id&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err) &#123;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;1003&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;删除账单失败&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//提醒</span></span><br><span class="line">    res.json(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;删除成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: &#123;&#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取单个账单信息</span></span><br><span class="line">router.get(<span class="string">&#x27;/account/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取 id 参数</span></span><br><span class="line">  <span class="keyword">let</span> &#123;id&#125; = req.params;</span><br><span class="line">  <span class="comment">//查询数据库</span></span><br><span class="line">  AccountModel.findById(id, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;1004&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;读取失败~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//成功响应</span></span><br><span class="line">    res.json(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;读取成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: data  </span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//更新单个账单信息</span></span><br><span class="line">router.patch(<span class="string">&#x27;/account/:id&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取 id 参数值</span></span><br><span class="line">  <span class="keyword">let</span> &#123;id&#125; = req.params;</span><br><span class="line">  <span class="comment">//更新数据库</span></span><br><span class="line">  AccountModel.updateOne(&#123;<span class="attr">_id</span>: id&#125;, req.body, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;1005&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;更新失败~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//再次查询数据库 获取单条数据</span></span><br><span class="line">    AccountModel.findById(id, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span>(err)&#123;</span><br><span class="line">        <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">          <span class="attr">code</span>: <span class="string">&#x27;1004&#x27;</span>,</span><br><span class="line">          <span class="attr">msg</span>: <span class="string">&#x27;读取失败~~&#x27;</span>,</span><br><span class="line">          <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">//成功响应</span></span><br><span class="line">      res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;更新成功&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: data  </span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line">  &#125;);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 account 接口路由文件</span></span><br><span class="line"><span class="keyword">const</span> accountRouter = <span class="built_in">require</span>(<span class="string">&#x27;./routes/api/account&#x27;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">app.use(<span class="string">&#x27;/api&#x27;</span>, accountRouter);</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://127.0.0.1:3000/account%EF%BC%8C%E6%B3%A8%E6%84%8F%E8%BF%99%E9%87%8C%E8%AE%BF%E9%97%AEhttp://localhost:3000/api/account%E4%BC%9A%E6%8A%A5404%E9%94%99%E8%AF%AF%EF%BC%8C%E8%A6%81%E4%BD%BF%E7%94%A8ip%E8%AE%BF%E9%97%AE">http://127.0.0.1:3000/account，注意这里访问http://localhost:3000/api/account会报404错误，要使用ip访问</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842613.png" alt="image-20230903131848138" style="zoom:80%;" />

<p><a target="_blank" rel="noopener" href="http://127.0.0.1:3000/api/account">http://127.0.0.1:3000/api/account</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842614.png" alt="image-20230903131922473"></p>
<p>可以使用接口测试工具进行接口测试</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842615.png" alt="image-20230903132223459" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842616.png" alt="image-20230903132323396"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842617.png" alt="image-20230903132427651"></p>
<h2 id="十二、会话控制"><a href="#十二、会话控制" class="headerlink" title="十二、会话控制"></a>十二、会话控制</h2><p>HTTP 是一种无状态的协议，它没有办法区分多次的请求是否来自于同一个客户端， 无法区分用户，而产品中又大量存在的这样的需求，所以需要通过 会话控制 来解决该问题，常见的会话控制技术有三种：cookie、session、token</p>
<h3 id="1、cookie"><a href="#1、cookie" class="headerlink" title="1、cookie"></a>1、cookie</h3><h4 id="1-1-cookie介绍"><a href="#1-1-cookie介绍" class="headerlink" title="1.1 cookie介绍"></a>1.1 cookie介绍</h4><p>cookie 是 HTTP 服务器发送到用户浏览器并保存在本地的一小块数据，<code>cookie 是保存在浏览器端的一小块数据</code>，<code>cookie 是按照域名划分保存的</code>。可以将 cookie 理解为一个 HTTP 的请求头。</p>
<h4 id="1-2-浏览器操作cookie"><a href="#1-2-浏览器操作cookie" class="headerlink" title="1.2 浏览器操作cookie"></a>1.2 浏览器操作cookie</h4><p>浏览器操作 cookie 的操作，使用相对较少，了解即可</p>
<ol>
<li>禁用所有 cookie</li>
<li>删除 cookie</li>
<li>查看 cookie</li>
</ol>
<h4 id="1-3-express中操作cookie"><a href="#1-3-express中操作cookie" class="headerlink" title="1.3 express中操作cookie"></a>1.3 express中操作cookie</h4><p>express 中可以使用 cookie-parser 进行处理</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> express =<span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//1. 安装 cookie-parser npm i cookie-parser</span></span><br><span class="line"><span class="comment">//2. 引入 cookieParser 包</span></span><br><span class="line"><span class="keyword">const</span> cookieParser = <span class="built_in">require</span>(<span class="string">&#x27;cookie-parser&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//3. 设置 cookieParser 中间件</span></span><br><span class="line">app.use(cookieParser());</span><br><span class="line"><span class="comment">//4-1 设置 cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/set-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 不带时效性</span></span><br><span class="line">    response.cookie(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>);</span><br><span class="line">    <span class="comment">// 带时效性</span></span><br><span class="line">    response.cookie(<span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;23123456@qq.com&#x27;</span>, &#123;<span class="attr">maxAge</span>: <span class="number">5</span>*<span class="number">60</span>*<span class="number">1000</span> &#125;);</span><br><span class="line">    <span class="comment">//响应</span></span><br><span class="line">    response.send(<span class="string">&#x27;Cookie的设置&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4-2 读取 cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/get-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取 cookie</span></span><br><span class="line">    <span class="built_in">console</span>.log(request.cookies);</span><br><span class="line">    <span class="comment">//响应体</span></span><br><span class="line">    response.send(<span class="string">&#x27;Cookie的读取&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4-3 删除cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/delete-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    response.clearCookie(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">    <span class="comment">//响应</span></span><br><span class="line">    response.send(<span class="string">&#x27;cookie 的清除&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="comment">//4. 启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>, <span class="function">() =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;服务已经启动....&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<p>（1）express中设置cookie</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4-1 设置 cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/set-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// 不带时效性</span></span><br><span class="line">    response.cookie(<span class="string">&#x27;username&#x27;</span>,<span class="string">&#x27;wangwu&#x27;</span>);</span><br><span class="line">    <span class="comment">// 带时效性</span></span><br><span class="line">    response.cookie(<span class="string">&#x27;email&#x27;</span>,<span class="string">&#x27;23123456@qq.com&#x27;</span>, &#123;<span class="attr">maxAge</span>: <span class="number">5</span>*<span class="number">60</span>*<span class="number">1000</span> &#125;);</span><br><span class="line">    <span class="comment">//响应</span></span><br><span class="line">    response.send(<span class="string">&#x27;Cookie的设置&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>（2）express中读取cookie</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4-2 读取 cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/get-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//读取 cookie</span></span><br><span class="line">    <span class="built_in">console</span>.log(request.cookies);</span><br><span class="line">    <span class="comment">//响应体</span></span><br><span class="line">    response.send(<span class="string">&#x27;Cookie的读取&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>（3）express中删除cookie</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//4-3 删除cookie</span></span><br><span class="line">app.get(<span class="string">&#x27;/delete-cookie&#x27;</span>, <span class="function">(<span class="params">request, response</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//删除</span></span><br><span class="line">    response.clearCookie(<span class="string">&#x27;username&#x27;</span>);</span><br><span class="line">    <span class="comment">//响应</span></span><br><span class="line">    response.send(<span class="string">&#x27;cookie 的清除&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>



<h3 id="2、session"><a href="#2、session" class="headerlink" title="2、session"></a>2、session</h3><h4 id="2-1-session介绍"><a href="#2-1-session介绍" class="headerlink" title="2.1 session介绍"></a>2.1 session介绍</h4><p>session 是保存在服务器端的一块儿数据 ，保存当前访问用户的相关信息。session可以实现会话控制，识别用户的身份，快速获取当前用户的相关信息。</p>
<h4 id="2-2-session中间件配置"><a href="#2-2-session中间件配置" class="headerlink" title="2.2 session中间件配置"></a>2.2 session中间件配置</h4><p>安装express-session和connect-mongo</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm i express-<span class="keyword">session</span> <span class="keyword">connect</span>-mongo</span><br></pre></td></tr></table></figure>

<h4 id="2-3-express中操作session"><a href="#2-3-express中操作session" class="headerlink" title="2.3 express中操作session"></a>2.3 express中操作session</h4><p>express 中可以使用 express-session 对 session 进行操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express</span></span><br><span class="line"><span class="keyword">const</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="comment">//2. 引入 express-session  connect-mongo</span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br><span class="line"><span class="keyword">const</span> MongoStore = <span class="built_in">require</span>(<span class="string">&#x27;connect-mongo&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建应用对象</span></span><br><span class="line"><span class="keyword">const</span> app = express();</span><br><span class="line"><span class="comment">//3. 设置 session 的中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;sid&#x27;</span>,   <span class="comment">//设置cookie的name，默认值是：connect.sid</span></span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&#x27;yagote&#x27;</span>, <span class="comment">//参与加密的字符串（又称签名）  加盐</span></span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">//是否为每次请求都设置一个cookie用来存储session的id</span></span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">true</span>,  <span class="comment">//是否在每次请求时重新保存session</span></span><br><span class="line">  <span class="attr">store</span>: MongoStore.create(&#123;</span><br><span class="line">    <span class="attr">mongoUrl</span>: <span class="string">&#x27;mongodb://127.0.0.1:27017/bilibili&#x27;</span> <span class="comment">//数据库的连接配置</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">cookie</span>: &#123;</span><br><span class="line">    <span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="comment">// 开启后前端无法通过 JS 操作</span></span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">5</span> <span class="comment">// 这一条 是控制 sessionID 的过期时间的！！！</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;))</span><br><span class="line"></span><br><span class="line"><span class="comment">//首页路由</span></span><br><span class="line">app.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  res.send(<span class="string">&#x27;home&#x27;</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//登录  session 的设置</span></span><br><span class="line">app.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// username=admin&amp;password=admin</span></span><br><span class="line">  <span class="keyword">if</span>(req.query.username === <span class="string">&#x27;admin&#x27;</span> &amp;&amp; req.query.password === <span class="string">&#x27;admin&#x27;</span>)&#123;</span><br><span class="line">    <span class="comment">//设置 session 信息</span></span><br><span class="line">    req.session.username = <span class="string">&#x27;admin&#x27;</span>;</span><br><span class="line">    req.session.uid = <span class="string">&#x27;258aefccc&#x27;</span>;</span><br><span class="line">    <span class="comment">//成功响应</span></span><br><span class="line">    res.send(<span class="string">&#x27;登录成功&#x27;</span>);</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;登录失败~~&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//session 的读取</span></span><br><span class="line">app.get(<span class="string">&#x27;/cart&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//检测 session 是否存在用户数据</span></span><br><span class="line">  <span class="keyword">if</span>(req.session.username)&#123;</span><br><span class="line">    res.send(<span class="string">`购物车页面, 欢迎您 <span class="subst">$&#123;req.session.username&#125;</span>`</span>)</span><br><span class="line">  &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    res.send(<span class="string">&#x27;您还没有登录~~&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//session 的销毁</span></span><br><span class="line">app.get(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  req.session.destroy(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.send(<span class="string">&#x27;退出成功~~&#x27;</span>);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">//启动服务</span></span><br><span class="line">app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:3000/login?username=admin&amp;password=admin">http://localhost:3000/login?username=admin&amp;password=admin</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842618.png" alt="image-20230903162028574"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842619.png" alt="image-20230903162053018"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/cart">http://localhost:3000/cart</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842620.png" alt="image-20230903162135282"></p>
<p><a target="_blank" rel="noopener" href="http://localhost:3000/logout">http://localhost:3000/logout</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842621.png" alt="image-20230903162208605"></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842622.png" alt="image-20230903162219872" style="zoom:80%;" />

<p><a target="_blank" rel="noopener" href="http://localhost:3000/cart">http://localhost:3000/cart</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842623.png" alt="image-20230903162247076"></p>
<h4 id="2-4-session和cookie的区别"><a href="#2-4-session和cookie的区别" class="headerlink" title="2.4 session和cookie的区别"></a>2.4 session和cookie的区别</h4><p>cookie 和 session 的区别主要有如下几点：</p>
<ol>
<li>存在的位置<br>cookie：浏览器端<br>session：服务端</li>
<li>安全性<br>cookie 是以明文的方式存放在客户端的，安全性相对较低<br>session 存放于服务器中，所以安全性 相对 较好</li>
<li>网络传输量<br>cookie 设置内容过多会增大报文体积， 会影响传输效率<br>session 数据存储在服务器，只是通过 cookie 传递 id，所以不影响传输效率</li>
<li>存储限制<br>浏览器限制单个 cookie 保存的数据不能超过 4K ，且单个域名下的存储数量也有限制<br>session 数据存储在服务器中，所以没有这些限制</li>
</ol>
<h3 id="3、token"><a href="#3、token" class="headerlink" title="3、token"></a>3、token</h3><p>token 是服务端生成并返回给 HTTP 客户端的一串加密字符串， token 中保存着用户信息。</p>
<p>作用：实现会话控制，可以识别用户的身份，主要用于移动端 APP</p>
<p>特点：</p>
<ul>
<li>服务端压力更小<ul>
<li>数据存储在客户端</li>
</ul>
</li>
<li>相对更安全<ul>
<li>数据加密</li>
<li>可以避免 CSRF（跨站请求伪造）</li>
</ul>
</li>
<li>扩展性更强<ul>
<li>服务间可以共享</li>
<li>增加服务节点更简单</li>
</ul>
</li>
</ul>
<h3 id="4、jwt"><a href="#4、jwt" class="headerlink" title="4、jwt"></a>4、jwt</h3><p>JWT（JSON Web Token ）是目前最流行的跨域认证解决方案，可用于基于 <code>token</code> 的身份验证。JWT 使 token 的生成与校验更规范，可以使用 <code>jsonwebtoken</code>包来操作token</p>
<figure class="highlight coffeescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">npm</span> i jsonwebtoken</span><br></pre></td></tr></table></figure>

<p>生成token</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建(生成) token </span></span><br><span class="line"><span class="comment">//let token = jwt.sign(用户数据, 加密字符串, 配置对象);</span></span><br><span class="line"><span class="keyword">let</span> token = jwt.sign(&#123;</span><br><span class="line">  <span class="attr">username</span>: <span class="string">&#x27;zhangsan&#x27;</span></span><br><span class="line">&#125;, <span class="string">&#x27;yagote&#x27;</span>, &#123;</span><br><span class="line">  <span class="attr">expiresIn</span>: <span class="number">60</span>, <span class="comment">//设置token有效时间60秒</span></span><br><span class="line">&#125;)</span><br><span class="line"><span class="built_in">console</span>.log(token);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9</span>.eyJ<span class="number">1</span>c<span class="number">2</span>VybmFtZSI<span class="number">6</span>InpoYW<span class="number">5</span>nc<span class="number">2</span>FuIiwiaWF<span class="number">0</span>IjoxNjkzNzI<span class="number">5</span>NzgzLCJleHAiOjE<span class="number">2</span>OTM<span class="number">3</span>Mjk<span class="number">4</span>NDN<span class="number">9</span>.XEkpbiTc<span class="number">7</span>GSFYgTMmOYcVp<span class="number">1</span>EKe<span class="number">7</span>brtbNfc<span class="number">5</span>nUItI-xc</span><br></pre></td></tr></table></figure>

<p>超过设置的token有效时间60秒后进行token校验</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//校验 token</span></span><br><span class="line"><span class="keyword">let</span> t = <span class="string">&#x27;eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJ1c2VybmFtZSI6InpoYW5nc2FuIiwiaWF0IjoxNjkzNzI5NzgzLCJleHAiOjE2OTM3Mjk4NDN9.XEkpbiTc7GSFYgTMmOYcVp1EKe7brtbNfc5nUItI-xc&#x27;</span>;</span><br><span class="line">jwt.verify(t, <span class="string">&#x27;yagote&#x27;</span>, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">if</span>(err)&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">&#x27;校验失败~~&#x27;</span>);</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">console</span>.log(data);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">校验失败~~</span><br></pre></td></tr></table></figure>

<h3 id="5、案例实践——记账本结合会话控制"><a href="#5、案例实践——记账本结合会话控制" class="headerlink" title="5、案例实践——记账本结合会话控制"></a>5、案例实践——记账本结合会话控制</h3><p>从此处开始已经修改项目的端口3000为80端口了，在<code>bin/www</code>中设置</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 设置端口为80端口</span></span><br><span class="line"><span class="keyword">var</span> port = normalizePort(process.env.PORT || <span class="string">&#x27;80&#x27;</span>);</span><br><span class="line">app.set(<span class="string">&#x27;port&#x27;</span>, port);</span><br></pre></td></tr></table></figure>

<h4 id="5-1-注册登录"><a href="#5-1-注册登录" class="headerlink" title="5.1 注册登录"></a>5.1 注册登录</h4><p>新建注册页面reg.ejs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">  &lt;title&gt;注册&lt;/title&gt;</span><br><span class="line">  &lt;link href=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css&quot; rel=&quot;stylesheet&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;col-xs-12 col-md-8 col-md-offset-2 col-lg-4 col-lg-offset-4&quot;&gt;</span><br><span class="line">        &lt;h2&gt;注册&lt;/h2&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        &lt;form method=&quot;post&quot; action=&quot;/reg&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;item&quot;&gt;用户名&lt;/label&gt;</span><br><span class="line">            &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;item&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;time&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">            &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;time&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;hr&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-block&quot;&gt;注册&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>新建登录页面login.ejs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot; /&gt;</span><br><span class="line">  &lt;title&gt;登录&lt;/title&gt;</span><br><span class="line">  &lt;link href=&quot;https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.css&quot; rel=&quot;stylesheet&quot; /&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;div class=&quot;container&quot;&gt;</span><br><span class="line">    &lt;div class=&quot;row&quot;&gt;</span><br><span class="line">      &lt;div class=&quot;col-xs-12 col-md-8 col-md-offset-2 col-lg-4 col-lg-offset-4&quot;&gt;</span><br><span class="line">        &lt;h2&gt;登录&lt;/h2&gt;</span><br><span class="line">        &lt;hr /&gt;</span><br><span class="line">        &lt;form method=&quot;post&quot; action=&quot;/login&quot;&gt;</span><br><span class="line">          &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;item&quot;&gt;用户名&lt;/label&gt;</span><br><span class="line">            &lt;input name=&quot;username&quot; type=&quot;text&quot; class=&quot;form-control&quot; id=&quot;item&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;div class=&quot;form-group&quot;&gt;</span><br><span class="line">            &lt;label for=&quot;time&quot;&gt;密码&lt;/label&gt;</span><br><span class="line">            &lt;input name=&quot;password&quot; type=&quot;password&quot; class=&quot;form-control&quot; id=&quot;time&quot; /&gt;</span><br><span class="line">          &lt;/div&gt;</span><br><span class="line">          &lt;hr&gt;</span><br><span class="line">          &lt;button type=&quot;submit&quot; class=&quot;btn btn-primary btn-block&quot;&gt;登录&lt;/button&gt;</span><br><span class="line">        &lt;/form&gt;</span><br><span class="line">      &lt;/div&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">  &lt;/div&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line"></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>新建路由规则auth.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="comment">//导入 用户的模型</span></span><br><span class="line"><span class="keyword">const</span> UserModel = <span class="built_in">require</span>(<span class="string">&#x27;../../models/UserModel&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"><span class="comment">//注册</span></span><br><span class="line">router.get(<span class="string">&#x27;/reg&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//响应 HTML 内容</span></span><br><span class="line">  res.render(<span class="string">&#x27;auth/reg&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//注册用户</span></span><br><span class="line">router.post(<span class="string">&#x27;/reg&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//做表单验证</span></span><br><span class="line">  <span class="comment">//获取请求体的数据</span></span><br><span class="line">  UserModel.create(&#123;...req.body, <span class="attr">password</span>: md5(req.body.password)&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">&#x27;注册失败, 请稍后再试~~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;注册成功&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">  </span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">//登录页面</span></span><br><span class="line">router.get(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//响应 HTML 内容</span></span><br><span class="line">  res.render(<span class="string">&#x27;auth/login&#x27;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//登录操作</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取用户名和密码</span></span><br><span class="line">  <span class="keyword">let</span> &#123;username, password&#125; = req.body;</span><br><span class="line">  <span class="comment">//查询数据库</span></span><br><span class="line">  UserModel.findOne(&#123;<span class="attr">username</span>: username, <span class="attr">password</span>: md5(password)&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.status(<span class="number">500</span>).send(<span class="string">&#x27;登录, 请稍后再试~~&#x27;</span>);</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断 data</span></span><br><span class="line">    <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.send(<span class="string">&#x27;账号或密码错误~~&#x27;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//写入session</span></span><br><span class="line">    req.session.username = data.username;</span><br><span class="line">    req.session._id = data._id;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//登录成功响应</span></span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/account&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//销毁 session</span></span><br><span class="line">  req.session.destroy(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;退出成功&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>访问<a target="_blank" rel="noopener" href="http://127.0.0.1/reg">http://127.0.0.1/reg</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842624.png" alt="image-20230903182144298" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842625.png" alt="image-20230903182100817"></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842626.png" alt="image-20230903182326548" style="zoom:80%;" />

<p><a target="_blank" rel="noopener" href="http://127.0.0.1/login">http://127.0.0.1/login</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842627.png" alt="image-20230903181918184" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842628.png" alt="image-20230903182122251"></p>
<h4 id="5-2-写入session"><a href="#5-2-写入session" class="headerlink" title="5.2 写入session"></a>5.2 写入session</h4><p>app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 express-session </span></span><br><span class="line"><span class="keyword">const</span> session = <span class="built_in">require</span>(<span class="string">&quot;express-session&quot;</span>);</span><br></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//设置 session 的中间件</span></span><br><span class="line">app.use(session(&#123;</span><br><span class="line">  <span class="attr">name</span>: <span class="string">&#x27;sid&#x27;</span>,   <span class="comment">//设置cookie的name，默认值是：connect.sid</span></span><br><span class="line">  <span class="attr">secret</span>: <span class="string">&#x27;atguigu&#x27;</span>, <span class="comment">//参与加密的字符串（又称签名）  加盐</span></span><br><span class="line">  <span class="attr">saveUninitialized</span>: <span class="literal">false</span>, <span class="comment">//是否为每次请求都设置一个cookie用来存储session的id</span></span><br><span class="line">  <span class="attr">resave</span>: <span class="literal">true</span>,  <span class="comment">//是否在每次请求时重新保存session  20 分钟    4:00  4:20</span></span><br><span class="line">  <span class="attr">store</span>: MongoStore.create(&#123;</span><br><span class="line">    <span class="attr">mongoUrl</span>: <span class="string">`mongodb://<span class="subst">$&#123;DBHOST&#125;</span>:<span class="subst">$&#123;DBPORT&#125;</span>/<span class="subst">$&#123;DBNAME&#125;</span>`</span> <span class="comment">//数据库的连接配置</span></span><br><span class="line">  &#125;),</span><br><span class="line">  <span class="attr">cookie</span>: &#123;</span><br><span class="line">    <span class="attr">httpOnly</span>: <span class="literal">true</span>, <span class="comment">// 开启后前端无法通过 JS 操作</span></span><br><span class="line">    <span class="attr">maxAge</span>: <span class="number">1000</span> * <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span> <span class="comment">// 这一条 是控制 sessionID 的过期时间的！！！</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;))</span><br></pre></td></tr></table></figure>

<p>auth.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//写入session</span></span><br><span class="line">req.session.username = data.username;</span><br><span class="line">req.session._id = data._id;</span><br></pre></td></tr></table></figure>

<h4 id="5-3-登录检测"><a href="#5-3-登录检测" class="headerlink" title="5.3 登录检测"></a>5.3 登录检测</h4><p>创建中间件文件checkLoginMiddleware.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//检测登录的中间件</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//判断</span></span><br><span class="line">  <span class="keyword">if</span>(!req.session.username)&#123;</span><br><span class="line">    <span class="keyword">return</span> res.redirect(<span class="string">&#x27;/login&#x27;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  next();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入中间件检测登录</span></span><br><span class="line"><span class="keyword">const</span> checkLoginMiddleware = <span class="built_in">require</span>(<span class="string">&#x27;../../middlewares/checkLoginMiddleware&#x27;</span>);</span><br></pre></td></tr></table></figure>

<p>在每个请求的路径中添加checkLoginMiddleware</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842629.png" alt="image-20230903170250375"></p>
<p><a target="_blank" rel="noopener" href="http://127.0.0.1/account">http://127.0.0.1/account</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842630.png" alt="image-20230903182352511" style="zoom:80%;" />

<h4 id="5-4-退出登录"><a href="#5-4-退出登录" class="headerlink" title="5.4 退出登录"></a>5.4 退出登录</h4><p>auth.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//退出登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//销毁 session</span></span><br><span class="line">  req.session.destroy(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;退出成功&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>list.ejs</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;col-xs-12&quot;</span> <span class="attr">style</span>=<span class="string">&quot;padding-top: 20px&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">form</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span> <span class="attr">action</span>=<span class="string">&quot;/logout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;btn btn-danger&quot;</span>&gt;</span>退出<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>退出<a target="_blank" rel="noopener" href="http://127.0.0.1/logout">http://127.0.0.1/logout</a></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842631.png" alt="image-20230903182448582"></p>
<p>再次访问<a target="_blank" rel="noopener" href="http://127.0.0.1/account%E5%B0%B1%E8%BF%9B%E4%B8%8D%E5%8E%BB%E4%BA%86%EF%BC%8C%E4%BC%9A%E8%87%AA%E5%8A%A8%E8%B7%B3%E5%88%B0%E7%99%BB%E5%BD%95%E9%A1%B5%E9%9D%A2">http://127.0.0.1/account就进不去了，会自动跳到登录页面</a></p>
<h4 id="5-5-CSRF跨站请求伪造"><a href="#5-5-CSRF跨站请求伪造" class="headerlink" title="5.5 CSRF跨站请求伪造"></a>5.5 CSRF跨站请求伪造</h4><p>网站攻击的一种形式。某用户登录了A网站，认证信息保存在cookie中。当用户访问攻击者创建的B网站时，攻击者通过在B网站发送一个伪造的请求提交到A网站服务器上，让A网站服务器误以为请求来自于自己的网站，于是执行响应的操作，该用户的信息边遭到了篡改。</p>
<p>本项目解决 CSRF跨站请求的方法：将退出请求设置为post（5.4中已经设置好了）。</p>
<h4 id="5-6-首页与404页"><a href="#5-6-首页与404页" class="headerlink" title="5.6 首页与404页"></a>5.6 首页与404页</h4><p>首页配置，index.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//添加首页路由规则</span></span><br><span class="line">router.get(<span class="string">&#x27;/&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//重定向 /account</span></span><br><span class="line">  res.redirect(<span class="string">&#x27;/account&#x27;</span>);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>404配置，app.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// catch 404 and forward to error handler</span></span><br><span class="line">app.use(<span class="function"><span class="keyword">function</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="comment">//响应 404 </span></span><br><span class="line">  res.render(<span class="string">&#x27;404&#x27;</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>创建404.ejs</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html lang=&quot;en&quot;&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">  &lt;meta charset=&quot;UTF-8&quot;&gt;</span><br><span class="line">  &lt;title&gt;404&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">  &lt;h1&gt;404 NOT FOUND&lt;/h1&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://127.0.0.1/123">http://127.0.0.1/123</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842633.png" alt="image-20230903182554037" style="zoom:80%;" />

<h4 id="5-7-登录响应token"><a href="#5-7-登录响应token" class="headerlink" title="5.7 登录响应token"></a>5.7 登录响应token</h4><p>网页端的url已经进行了限制，但是api接口并没有进行限制，所以需要设置一下。在接口端创建auth.js文件</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842634.png" alt="image-20230903172412222" style="zoom:80%;" />

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> express = <span class="built_in">require</span>(<span class="string">&#x27;express&#x27;</span>);</span><br><span class="line"><span class="keyword">var</span> router = express.Router();</span><br><span class="line"><span class="comment">//导入 jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="comment">//导入配置文件</span></span><br><span class="line"><span class="keyword">const</span> &#123;secret&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../../config/config&#x27;</span>)</span><br><span class="line"><span class="comment">//导入 用户的模型</span></span><br><span class="line"><span class="keyword">const</span> UserModel = <span class="built_in">require</span>(<span class="string">&#x27;../../models/UserModel&#x27;</span>);</span><br><span class="line"><span class="keyword">const</span> md5 = <span class="built_in">require</span>(<span class="string">&#x27;md5&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//登录操作</span></span><br><span class="line">router.post(<span class="string">&#x27;/login&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取用户名和密码</span></span><br><span class="line">  <span class="keyword">let</span> &#123;username, password&#125; = req.body;</span><br><span class="line">  <span class="comment">//查询数据库</span></span><br><span class="line">  UserModel.findOne(&#123;<span class="attr">username</span>: username, <span class="attr">password</span>: md5(password)&#125;, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//判断</span></span><br><span class="line">    <span class="keyword">if</span>(err)&#123;</span><br><span class="line">      res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;2001&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;数据库读取失败~~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//判断 data</span></span><br><span class="line">    <span class="keyword">if</span>(!data)&#123;</span><br><span class="line">      <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;2002&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;用户名或密码错误~~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//创建当前用户的 token</span></span><br><span class="line">    <span class="keyword">let</span> token = jwt.sign(&#123;</span><br><span class="line">      <span class="attr">username</span>: data.username,</span><br><span class="line">      <span class="attr">_id</span>: data._id</span><br><span class="line">    &#125;, secret, &#123;</span><br><span class="line">      <span class="attr">expiresIn</span>: <span class="number">60</span> * <span class="number">60</span> * <span class="number">24</span> * <span class="number">7</span></span><br><span class="line">    &#125;);</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//响应 token</span></span><br><span class="line">    res.json(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;0000&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;登录成功&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: token</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//退出登录</span></span><br><span class="line">router.post(<span class="string">&#x27;/logout&#x27;</span>, <span class="function">(<span class="params">req, res</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//销毁 session</span></span><br><span class="line">  req.session.destroy(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">    res.render(<span class="string">&#x27;success&#x27;</span>, &#123;<span class="attr">msg</span>: <span class="string">&#x27;退出成功&#x27;</span>, <span class="attr">url</span>: <span class="string">&#x27;/login&#x27;</span>&#125;);</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = router;</span><br></pre></td></tr></table></figure>

<p>接口工具发送post请求<a target="_blank" rel="noopener" href="http://127.0.0.1/api/login">http://127.0.0.1/api/login</a></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202310011842635.png" alt="image-20230903183139637" style="zoom:80%;" />

<h4 id="5-8-token校验"><a href="#5-8-token校验" class="headerlink" title="5.8 token校验"></a>5.8 token校验</h4><p>创建中间件checkTokenMiddleware.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="comment">//读取配置项</span></span><br><span class="line"><span class="keyword">const</span> &#123;secret&#125; = <span class="built_in">require</span>(<span class="string">&#x27;../config/config&#x27;</span>);</span><br><span class="line"><span class="comment">//声明中间件</span></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function">(<span class="params">req, res, next</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">//获取 token</span></span><br><span class="line">  <span class="keyword">let</span> token = req.get(<span class="string">&#x27;token&#x27;</span>);</span><br><span class="line">  <span class="comment">//判断</span></span><br><span class="line">  <span class="keyword">if</span> (!token) &#123;</span><br><span class="line">    <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">      <span class="attr">code</span>: <span class="string">&#x27;2003&#x27;</span>,</span><br><span class="line">      <span class="attr">msg</span>: <span class="string">&#x27;token 缺失&#x27;</span>,</span><br><span class="line">      <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">//校验 token</span></span><br><span class="line">  jwt.verify(token, secret, <span class="function">(<span class="params">err, data</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">//检测 token 是否正确</span></span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">      <span class="keyword">return</span> res.json(&#123;</span><br><span class="line">        <span class="attr">code</span>: <span class="string">&#x27;2004&#x27;</span>,</span><br><span class="line">        <span class="attr">msg</span>: <span class="string">&#x27;token 校验失败~~&#x27;</span>,</span><br><span class="line">        <span class="attr">data</span>: <span class="literal">null</span></span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//保存用户的信息</span></span><br><span class="line">    req.user = data; <span class="comment">// req.session  req.body</span></span><br><span class="line">    <span class="comment">//如果 token 校验成功</span></span><br><span class="line">    next();</span><br><span class="line">  &#125;);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>account.js</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//导入 jwt</span></span><br><span class="line"><span class="keyword">const</span> jwt = <span class="built_in">require</span>(<span class="string">&#x27;jsonwebtoken&#x27;</span>);</span><br><span class="line"><span class="comment">//导入中间件</span></span><br><span class="line"><span class="keyword">let</span> checkTokenMiddleware = <span class="built_in">require</span>(<span class="string">&#x27;../../middlewares/checkTokenMiddleware&#x27;</span>);</span><br></pre></td></tr></table></figure>



<h2 id="十三、项目上线"><a href="#十三、项目上线" class="headerlink" title="十三、项目上线"></a>十三、项目上线</h2><p>【这个项目是基于express的项目】</p>
<p>1、上次远程仓库</p>
<p>2、部署服务器</p>
<p>3、购买域名及解析</p>
<p>4、配置HTTPS证书</p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://yagote.github.io">虾壳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yagote.github.io/2023/10/01/nodejs/">http://yagote.github.io/2023/10/01/nodejs/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yagote.github.io" target="_blank">虾壳</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">教程</a><a class="post-meta__tags" href="/tags/NodeJS/">NodeJS</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/10/01/java-ji-chu/" title="Java基础"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Java基础</div></div></a></div><div class="next-post pull-right"><a href="/2023/10/01/react/" title="React"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">React</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/08/spring-data-jpa/" title="Spring Data JPA"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-08</div><div class="title">Spring Data JPA</div></div></a></div><div><a href="/2023/10/01/axios/" title="Axios"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-01</div><div class="title">Axios</div></div></a></div><div><a href="/2023/10/01/css/" title="CSS"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-10-01</div><div class="title">CSS</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81NodeJS%E6%A6%82%E8%BF%B0"><span class="toc-text">一、NodeJS概述</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81Buffer"><span class="toc-text">二、Buffer</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E5%BF%B5"><span class="toc-text">1、概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%89%B9%E7%82%B9"><span class="toc-text">2、特点</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-text">3、使用</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E5%88%9B%E5%BB%BABuffer"><span class="toc-text">3.1 创建Buffer</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-Buffer-%E4%B8%8E%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%9A%84%E8%BD%AC%E5%8C%96"><span class="toc-text">3.2 Buffer 与字符串的转化</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-Buffer-%E7%9A%84%E8%AF%BB%E5%86%99"><span class="toc-text">3.3 Buffer 的读写</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E6%BA%A2%E5%87%BA"><span class="toc-text">3.4 溢出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-5-%E4%B8%AD%E6%96%87"><span class="toc-text">3.5 中文</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81fs%E6%A8%A1%E5%9D%97"><span class="toc-text">三、fs模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%96%87%E4%BB%B6%E5%86%99%E5%85%A5"><span class="toc-text">2、文件写入</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-writeFile-%E5%BC%82%E6%AD%A5%E5%86%99%E5%85%A5"><span class="toc-text">2.1 writeFile 异步写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-writeFileSync-%E5%90%8C%E6%AD%A5%E5%86%99%E5%85%A5"><span class="toc-text">2.2  writeFileSync 同步写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-appendFile-appendFileSync-%E8%BF%BD%E5%8A%A0%E5%86%99%E5%85%A5"><span class="toc-text">2.3  appendFile &#x2F; appendFileSync 追加写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-createWriteStream-%E6%B5%81%E5%BC%8F%E5%86%99%E5%85%A5"><span class="toc-text">2.4 createWriteStream 流式写入</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%86%99%E5%85%A5%E6%96%87%E4%BB%B6%E7%9A%84%E5%9C%BA%E6%99%AF"><span class="toc-text">2.5 写入文件的场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="toc-text">3、文件读取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-readFile-%E5%BC%82%E6%AD%A5%E8%AF%BB%E5%8F%96"><span class="toc-text">3.1 readFile 异步读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-readFileSync-%E5%90%8C%E6%AD%A5%E8%AF%BB%E5%8F%96"><span class="toc-text">3.2 readFileSync 同步读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-createReadStream-%E6%B5%81%E5%BC%8F%E8%AF%BB%E5%8F%96"><span class="toc-text">3.3 createReadStream 流式读取</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">3.4 读取文件应用场景</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%96%87%E4%BB%B6%E7%A7%BB%E5%8A%A8%E4%B8%8E%E9%87%8D%E5%91%BD%E5%90%8D"><span class="toc-text">4、文件移动与重命名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%96%87%E4%BB%B6%E5%88%A0%E9%99%A4"><span class="toc-text">5、文件删除</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E6%96%87%E4%BB%B6%E5%A4%B9%E6%93%8D%E4%BD%9C"><span class="toc-text">6、文件夹操作</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-mkdir-%E5%88%9B%E5%BB%BA%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">6.1 mkdir 创建文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-readdir-%E8%AF%BB%E5%8F%96%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">6.2 readdir 读取文件夹</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-rmdir-%E5%88%A0%E9%99%A4%E6%96%87%E4%BB%B6%E5%A4%B9"><span class="toc-text">6.3 rmdir 删除文件夹</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E6%9F%A5%E7%9C%8B%E8%B5%84%E6%BA%90%E7%8A%B6%E6%80%81"><span class="toc-text">7、查看资源状态</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E4%B8%A4%E7%A7%8D%E8%B7%AF%E5%BE%84"><span class="toc-text">8、两种路径</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81-dirname"><span class="toc-text">9、__dirname</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81%E7%BB%83%E4%B9%A0"><span class="toc-text">10、练习</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81path%E6%A8%A1%E5%9D%97"><span class="toc-text">四、path模块</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81http%E6%A8%A1%E5%9D%97"><span class="toc-text">五、http模块</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81HTTP%E5%8D%8F%E8%AE%AE"><span class="toc-text">1、HTTP协议</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E6%A6%82%E5%BF%B5"><span class="toc-text">1.1 概念</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-HTTP-%E7%9A%84%E8%AF%B7%E6%B1%82%E8%A1%8C"><span class="toc-text">1.2 HTTP 的请求行</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-HTTP-%E8%AF%B7%E6%B1%82%E5%A4%B4"><span class="toc-text">1.3 HTTP 请求头</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-4-HTTP-%E7%9A%84%E8%AF%B7%E6%B1%82%E4%BD%93"><span class="toc-text">1.4 HTTP 的请求体</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-5-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87%E7%9A%84%E7%BB%84%E6%88%90"><span class="toc-text">1.5 响应报文的组成</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-6-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%9F%A5%E7%9C%8BHTTP%E6%8A%A5%E6%96%87"><span class="toc-text">1.6 浏览器查看HTTP报文</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%88%9B%E5%BB%BA-HTTP-%E6%9C%8D%E5%8A%A1"><span class="toc-text">2、创建 HTTP 服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%93%8D%E4%BD%9C%E6%AD%A5%E9%AA%A4"><span class="toc-text">2.1 操作步骤</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%B5%8B%E8%AF%95"><span class="toc-text">2.2 测试</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="toc-text">2.3 注意事项</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E8%8E%B7%E5%8F%96-HTTP-%E8%AF%B7%E6%B1%82%E6%8A%A5%E6%96%87"><span class="toc-text">3、获取 HTTP 请求报文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%AE%BE%E7%BD%AE-HTTP-%E5%93%8D%E5%BA%94%E6%8A%A5%E6%96%87"><span class="toc-text">4、设置 HTTP 响应报文</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E6%9C%8D%E5%8A%A1"><span class="toc-text">5、静态资源服务</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E7%BD%91%E9%A1%B5%E4%B8%AD%E7%9A%84-URL"><span class="toc-text">5.1 网页中的 URL</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-1-%E7%BB%9D%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-text">5.1.1 绝对路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-2-%E7%9B%B8%E5%AF%B9%E8%B7%AF%E5%BE%84"><span class="toc-text">5.1.2 相对路径</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-1-3-%E7%BD%91%E9%A1%B5%E4%B8%AD%E4%BD%BF%E7%94%A8-URL-%E7%9A%84%E5%9C%BA%E6%99%AF%E5%B0%8F%E7%BB%93"><span class="toc-text">5.1.3 网页中使用 URL 的场景小结</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E8%AE%BE%E7%BD%AE%E8%B5%84%E6%BA%90%E7%B1%BB%E5%9E%8B%EF%BC%88mime%E7%B1%BB%E5%9E%8B%EF%BC%89"><span class="toc-text">5.2 设置资源类型（mime类型）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-GET-%E5%92%8C-POST-%E8%AF%B7%E6%B1%82%E5%9C%BA%E6%99%AF%E5%B0%8F%E7%BB%93"><span class="toc-text">5.3  GET 和 POST 请求场景小结</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81GET%E5%92%8CPOST%E8%AF%B7%E6%B1%82%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">6、GET和POST请求的区别</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-text">六、模块化</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-1"><span class="toc-text">1、介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E4%B8%8E%E6%A8%A1%E5%9D%97"><span class="toc-text">1.1 什么是模块化与模块 ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E4%BB%80%E4%B9%88%E6%98%AF%E6%A8%A1%E5%9D%97%E5%8C%96%E9%A1%B9%E7%9B%AE"><span class="toc-text">1.2 什么是模块化项目 ?</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-%E6%A8%A1%E5%9D%97%E5%8C%96%E5%A5%BD%E5%A4%84"><span class="toc-text">1.3 模块化好处</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A8%A1%E5%9D%97%E6%9A%B4%E9%9C%B2%E6%95%B0%E6%8D%AE"><span class="toc-text">2、模块暴露数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E6%A8%A1%E5%9D%97%E5%88%9D%E4%BD%93%E9%AA%8C"><span class="toc-text">2.1 模块初体验</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9A%B4%E9%9C%B2%E6%95%B0%E6%8D%AE"><span class="toc-text">2.2 暴露数据</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%AF%BC%E5%85%A5%EF%BC%88%E5%BC%95%E5%85%A5%EF%BC%89%E6%A8%A1%E5%9D%97"><span class="toc-text">3、导入（引入）模块</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AF%BC%E5%85%A5%E6%A8%A1%E5%9D%97%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%B5%81%E7%A8%8B"><span class="toc-text">4、导入模块的基本流程</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81CommonJS-%E8%A7%84%E8%8C%83"><span class="toc-text">5、CommonJS 规范</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E5%8C%85%E7%AE%A1%E7%90%86%E5%B7%A5%E5%85%B7"><span class="toc-text">七、包管理工具</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81npm%E5%88%9D%E5%A7%8B%E5%8C%96"><span class="toc-text">1、npm初始化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81npm%E6%90%9C%E7%B4%A2%E5%8C%85"><span class="toc-text">2、npm搜索包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%BC%80%E5%8F%91%E4%BE%9D%E8%B5%96%E4%B8%8E%E7%94%9F%E4%BA%A7%E4%BE%9D%E8%B5%96"><span class="toc-text">3、开发依赖与生产依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%85%A8%E5%B1%80%E5%AE%89%E8%A3%85"><span class="toc-text">4、全局安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81npm%E5%AE%89%E8%A3%85%E6%8C%87%E5%AE%9A%E7%89%88%E6%9C%AC%E7%9A%84%E5%8C%85"><span class="toc-text">5、npm安装指定版本的包</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E5%88%A0%E9%99%A4%E4%BE%9D%E8%B5%96"><span class="toc-text">6、删除依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E9%85%8D%E7%BD%AE%E5%91%BD%E4%BB%A4%E5%88%AB%E5%90%8D"><span class="toc-text">7、配置命令别名</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81cnpm"><span class="toc-text">8、cnpm</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E9%85%8D%E7%BD%AE%E6%B7%98%E5%AE%9D%E9%95%9C%E5%83%8F"><span class="toc-text">9、配置淘宝镜像</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81yarn%E4%BB%8B%E7%BB%8D"><span class="toc-text">10、yarn介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81npm%E7%AE%A1%E7%90%86%E5%8F%91%E5%B8%83%E5%8C%85"><span class="toc-text">11、npm管理发布包</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-%E5%88%9B%E5%BB%BA%E4%B8%8E%E5%8F%91%E5%B8%83"><span class="toc-text">11.1 创建与发布</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-%E6%9B%B4%E6%96%B0%E5%8C%85"><span class="toc-text">11.2 更新包</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-%E5%88%A0%E9%99%A4%E5%8C%85"><span class="toc-text">11.3 删除包</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81nvm"><span class="toc-text">12、nvm</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81express%E6%A1%86%E6%9E%B6"><span class="toc-text">八、express框架</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%8B%E7%BB%8D-2"><span class="toc-text">1、介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%B5%8B%E8%AF%95%E4%BD%BF%E7%94%A8"><span class="toc-text">2、测试使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81express%E8%B7%AF%E7%94%B1"><span class="toc-text">3、express路由</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E8%B7%AF%E7%94%B1%E7%9A%84%E4%BD%BF%E7%94%A8"><span class="toc-text">3.1 路由的使用</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E5%8F%82%E6%95%B0"><span class="toc-text">3.2 获取请求参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E8%8E%B7%E5%8F%96%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0"><span class="toc-text">3.3 获取路由参数</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-4-%E8%B7%AF%E7%94%B1%E5%8F%82%E6%95%B0%E7%BB%83%E4%B9%A0"><span class="toc-text">3.4 路由参数练习</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81express-%E5%93%8D%E5%BA%94%E8%AE%BE%E7%BD%AE"><span class="toc-text">4、express 响应设置</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81express%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">5、express中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E4%BB%8B%E7%BB%8D"><span class="toc-text">5.1 介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">5.2 全局中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E5%A4%9A%E4%B8%AA%E5%85%A8%E5%B1%80%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">5.3 多个全局中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E8%B7%AF%E7%94%B1%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">5.4 路由中间件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E9%9D%99%E6%80%81%E8%B5%84%E6%BA%90%E4%B8%AD%E9%97%B4%E4%BB%B6"><span class="toc-text">5.5 静态资源中间件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-1-%E5%9F%BA%E6%9C%AC%E4%BD%BF%E7%94%A8"><span class="toc-text">5.5.1 基本使用</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#5-5-2-%E6%A1%88%E4%BE%8B%E7%BB%83%E4%B9%A0"><span class="toc-text">5.5.2 案例练习</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81%E8%8E%B7%E5%8F%96%E8%AF%B7%E6%B1%82%E4%BD%93%E6%95%B0%E6%8D%AE"><span class="toc-text">6、获取请求体数据</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E9%98%B2%E7%9B%97%E9%93%BE%E5%AE%9E%E8%B7%B5"><span class="toc-text">7、防盗链实践</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E8%B7%AF%E7%94%B1%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-text">8、路由模块化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81EJS%E6%A8%A1%E6%9D%BF%E5%BC%95%E6%93%8E"><span class="toc-text">9、EJS模板引擎</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#9-1-EJS%E4%BB%8B%E7%BB%8D"><span class="toc-text">9.1 EJS介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-2-EJS%E5%88%97%E8%A1%A8%E6%B8%B2%E6%9F%93"><span class="toc-text">9.2 EJS列表渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-3-EJS%E6%9D%A1%E4%BB%B6%E6%B8%B2%E6%9F%93"><span class="toc-text">9.3 EJS条件渲染</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-4-express%E4%B8%AD%E4%BD%BF%E7%94%A8EJS"><span class="toc-text">9.4 express中使用EJS</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81express-generator"><span class="toc-text">10、express-generator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#12%E3%80%81%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E8%AE%B0%E8%B4%A6%E6%9C%AC"><span class="toc-text">12、案例实践——记账本</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#12-1-%E6%94%B6%E5%85%A5%E4%B8%8E%E6%94%AF%E5%87%BA"><span class="toc-text">12.1 收入与支出</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-2-lowdb"><span class="toc-text">12.2 lowdb</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81MongoDB"><span class="toc-text">九、MongoDB</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-text">1、下载安装</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5"><span class="toc-text">2、核心概念</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%91%BD%E4%BB%A4%E8%A1%8C%E4%BA%A4%E4%BA%92"><span class="toc-text">3、命令行交互</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%95%B0%E6%8D%AE%E5%BA%93%E5%91%BD%E4%BB%A4"><span class="toc-text">3.1 数据库命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E9%9B%86%E5%90%88%E5%91%BD%E4%BB%A4"><span class="toc-text">3.2 集合命令</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%96%87%E6%A1%A3%E5%91%BD%E4%BB%A4"><span class="toc-text">3.3 文档命令</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-text">4、应用场景</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E3%80%81Mongoose"><span class="toc-text">十、Mongoose</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%A6%82%E8%BF%B0"><span class="toc-text">1、概述</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E4%BD%BF%E7%94%A8"><span class="toc-text">2、使用</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E5%88%9B%E5%BB%BA%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-text">3、创建新文档</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E5%AD%97%E6%AE%B5%E7%B1%BB%E5%9E%8B"><span class="toc-text">4、字段类型</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E5%AD%97%E6%AE%B5%E5%80%BC%E9%AA%8C%E8%AF%81"><span class="toc-text">5、字段值验证</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E5%BF%85%E5%A1%AB%E9%A1%B9"><span class="toc-text">5.1 必填项</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E9%BB%98%E8%AE%A4%E5%80%BC"><span class="toc-text">5.2  默认值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E6%9E%9A%E4%B8%BE%E5%80%BC"><span class="toc-text">5.3 枚举值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E5%94%AF%E4%B8%80%E5%80%BC"><span class="toc-text">5.4 唯一值</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-%E4%B8%BE%E4%BE%8B"><span class="toc-text">5.5 举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#6%E3%80%81CRUD"><span class="toc-text">6、CRUD</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#6-1-%E5%A2%9E%E5%8A%A0%E6%96%87%E6%A1%A3"><span class="toc-text">6.1 增加文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-2-%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3"><span class="toc-text">6.2 删除文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-3-%E6%9B%B4%E6%96%B0%E6%96%87%E6%A1%A3"><span class="toc-text">6.3 更新文档</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-4-%E8%AF%BB%E5%8F%96%E6%96%87%E6%A1%A3"><span class="toc-text">6.4 读取文档</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#7%E3%80%81%E6%9D%A1%E4%BB%B6%E6%8E%A7%E5%88%B6"><span class="toc-text">7、条件控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#7-1-%E8%BF%90%E7%AE%97%E7%AC%A6"><span class="toc-text">7.1 运算符</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-2-%E9%80%BB%E8%BE%91%E8%BF%90%E7%AE%97"><span class="toc-text">7.2 逻辑运算</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-3-%E6%AD%A3%E5%88%99%E5%8C%B9%E9%85%8D"><span class="toc-text">7.3 正则匹配</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-4-%E4%B8%BE%E4%BE%8B"><span class="toc-text">7.4 举例</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#8%E3%80%81%E4%B8%AA%E6%80%A7%E5%8C%96%E8%AF%BB%E5%8F%96"><span class="toc-text">8、个性化读取</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#8-1-%E5%AD%97%E6%AE%B5%E7%AD%9B%E9%80%89"><span class="toc-text">8.1 字段筛选</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-2-%E6%95%B0%E6%8D%AE%E6%8E%92%E5%BA%8F"><span class="toc-text">8.2 数据排序</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-3-%E6%95%B0%E6%8D%AE%E6%88%AA%E5%8F%96"><span class="toc-text">8.3 数据截取</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#9%E3%80%81%E4%BB%A3%E7%A0%81%E6%A8%A1%E5%9D%97%E5%8C%96"><span class="toc-text">9、代码模块化</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#10%E3%80%81MongoDB%E5%9B%BE%E5%BD%A2%E5%8C%96%E5%B7%A5%E5%85%B7"><span class="toc-text">10、MongoDB图形化工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#11%E3%80%81%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E8%AE%B0%E8%B4%A6%E6%9C%AC%E7%BB%93%E5%90%88%E6%95%B0%E6%8D%AE%E5%BA%93"><span class="toc-text">11、案例实践——记账本结合数据库</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#11-1-www%E6%96%87%E4%BB%B6"><span class="toc-text">11.1 www文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-2-%E5%88%9B%E5%BB%BA%E6%A8%A1%E5%9E%8B"><span class="toc-text">11.2 创建模型</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-3-CRUD"><span class="toc-text">11.3 CRUD</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%80%E3%80%81%E6%8E%A5%E5%8F%A3"><span class="toc-text">十一、接口</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%8E%A5%E5%8F%A3%E4%BB%8B%E7%BB%8D"><span class="toc-text">1、接口介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81RESTful-API"><span class="toc-text">2、RESTful API</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81json-server"><span class="toc-text">3、json-server</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E6%8E%A5%E5%8F%A3%E6%B5%8B%E8%AF%95%E5%B7%A5%E5%85%B7"><span class="toc-text">4、接口测试工具</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E8%AE%B0%E8%B4%A6%E6%9C%AC%E7%BB%93%E5%90%88API"><span class="toc-text">5、案例实践——记账本结合API</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%BA%8C%E3%80%81%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6"><span class="toc-text">十二、会话控制</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81cookie"><span class="toc-text">1、cookie</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-1-cookie%E4%BB%8B%E7%BB%8D"><span class="toc-text">1.1 cookie介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-2-%E6%B5%8F%E8%A7%88%E5%99%A8%E6%93%8D%E4%BD%9Ccookie"><span class="toc-text">1.2 浏览器操作cookie</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#1-3-express%E4%B8%AD%E6%93%8D%E4%BD%9Ccookie"><span class="toc-text">1.3 express中操作cookie</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81session"><span class="toc-text">2、session</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-session%E4%BB%8B%E7%BB%8D"><span class="toc-text">2.1 session介绍</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-session%E4%B8%AD%E9%97%B4%E4%BB%B6%E9%85%8D%E7%BD%AE"><span class="toc-text">2.2 session中间件配置</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-express%E4%B8%AD%E6%93%8D%E4%BD%9Csession"><span class="toc-text">2.3 express中操作session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-session%E5%92%8Ccookie%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-text">2.4 session和cookie的区别</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81token"><span class="toc-text">3、token</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81jwt"><span class="toc-text">4、jwt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E6%A1%88%E4%BE%8B%E5%AE%9E%E8%B7%B5%E2%80%94%E2%80%94%E8%AE%B0%E8%B4%A6%E6%9C%AC%E7%BB%93%E5%90%88%E4%BC%9A%E8%AF%9D%E6%8E%A7%E5%88%B6"><span class="toc-text">5、案例实践——记账本结合会话控制</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#5-1-%E6%B3%A8%E5%86%8C%E7%99%BB%E5%BD%95"><span class="toc-text">5.1 注册登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-2-%E5%86%99%E5%85%A5session"><span class="toc-text">5.2 写入session</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-3-%E7%99%BB%E5%BD%95%E6%A3%80%E6%B5%8B"><span class="toc-text">5.3 登录检测</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-4-%E9%80%80%E5%87%BA%E7%99%BB%E5%BD%95"><span class="toc-text">5.4 退出登录</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-5-CSRF%E8%B7%A8%E7%AB%99%E8%AF%B7%E6%B1%82%E4%BC%AA%E9%80%A0"><span class="toc-text">5.5 CSRF跨站请求伪造</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-6-%E9%A6%96%E9%A1%B5%E4%B8%8E404%E9%A1%B5"><span class="toc-text">5.6 首页与404页</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-7-%E7%99%BB%E5%BD%95%E5%93%8D%E5%BA%94token"><span class="toc-text">5.7 登录响应token</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-8-token%E6%A0%A1%E9%AA%8C"><span class="toc-text">5.8 token校验</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8D%81%E4%B8%89%E3%80%81%E9%A1%B9%E7%9B%AE%E4%B8%8A%E7%BA%BF"><span class="toc-text">十三、项目上线</span></a></li></ol></div></div></div></div></main><footer id="footer" style="background: black"><div id="footer-wrap"><div class="footer_custom_text">Copyright © 2021 - 2023 <a href="https://yagote.github.io/">虾壳</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>