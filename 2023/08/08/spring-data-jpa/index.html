<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>Spring Data JPA | 虾壳</title><meta name="author" content="虾壳"><meta name="copyright" content="虾壳"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="目录[TOC] 视频：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1JG41187Mk参考文档：https:&#x2F;&#x2F;www.ydlclass.com&#x2F;doc21xnv&#x2F;java&#x2F;third&#x2F;framework&#x2F;9%E3%80%81jpa&#x2F;相关笔记：https:&#x2F;&#x2F;moonkira.github.io&#x2F;code-learning-note&#x2F;#&#x2F;%E5%90%8E%E7%AB%AF%">
<meta property="og:type" content="article">
<meta property="og:title" content="Spring Data JPA">
<meta property="og:url" content="http://yagote.github.io/2023/08/08/spring-data-jpa/index.html">
<meta property="og:site_name" content="虾壳">
<meta property="og:description" content="目录[TOC] 视频：https:&#x2F;&#x2F;www.bilibili.com&#x2F;video&#x2F;BV1JG41187Mk参考文档：https:&#x2F;&#x2F;www.ydlclass.com&#x2F;doc21xnv&#x2F;java&#x2F;third&#x2F;framework&#x2F;9%E3%80%81jpa&#x2F;相关笔记：https:&#x2F;&#x2F;moonkira.github.io&#x2F;code-learning-note&#x2F;#&#x2F;%E5%90%8E%E7%AB%AF%">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://yagote.github.io/img/favicon.png">
<meta property="article:published_time" content="2023-08-08T15:25:59.000Z">
<meta property="article:modified_time" content="2023-09-30T15:35:53.766Z">
<meta property="article:author" content="虾壳">
<meta property="article:tag" content="教程">
<meta property="article:tag" content="Java">
<meta property="article:tag" content="JPA">
<meta property="article:tag" content="Spring Data JPA">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://yagote.github.io/img/favicon.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="http://yagote.github.io/2023/08/08/spring-data-jpa/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: false,
  },
  autoDarkmode: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: 'Spring Data JPA',
  isPost: true,
  isHome: false,
  isHighlightShrink: undefined,
  isToc: true,
  postUpdate: '2023-09-30 23:35:53'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script></head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/favicon.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">25</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">12</div></a></div><hr class="custom-hr"/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="not-top-img" id="page-header"><nav id="nav"><span id="blog-info"><a href="/" title="虾壳"><span class="site-name">虾壳</span></a></span><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 归档</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-heart"></i><span> 关于</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav></header><main class="layout" id="content-inner"><div id="post"><div id="post-info"><h1 class="post-title">Spring Data JPA</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2023-08-08T15:25:59.000Z" title="发表于 2023-08-08 23:25:59">2023-08-08</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2023-09-30T15:35:53.766Z" title="更新于 2023-09-30 23:35:53">2023-09-30</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/">Java</a><i class="fas fa-angle-right post-meta-separator"></i><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Java/Java%E6%95%99%E7%A8%8B/">Java教程</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">5.4k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>23分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Spring Data JPA"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"><i class="fa-solid fa-spinner fa-spin"></i></span></span></div></div></div><article class="post-content" id="article-container"><h2 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h2><p>[TOC]</p>
<p>视频：<a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1JG41187Mk">https://www.bilibili.com/video/BV1JG41187Mk</a><br>参考文档：<a target="_blank" rel="noopener" href="https://www.ydlclass.com/doc21xnv/java/third/framework/9%E3%80%81jpa/">https://www.ydlclass.com/doc21xnv/java/third/framework/9%E3%80%81jpa/</a><br>相关笔记：<a target="_blank" rel="noopener" href="https://moonkira.github.io/code-learning-note/#/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6/Spring-Data/Spring-Data-JPA">https://moonkira.github.io/code-learning-note/#/%E5%90%8E%E7%AB%AF%E6%A1%86%E6%9E%B6/Spring-Data/Spring-Data-JPA</a><br>其他笔记：<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_51308214/article/details/125165747">https://blog.csdn.net/qq_51308214/article/details/125165747</a></p>
<p>使用 Spring Data Repositories抽象的目的是减少 为各种持久性存储实现数据访问 所需的样板代码量。</p>
<h2 id="一、ORM"><a href="#一、ORM" class="headerlink" title="一、ORM"></a>一、ORM</h2><h3 id="1、什么是ORM"><a href="#1、什么是ORM" class="headerlink" title="1、什么是ORM"></a>1、什么是ORM</h3><p>ORM是对象关系映射（Object-Relational Mapping）的缩写，是一种编程技术，用于将面向对象的编程语言和关系型数据库之间建立起映射关系。</p>
<p>ORM就是建立实体类和数据库表之间的关系，从而达到操作实体类就相当于操作数据库表的目的。</p>
<h3 id="2、常见ORM框架"><a href="#2、常见ORM框架" class="headerlink" title="2、常见ORM框架"></a>2、常见ORM框架</h3><p>常见的orm框架：Mybatis（ibatis）、Hibernate、Jpa</p>
<h2 id="二、JPA"><a href="#二、JPA" class="headerlink" title="二、JPA"></a>二、JPA</h2><h3 id="1、什么是JPA"><a href="#1、什么是JPA" class="headerlink" title="1、什么是JPA"></a>1、什么是JPA</h3><p>JPA是一种规范，不是一种实现。</p>
<p>JPA的全称是Java Persistence API， 即Java 持久化API，是SUN公司推出的一套基于ORM的规范，内部是由一系列的接口和抽象类构成。</p>
<h3 id="2、JPA与Hibernate的关系"><a href="#2、JPA与Hibernate的关系" class="headerlink" title="2、JPA与Hibernate的关系"></a>2、JPA与Hibernate的关系</h3><p><strong>JPA规范本质上就是一种ORM规范</strong>，注意不是ORM框架——因为JPA并未提供ORM实现，它只是制订了一些规范，提供了一些编程的API接口，但具体实现则由服务厂商来提供实现。</p>
<p>JPA和Hibernate的关系就像JDBC和JDBC驱动的关系，JPA是规范，<strong>Hibernate除了作为ORM框架之外，它也是一种JPA实现。</strong></p>
<p><strong>如果使用JPA规范进行数据库操作，底层需要hibernate作为其实现类完成数据持久化工作。</strong></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302328746.png" alt="image-20230930232724066" style="zoom:80%;" />

<h2 id="三、JAP案例"><a href="#三、JAP案例" class="headerlink" title="三、JAP案例"></a>三、JAP案例</h2><h3 id="1、新建项目"><a href="#1、新建项目" class="headerlink" title="1、新建项目"></a>1、新建项目</h3><p>其实不用勾选spring web</p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302328685.png" alt="1691397672603" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302328322.png" alt="1691397738286"></p>
<p>application.yml</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql://192.168.159.130:3306/JPAStu?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="number">123456</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">jpa:</span></span><br><span class="line">    <span class="attr">show-sql:</span> <span class="literal">true</span> <span class="comment"># 显示SQL</span></span><br><span class="line">    <span class="attr">hibernate:</span></span><br><span class="line">      <span class="attr">ddl-auto:</span> <span class="string">create</span> <span class="comment"># 自动生成表</span></span><br></pre></td></tr></table></figure>

<p>ddl-auto属性用于设置自动表定义，可以实现自动在数据库中为我们创建一个表，表的结构会根据我们定义的实体类决定，它有4种</p>
<ul>
<li>create 启动时删数据库中的表，然后创建，退出时不删除数据表</li>
<li>create-drop 启动时删数据库中的表，然后创建，退出时删除数据表 如果表不存在报错</li>
<li>update 如果启动时表格式不一致则更新表，原有数据保留</li>
<li>validate 项目启动表结构进行校验 如果不一致则报错</li>
</ul>
<p>pom.xml</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringBoot整合Spring-Data-Jpa--&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-jpa<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">         <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>User</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span> <span class="comment">//表明这是实体类</span></span><br><span class="line"><span class="meta">@Table(name = &quot;user&quot;)</span>   <span class="comment">//对应哪张表</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span>    <span class="comment">//数据库中的id，对应属性中的id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>     <span class="comment">//生成策略，这里配置为自增</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span>  <span class="comment">//数据库中的username,对应属性中的username</span></span><br><span class="line">    String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;password&quot;)</span> <span class="comment">//数据库中的password,对应属性中的password</span></span><br><span class="line">    String password;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>启动</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302328101.png" alt="image-20230807212719476"></p>
<p>控制台打印输出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">drop</span> <span class="keyword">table</span> if <span class="keyword">exists</span> <span class="keyword">user</span></span><br><span class="line">Hibernate: <span class="keyword">create</span> <span class="keyword">table</span> <span class="keyword">user</span> (id <span class="type">integer</span> <span class="keyword">not</span> <span class="keyword">null</span> auto_increment, password <span class="type">varchar</span>(<span class="number">255</span>), username <span class="type">varchar</span>(<span class="number">255</span>), <span class="keyword">primary</span> key (id)) engine<span class="operator">=</span>InnoDB</span><br></pre></td></tr></table></figure>

<p>并会在数据库中新建一张表<code>user</code></p>
<img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302328213.png" alt="image-20230930232847227" style="zoom:80%;" />

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329407.png" alt="image-20230807212942864"></p>
<h3 id="2、访问数据库表"><a href="#2、访问数据库表" class="headerlink" title="2、访问数据库表"></a>2、访问数据库表</h3><h4 id="2-1-创建接口文件"><a href="#2-1-创建接口文件" class="headerlink" title="2.1 创建接口文件"></a>2.1 创建接口文件</h4><p>创建repository（或者dao）文件夹。创建接口UserRepository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>注意JpaRepository有两个泛型，前者是具体操作的对象实体，也就是对应的表，后者是ID的类型（主键的类型），接口中已经定义了比较常用的数据库操作。</p>
<h4 id="2-2-查找"><a href="#2-2-查找" class="headerlink" title="2.2 查找"></a>2.2 查找</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">UserRepository userRepository;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testQuery</span><span class="params">()</span> </span>&#123;</span><br><span class="line">   userRepository.findById(<span class="number">1</span>).ifPresent(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>先手动插入数据到user表中。这里需要注意把create策略改成update,因为create策略会删表中数据。</p>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jpa:</span></span><br><span class="line">  <span class="attr">show-sql:</span> <span class="literal">true</span> <span class="comment"># 显示SQL</span></span><br><span class="line">  <span class="attr">hibernate:</span></span><br><span class="line">    <span class="attr">ddl-auto:</span> <span class="string">update</span> </span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_<span class="number">0</span>_, user<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_<span class="number">0</span>_, user<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_ where user<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">User</span>(id=<span class="number">1</span>, username=yagote, password=<span class="number">123123</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-3-新增"><a href="#2-3-新增" class="headerlink" title="2.3 新增"></a>2.3 新增</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testAdd</span><span class="params">()</span></span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setUsername(<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">    user.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">    User saveUser = userRepository.save(user);		<span class="comment">//保存插入的数据</span></span><br><span class="line">    System.out.println(saveUser);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> <span class="keyword">user</span> (<span class="keyword">password</span>, username) <span class="keyword">values</span> (?, ?)</span><br><span class="line"><span class="keyword">User</span>(id=<span class="number">2</span>, username=yy, <span class="keyword">password</span>=<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329660.png" alt="1691455410548"></p>
<h4 id="2-4-删除"><a href="#2-4-删除" class="headerlink" title="2.4 删除"></a>2.4 删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testDel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    userRepository.deleteById(<span class="number">2</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329530.png" alt="1691455590308"></p>
<h4 id="2-5-分页查询"><a href="#2-5-分页查询" class="headerlink" title="2.5 分页查询"></a>2.5 分页查询</h4><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329125.png" alt="1691456063495"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testPageable</span><span class="params">()</span></span>&#123;	<span class="comment">//查询第2页，每页两条数据</span></span><br><span class="line">    userRepository.findAll(PageRequest.of(<span class="number">1</span>,<span class="number">1</span>)).forEach(System.out::println);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_, user<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_, user<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_ limit ?, ?</span><br><span class="line"><span class="attribute">Hibernate</span>: select count(user<span class="number">0</span>_.id) as col_<span class="number">0</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_</span><br><span class="line"><span class="attribute">User</span>(id=<span class="number">2</span>, username=tt, password=<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<h4 id="2-6-其他自带方法"><a href="#2-6-其他自带方法" class="headerlink" title="2.6 其他自带方法"></a>2.6 其他自带方法</h4><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329817.png" alt="1691456116576"></p>
<h2 id="四、方法命名规则查询"><a href="#四、方法命名规则查询" class="headerlink" title="四、方法命名规则查询"></a>四、方法命名规则查询</h2><p><strong>按照Spring Data JPA 定义的规则，查询方法以findBy开头，涉及条件查询时，条件的属性用条件关键字连接，要注意的是：条件属性首字母需大写。</strong>如。自定义根据用户名查询时定义的接口中的方法为findAllByUsername</p>
<p>举例一：使用用户名查询</p>
<p>UserRepository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">User</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="comment">//自定义查询</span></span><br><span class="line">    <span class="function">List&lt;User&gt; <span class="title">findAllByUsername</span><span class="params">(String str)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllByName</span><span class="params">()</span></span>&#123;</span><br><span class="line">    userRepository.findAllByUsername(<span class="string">&quot;yy&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_, user<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_, user<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_ where user<span class="number">0</span>_.username=?</span><br></pre></td></tr></table></figure>

<p>举例二：使用用户名和密码一起查询</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用用户名和密码一起查询</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findAllByUsernameAndPassword</span><span class="params">(String uname,String pwd)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testFindAllByUsernameAndPassword</span><span class="params">()</span></span>&#123;</span><br><span class="line">    userRepository.findAllByUsernameAndPassword(<span class="string">&quot;ww&quot;</span>,<span class="string">&quot;123&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_, user<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_, user<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_ where user<span class="number">0</span>_.username=? and user<span class="number">0</span>_.password=?</span><br></pre></td></tr></table></figure>

<blockquote>
<p>还有其他自定义方法不再举例。</p>
</blockquote>
<p>具体的关键字，使用方法和生产成SQL如下表所示</p>
<table>
<thead>
<tr>
<th>Keyword</th>
<th>Sample</th>
<th>JPQL</th>
</tr>
</thead>
<tbody><tr>
<td>And</td>
<td>findByLastnameAndFirstname</td>
<td>… where x.lastname = ?1 and x.firstname = ?2</td>
</tr>
<tr>
<td>Or</td>
<td>findByLastnameOrFirstname</td>
<td>… where x.lastname = ?1 or x.firstname = ?2</td>
</tr>
<tr>
<td>Is,Equals</td>
<td>findByFirstnameIs,findByFirstnameEquals</td>
<td>… where x.firstname = ?1</td>
</tr>
<tr>
<td>Between</td>
<td>findByStartDateBetween</td>
<td>… where x.startDate between ?1 and ?2</td>
</tr>
<tr>
<td>LessThan</td>
<td>findByAgeLessThan</td>
<td>… where x.age &lt; ?1</td>
</tr>
<tr>
<td>LessThanEqual</td>
<td>findByAgeLessThanEqual</td>
<td>… where x.age ⇐ ?1</td>
</tr>
<tr>
<td>GreaterThan</td>
<td>findByAgeGreaterThan</td>
<td>… where x.age &gt; ?1</td>
</tr>
<tr>
<td>GreaterThanEqual</td>
<td>findByAgeGreaterThanEqual</td>
<td>… where x.age &gt;= ?1</td>
</tr>
<tr>
<td>After</td>
<td>findByStartDateAfter</td>
<td>… where x.startDate &gt; ?1</td>
</tr>
<tr>
<td>Before</td>
<td>findByStartDateBefore</td>
<td>… where x.startDate &lt; ?1</td>
</tr>
<tr>
<td>IsNull</td>
<td>findByAgeIsNull</td>
<td>… where x.age is null</td>
</tr>
<tr>
<td>IsNotNull,NotNull</td>
<td>findByAge(Is)NotNull</td>
<td>… where x.age not null</td>
</tr>
<tr>
<td>Like</td>
<td>findByFirstnameLike</td>
<td>… where x.firstname like ?1</td>
</tr>
<tr>
<td>NotLike</td>
<td>findByFirstnameNotLike</td>
<td>… where x.firstname not like ?1</td>
</tr>
<tr>
<td>StartingWith</td>
<td>findByFirstnameStartingWith</td>
<td>… where x.firstname like ?1 (parameter bound with appended %)</td>
</tr>
<tr>
<td>EndingWith</td>
<td>findByFirstnameEndingWith</td>
<td>… where x.firstname like ?1 (parameter bound with prepended %)</td>
</tr>
<tr>
<td>Containing</td>
<td>findByFirstnameContaining</td>
<td>… where x.firstname like ?1 (parameter bound wrapped in %)</td>
</tr>
<tr>
<td>OrderBy</td>
<td>findByAgeOrderByLastnameDesc</td>
<td>… where x.age = ?1 order by x.lastname desc</td>
</tr>
<tr>
<td>Not</td>
<td>findByLastnameNot</td>
<td>… where x.lastname &lt;&gt; ?1</td>
</tr>
<tr>
<td>In</td>
<td>findByAgeIn(Collection ages)</td>
<td>… where x.age in ?1</td>
</tr>
<tr>
<td>NotIn</td>
<td>findByAgeNotIn(Collection age)</td>
<td>… where x.age not in ?1</td>
</tr>
<tr>
<td>TRUE</td>
<td>findByActiveTrue()</td>
<td>… where x.active = true</td>
</tr>
<tr>
<td>FALSE</td>
<td>findByActiveFalse()</td>
<td>… where x.active = false</td>
</tr>
<tr>
<td>IgnoreCase</td>
<td>findByFirstnameIgnoreCase</td>
<td>… where UPPER(x.firstame) = UPPER(?1)</td>
</tr>
</tbody></table>
<h2 id="五、使用JPQL的方式查询"><a href="#五、使用JPQL的方式查询" class="headerlink" title="五、使用JPQL的方式查询"></a>五、使用JPQL的方式查询</h2><blockquote>
<p>在接口UserRepository中定义查询</p>
</blockquote>
<p>使用Spring Data JPA提供的查询方法已经可以解决大部分的应用场景，但是对于某些业务来说，我们还需要灵活的构造查询条件，这时就可以使用@Query注解，结合JPQL的语句方式完成查询。</p>
<p><strong>@Query 注解</strong>的使用非常简单，只需在方法上面标注该注解，同时提供一个JPQL查询语句即可，注意：</p>
<ul>
<li><p>大多数情况下将*替换为别名</p>
</li>
<li><p>表名改为类名</p>
</li>
<li><p>字段名改为属性名</p>
</li>
<li><p>搭配注解@Query进行使用</p>
</li>
</ul>
<blockquote>
<p>所谓的JPQL查询：把原生的SQL语句中的表改为实体类名，字段名改为该类的属性名，记得使用注解@Query </p>
</blockquote>
<p>一般格式：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select 表别名 from 表名(实际为类名) 别名 where 别名.属性=&#x27;itlils&#x27;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> List&lt;User&gt; <span class="title">findUsers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<p><strong>实体类名的别名一定要有。</strong></p>
<h3 id="1、简单查询"><a href="#1、简单查询" class="headerlink" title="1、简单查询"></a>1、简单查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select u from User u&quot;)</span>    <span class="comment">//从实体类，查询，而不是表</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">findUsers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJPQL1</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.findUsers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: select user0_.id as id1_0_, user0_.password as password2_0_, user0_.username as username3_0_ <span class="keyword">from</span><span class="built_in"> user </span>user0_</span><br><span class="line">[User(<span class="attribute">id</span>=1, username= yy, <span class="attribute">password</span>=123), User(<span class="attribute">id</span>=2, <span class="attribute">username</span>=tt, <span class="attribute">password</span>=123), User(<span class="attribute">id</span>=3, <span class="attribute">username</span>=rr, <span class="attribute">password</span>=123), User(<span class="attribute">id</span>=4, <span class="attribute">username</span>=ee, <span class="attribute">password</span>=123), User(<span class="attribute">id</span>=5, <span class="attribute">username</span>=ww, <span class="attribute">password</span>=123)]</span><br></pre></td></tr></table></figure>

<h3 id="2、筛选条件"><a href="#2、筛选条件" class="headerlink" title="2、筛选条件"></a>2、筛选条件</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select u from User u where u.username=&#x27;ee&#x27;&quot;)</span></span><br><span class="line"><span class="function">User <span class="title">findByName</span><span class="params">()</span></span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJPQL2</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.findByName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_, user<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_, user<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_ where user<span class="number">0</span>_.username=&#x27;ee&#x27;</span><br><span class="line"><span class="attribute">User</span>(id=<span class="number">4</span>, username=ee, password=<span class="number">123</span>)</span><br></pre></td></tr></table></figure>

<h3 id="3、投影结果"><a href="#3、投影结果" class="headerlink" title="3、投影结果"></a>3、投影结果</h3><p>真实的业务当中，我们只想要表里某一些列。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Query(&quot;select u.id from User u&quot;)</span></span><br><span class="line"><span class="function">List&lt;Integer&gt; <span class="title">findAlluserID</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJPQL3</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.findAlluserID());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select user<span class="number">0</span>_.id as col_<span class="number">0</span>_<span class="number">0</span>_ from user user<span class="number">0</span>_<span class="meta"></span></span><br><span class="line"><span class="meta">[1, 2, 3, 4, 5]</span></span><br></pre></td></tr></table></figure>

<h3 id="4、聚合查询"><a href="#4、聚合查询" class="headerlink" title="4、聚合查询"></a>4、聚合查询</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//聚合查询</span></span><br><span class="line"><span class="meta">@Query(&quot;select count(u) from User u&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">findAllUsers</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//聚合查询</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJPQL4</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.findAllUsers());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight n1ql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">select</span> <span class="built_in">count</span>(user0_.id) <span class="keyword">as</span> col_0_0_ <span class="keyword">from</span> <span class="keyword">user</span> user0_</span><br><span class="line"><span class="number">5</span></span><br></pre></td></tr></table></figure>

<h3 id="5、传参"><a href="#5、传参" class="headerlink" title="5、传参"></a>5、传参</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传参，修改数据 一定加上@Modifying 注解</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="meta">@Transactional</span>      <span class="comment">//修改数据要添加事务注解</span></span><br><span class="line"><span class="meta">@Query(&quot;update User set username=?1 where id=?2&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateUsernameById</span><span class="params">(String name,Integer id)</span></span>;	<span class="comment">//返回受影响的行数</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//传参</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testJPQL5</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.updateUsernameById(<span class="string">&quot;yagote&quot;</span>,<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: update<span class="built_in"> user </span><span class="builtin-name">set</span> <span class="attribute">username</span>=? where <span class="attribute">id</span>=?</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329715.png" alt="1691461441890"></p>
<h2 id="六、使用原生SQL"><a href="#六、使用原生SQL" class="headerlink" title="六、使用原生SQL"></a>六、使用原生SQL</h2><p>太复杂的SQL，JPA搞不定那就使用原生的SQL，需要设置nativeQuery = true</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用原生SQL</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Query(value = &quot;update user set username = ?1 where id=?2&quot;,nativeQuery = true)</span>  <span class="comment">//这里的user是数据库中的表名，而不是类User</span></span><br><span class="line"><span class="meta">@Modifying</span></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">updateByNativeSQL</span><span class="params">(String name,<span class="keyword">int</span> id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//使用原生SQL</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testNativeSql</span><span class="params">()</span></span>&#123;</span><br><span class="line">    System.out.println(userRepository.updateByNativeSQL(<span class="string">&quot;yy&quot;</span>,<span class="number">1</span>));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight routeros"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: update<span class="built_in"> user </span><span class="builtin-name">set</span> username = ? where <span class="attribute">id</span>=?</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329713.png" alt="1691462335268"></p>
<h2 id="七、一对一关系"><a href="#七、一对一关系" class="headerlink" title="七、一对一关系"></a>七、一对一关系</h2><p>在实际开发中，比较常见的场景还有关联查询，也就是我们会在表中添加一个外键字段，而此外键字段又指向了另一个表中的数据，当我们查询数据时，可能会需要将关联数据也一并获取，比如我们想要查询某个用户的详细信息，一般用户简略信息会单独存放一个表，而用户详细信息会单独存放在另一个表中。</p>
<h3 id="1、实体类"><a href="#1、实体类" class="headerlink" title="1、实体类"></a>1、实体类</h3><p>Account</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;account&quot;)</span>     <span class="comment">//对应的数据库中表名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Account</span> </span>&#123;</span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span>   <span class="comment">//生成策略，这里配置为自增</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span>    <span class="comment">//对应表中id这一列</span></span><br><span class="line">    <span class="meta">@Id</span>     <span class="comment">//此属性为主键</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;username&quot;)</span>   <span class="comment">//对应表中username这一列</span></span><br><span class="line">    String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;password&quot;)</span>   <span class="comment">//对应表中password这一列</span></span><br><span class="line">    String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//一对一</span></span><br><span class="line">    <span class="meta">@JoinColumn(name = &quot;detail_id&quot;)</span>     <span class="comment">//外键</span></span><br><span class="line">    <span class="meta">@OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span> <span class="comment">//一对一关系，设置关联操作为ALL</span></span><br><span class="line">    AccountDetail detail;<span class="comment">//对象类型,也可以理解这里写哪个实体类,外键就指向哪个实体类的主键</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>注意这里已设置Account表中的外键为detail_id</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一对一</span></span><br><span class="line"><span class="meta">@JoinColumn(name = &quot;detail_id&quot;)</span>     <span class="comment">//外键</span></span><br><span class="line"><span class="meta">@OneToOne(fetch = FetchType.LAZY, cascade = CascadeType.ALL)</span> <span class="comment">//一对一关系，设置关联操作为ALL</span></span><br><span class="line">AccountDetail detail;<span class="comment">//对象类型,也可以理解这里写哪个实体类,外键就指向哪个实体类的主键</span></span><br></pre></td></tr></table></figure>

<p>这里的关联级别也是有多个,一般设置为all就行</p>
<ul>
<li>ALL：所有操作都进行关联操作</li>
<li>PERSIST：插入操作时才进行关联操作</li>
<li>REMOVE：删除操作时才进行关联操作</li>
<li>MERGE：修改操作时才进行关联操作</li>
</ul>
</blockquote>
<p>AccountDetail    </p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;account_details&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountDetail</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span><span class="comment">//还是设置一个自增主键</span></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;address&quot;)</span></span><br><span class="line">    String address;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;email&quot;)</span></span><br><span class="line">    String email;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;phone&quot;)</span></span><br><span class="line">    String phone;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(name = &quot;real_name&quot;)</span></span><br><span class="line">    String realName;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试：运行测试类任意方法，自动创建好两张表</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302329200.png" alt="1691463536122"></p>
<p>account表中的外键</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330943.png" alt="1691474669432"></p>
<h3 id="2、接口"><a href="#2、接口" class="headerlink" title="2、接口"></a>2、接口</h3><p>这里的接口只用创建一个即可，AccountRepository</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AccountRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Account</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、测试"><a href="#3、测试" class="headerlink" title="3、测试"></a>3、测试</h3><p>注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line">AccountRepository accountRepository;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-新增"><a href="#3-1-新增" class="headerlink" title="3.1 新增"></a>3.1 新增</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一对一关系:插入数据</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOnetoOne</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    Account account = <span class="keyword">new</span> Account();</span><br><span class="line">    account.setUsername(<span class="string">&quot;yagote&quot;</span>);</span><br><span class="line">    account.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">    AccountDetail accountDetail = <span class="keyword">new</span> AccountDetail();</span><br><span class="line">    accountDetail.setAddress(<span class="string">&quot;地球&quot;</span>);</span><br><span class="line">    accountDetail.setPhone(<span class="string">&quot;12341212341&quot;</span>);</span><br><span class="line">    accountDetail.setEmail(<span class="string">&quot;123@123.com&quot;</span>);</span><br><span class="line">    accountDetail.setRealName(<span class="string">&quot;yagote&quot;</span>);</span><br><span class="line"></span><br><span class="line">    account.setDetail(accountDetail);</span><br><span class="line"></span><br><span class="line">    Account save = accountRepository.save(account);</span><br><span class="line">    System.out.println(<span class="string">&quot;插入之后account id 为：&quot;</span>+save.getId()+<span class="string">&quot;accountDetail id&quot;</span>+save.getDetail().getId());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> account_details (address, email, phone, real_name) <span class="keyword">values</span> (?, ?, ?, ?)</span><br><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> account (detail_id, password, username) <span class="keyword">values</span> (?, ?, ?)</span><br><span class="line">插入之后account id 为：<span class="number">1</span>accountDetail id1</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330183.png" alt="1691472948785"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330540.png" alt="1691472963986"></p>
<h4 id="3-2-删除"><a href="#3-2-删除" class="headerlink" title="3.2 删除"></a>3.2 删除</h4><p>这里会级联删除</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一对一关系：级联删除</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToOneDel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    accountRepository.deleteById(<span class="number">1</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select account<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">0</span>_<span class="number">0</span>_, account<span class="number">0</span>_.detail_id as detail_i<span class="number">4</span>_<span class="number">0</span>_<span class="number">0</span>_, account<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">0</span>_<span class="number">0</span>_, account<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">0</span>_<span class="number">0</span>_ from account account<span class="number">0</span>_ where account<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: select accountdet<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">1</span>_<span class="number">0</span>_, accountdet<span class="number">0</span>_.address as address<span class="number">2</span>_<span class="number">1</span>_<span class="number">0</span>_, accountdet<span class="number">0</span>_.email as email<span class="number">3</span>_<span class="number">1</span>_<span class="number">0</span>_, accountdet<span class="number">0</span>_.phone as phone<span class="number">4</span>_<span class="number">1</span>_<span class="number">0</span>_, accountdet<span class="number">0</span>_.real_name as real_nam<span class="number">5</span>_<span class="number">1</span>_<span class="number">0</span>_ from account_details accountdet<span class="number">0</span>_ where accountdet<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: delete from account where id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: delete from account_details where id=?</span><br></pre></td></tr></table></figure>

<p>两张表的数据都删除了</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330804.png" alt="1691473080778"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330285.png" alt="1691473103498"></p>
<h2 id="八、一对多关系"><a href="#八、一对多关系" class="headerlink" title="八、一对多关系"></a>八、一对多关系</h2><p>实体 Author：作者（一端）。</p>
<p>实体 Article：文章（多端）。</p>
<p>Author 和 Article 是一对多关系(双向)。那么在JPA中，如何表示一对多的双向关联呢？</p>
<p>JPA使用@OneToMany和@ManyToOne来标识一对多的双向关联。<strong>一端(Author)使用@OneToMany，多端(Article)使用@ManyToOne。</strong></p>
<p>在JPA规范中，一对多的双向关系由多端(Article)来维护。就是说<strong>多端(Article)为关系维护端，负责关系的增删改查。一端(Author)则为关系被维护端，不能维护关系</strong>。</p>
<p>一端(Author)使用@OneToMany注释的<code>mappedBy=&quot;author&quot;</code>属性表明Author是关系被维护端。</p>
<p>多端(Article)使用@ManyToOne和@JoinColumn来注释属性 author，@ManyToOne表明Article是多端，@JoinColumn设置在article表中的关联字段(外键)。</p>
<h3 id="1、实体类-1"><a href="#1、实体类-1" class="headerlink" title="1、实体类"></a>1、实体类</h3><p>Author</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span>   <span class="comment">//表示这个类是一个实体类</span></span><br><span class="line"><span class="meta">@Table(name = &quot;author&quot;)</span>    <span class="comment">//对应的数据库中表名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Author</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;)</span></span><br><span class="line">    <span class="meta">@Id</span> <span class="comment">// 主键</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span> <span class="comment">// 自增长策略</span></span><br><span class="line">    <span class="keyword">private</span> Long id; <span class="comment">//id</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 20,name = &quot;name&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String name;<span class="comment">//姓名</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@OneToMany(mappedBy = &quot;author&quot;,cascade=CascadeType.ALL,fetch=FetchType.LAZY)</span></span><br><span class="line">    <span class="comment">//级联保存、更新、删除、刷新;延迟加载。当删除用户，会级联删除该用户的所有文章</span></span><br><span class="line">    <span class="comment">//拥有mappedBy注解的实体类为关系被维护端</span></span><br><span class="line">    <span class="comment">//mappedBy=&quot;author&quot;中的author是Article中的author属性</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Article&gt; articleList;<span class="comment">//文章列表</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Article</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Entity</span>   <span class="comment">//表示这个类是一个实体类</span></span><br><span class="line"><span class="meta">@Table(name = &quot;article&quot;)</span>    <span class="comment">//对应的数据库中表名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Article</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span> <span class="comment">// 自增长策略</span></span><br><span class="line">    <span class="meta">@Column(name = &quot;id&quot;, nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(nullable = false, length = 50)</span> <span class="comment">// 映射为字段，值不能为空</span></span><br><span class="line">    <span class="keyword">private</span> String title;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Lob</span>  <span class="comment">// 大对象，映射 MySQL 的 Long Text 类型</span></span><br><span class="line">    <span class="meta">@Basic(fetch = FetchType.LAZY)</span> <span class="comment">// 懒加载</span></span><br><span class="line">    <span class="meta">@Column(nullable = false)</span> <span class="comment">// 映射为字段，值不能为空</span></span><br><span class="line">    <span class="keyword">private</span> String content;<span class="comment">//文章全文内容</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToOne(cascade=&#123;CascadeType.MERGE,CascadeType.REFRESH&#125;,optional=false)</span><span class="comment">//可选属性optional=false,表示author不能为空。删除文章，不影响用户</span></span><br><span class="line">    <span class="meta">@JoinColumn(name=&quot;author_id&quot;)</span><span class="comment">//设置在article表中的关联字段(外键)</span></span><br><span class="line">    <span class="keyword">private</span> Author author;<span class="comment">//所属作者</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行建表</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330511.png" alt="1691472823230"></p>
<p>article表中的外键</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330875.png" alt="1691474766684"></p>
<h3 id="2、接口-1"><a href="#2、接口-1" class="headerlink" title="2、接口"></a>2、接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthorRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Author</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">ArticleRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Article</span>,<span class="title">Long</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="3、测试-1"><a href="#3、测试-1" class="headerlink" title="3、测试"></a>3、测试</h3><p>注入</p>
<figure class="highlight less"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="variable">@Autowired</span></span><br><span class="line">AuthorRepository authorRepository;</span><br><span class="line"><span class="variable">@Autowired</span></span><br><span class="line">ArticleRepository articleRepository;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-新增-1"><a href="#3-1-新增-1" class="headerlink" title="3.1 新增"></a>3.1 新增</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一对多：新增</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToMany</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">//一个作者</span></span><br><span class="line">    Author author = <span class="keyword">new</span> Author();</span><br><span class="line">    author.setName(<span class="string">&quot;yagote&quot;</span>);</span><br><span class="line">    Author authorSave = authorRepository.save(author);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//两篇文章</span></span><br><span class="line">    Article article1 = <span class="keyword">new</span> Article();</span><br><span class="line">    article1.setTitle(<span class="string">&quot;标题一&quot;</span>);</span><br><span class="line">    article1.setContent(<span class="string">&quot;哈哈哈哈哈&quot;</span>);</span><br><span class="line">    article1.setAuthor(authorSave);</span><br><span class="line">    articleRepository.save(article1);</span><br><span class="line"></span><br><span class="line">    Article article2 = <span class="keyword">new</span> Article();</span><br><span class="line">    article2.setTitle(<span class="string">&quot;标题二&quot;</span>);</span><br><span class="line">    article2.setContent(<span class="string">&quot;嘻嘻嘻嘻嘻&quot;</span>);</span><br><span class="line">    article2.setAuthor(authorSave);</span><br><span class="line">    articleRepository.save(article2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> author (name) <span class="keyword">values</span> (?)</span><br><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> article (author_id, content, title) <span class="keyword">values</span> (?, ?, ?)</span><br><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> article (author_id, content, title) <span class="keyword">values</span> (?, ?, ?)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330672.png" alt="1691474832543"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302330976.png" alt="1691474854608"></p>
<h4 id="3-2-删除-1"><a href="#3-2-删除-1" class="headerlink" title="3.2 删除"></a>3.2 删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneToManyDel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    articleRepository.deleteById(<span class="number">2L</span>);	<span class="comment">//在多的一端进行操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select article<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">2</span>_<span class="number">0</span>_, article<span class="number">0</span>_.author_id as author_i<span class="number">4</span>_<span class="number">2</span>_<span class="number">0</span>_, article<span class="number">0</span>_.content as content<span class="number">2</span>_<span class="number">2</span>_<span class="number">0</span>_, article<span class="number">0</span>_.title as title<span class="number">3</span>_<span class="number">2</span>_<span class="number">0</span>_, author<span class="number">1</span>_.id as id<span class="number">1</span>_<span class="number">3</span>_<span class="number">1</span>_, author<span class="number">1</span>_.name as name<span class="number">2</span>_<span class="number">3</span>_<span class="number">1</span>_ from article article<span class="number">0</span>_ inner join author author<span class="number">1</span>_ <span class="literal">on</span> article<span class="number">0</span>_.author_id=author<span class="number">1</span>_.id where article<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: delete from article where id=?</span><br></pre></td></tr></table></figure>

<p>第二篇文章已被删除</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302331325.png" alt="1691475328025"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302331785.png" alt="1691475308689"></p>
<h4 id="3-3-查询"><a href="#3-3-查询" class="headerlink" title="3.3 查询"></a>3.3 查询</h4><p>可以使用Optional类进行封装。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//一对多：查询</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testOneTOManyQuery</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Optional&lt;Author&gt; byId = authorRepository.findById(<span class="number">1L</span>);</span><br><span class="line">    <span class="keyword">if</span>(byId.isPresent())&#123;	<span class="comment">//判断作者是否存在</span></span><br><span class="line">        Author author = byId.get();</span><br><span class="line">        List&lt;Article&gt; articleList = author.getArticleList();</span><br><span class="line">        System.out.println(articleList);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为设置了Author懒加载，所以不加注解，就会出现错误：<code>failed to lazily initialize a collection of role</code></p>
<p>懒加载<code>fetch=FetchType.LAZY</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@OneToMany(mappedBy = &quot;author&quot;,cascade=CascadeType.ALL,fetch=FetchType.LAZY)</span></span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332408.png" alt="1691475913638"></p>
<p>解决了这个问题，又出现了循环依赖导致栈溢出问题，在文章类上添加注解<code>@ToString(exclude = &#123;&quot;author&quot;&#125;)</code></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332968.png" alt="1691476579700"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332105.png" alt="1691476397237"></p>
<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select author<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">3</span>_<span class="number">0</span>_, author<span class="number">0</span>_.name as name<span class="number">2</span>_<span class="number">3</span>_<span class="number">0</span>_ from author author<span class="number">0</span>_ where author<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: select articlelis<span class="number">0</span>_.author_id as author_i<span class="number">4</span>_<span class="number">2</span>_<span class="number">0</span>_, articlelis<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">2</span>_<span class="number">0</span>_, articlelis<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">2</span>_<span class="number">1</span>_, articlelis<span class="number">0</span>_.author_id as author_i<span class="number">4</span>_<span class="number">2</span>_<span class="number">1</span>_, articlelis<span class="number">0</span>_.content as content<span class="number">2</span>_<span class="number">2</span>_<span class="number">1</span>_, articlelis<span class="number">0</span>_.title as title<span class="number">3</span>_<span class="number">2</span>_<span class="number">1</span>_ from article articlelis<span class="number">0</span>_ where articlelis<span class="number">0</span>_.author_id=?<span class="meta"></span></span><br><span class="line"><span class="meta">[Article(id=1, title=标题一, content=哈哈哈哈哈)]</span></span><br></pre></td></tr></table></figure>

<h2 id="九、多对多关系"><a href="#九、多对多关系" class="headerlink" title="九、多对多关系"></a>九、多对多关系</h2><p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332225.png" alt="1691481200648"></p>
<p>实体 Users：用户。</p>
<p>实体 Authority：权限。</p>
<p>用户和权限是多对多的关系。一个用户可以有多个权限，一个权限也可以被很多用户拥有。</p>
<p>JPA中使用**@ManyToMany<strong>来注解多对多的关系，由一个</strong>关联表<strong>来维护。这个关联表的表名默认是：主表名+下划线+从表名。(<strong>主表</strong>是指关系维护端对应的表，</strong>从表**指关系被维护端对应的表)。</p>
<p>这个关联表只有两个外键字段，分别指向主表ID和从表ID。字段的名称默认为：主表名+下划线+主表中的主键列名，从表名+下划线+从表中的主键列名。</p>
<p>需要注意的：</p>
<ul>
<li><p>多对多关系中一般不设置级联保存、级联删除、级联更新等操作。</p>
</li>
<li><p>可以随意指定一方为关系维护端，在这个例子中，我指定 Users 为关系维护端，<strong>所以生成的关联表名称为： users_authority</strong>，关联表的字段为：users_id 和 authority_id。</p>
</li>
<li><p>多对多关系的绑定由<strong>关系维护端</strong>来完成，即由 Users.setAuthories(authorities) 来绑定多对多的关系。关系被维护端不能绑定关系，即Authority不能绑定关系。</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">   <span class="comment">// ... 其他属性和方法</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">private</span> Set&lt;Authority&gt; authorities = <span class="keyword">new</span> HashSet&lt;&gt;();</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addAuthority</span><span class="params">(Authority authority)</span> </span>&#123;</span><br><span class="line">    authorities.add(authority);</span><br><span class="line">    setAuthorities(authorities); </span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthorities</span><span class="params">(Set&lt;Authority&gt; authorities)</span></span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.authorities = authorities;</span><br><span class="line">  &#125;</span><br><span class="line">    <span class="comment">//外部调用时,只需要Users.addAuthority(authority)即可</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>多对多关系的解除由<strong>关系维护端</strong>来完成，即由Users.getAuthorities().remove(authorities)来解除多对多的关系。关系被维护端不能解除关系，即Authority不能解除关系。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// ... 其他属性和方法</span></span><br><span class="line">    </span><br><span class="line">  <span class="keyword">private</span> Set&lt;Authority&gt; authorities ;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">removeAuthority</span><span class="params">(Authority authority)</span> </span>&#123;</span><br><span class="line">    Authorities authoritiesToRemove = getAuthorities();</span><br><span class="line">    authoritiesToRemove.remove(authority);</span><br><span class="line">    setAuthorities(authoritiesToRemove);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setAuthorities</span><span class="params">(Set&lt;Authority&gt; authorities)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.authorities = authorities;</span><br><span class="line">  &#125;</span><br><span class="line">	<span class="comment">//外部只需要调用 Users.removeAuthority(authority) 即可</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>如果 Users 和 Authority 已经绑定了多对多的关系，那么不能直接删除 Authority，需要由 Users 解除关系后，才能删除 Authority。但是可以直接删除 Users，因为 Users 是关系维护端，删除 Users 时，会先解除 Users 和 Authority 的关系，再删除 Authority。</p>
</li>
<li><p>维护端使用**@ManyToMany<strong>，被维护端使用*</strong>@ManyToMany*(mappedBy = “authorityList”)**</p>
</li>
</ul>
<h3 id="1、实体类-2"><a href="#1、实体类-2" class="headerlink" title="1、实体类"></a>1、实体类</h3><p>Users</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;users&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Users</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(nullable = false,length = 20,unique = true)</span>    <span class="comment">//字段不能为空，字段长度为20，字段唯一</span></span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(length = 100)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1、关系维护端，负责多对多关系的绑定和解除</span></span><br><span class="line">    <span class="comment">//2、@JoinTable注解的name属性指定关联表的名字，joinColumns指定外键的名字，关联到关系维护端(Users)</span></span><br><span class="line">    <span class="comment">//3、inverseJoinColumns指定外键的名字，要关联的关系被维护端(Authority)</span></span><br><span class="line">    <span class="comment">//4、其实可以不使用@JoinTable注解，默认生成的关联表名称为主表表名+下划线+从表表名，</span></span><br><span class="line">    <span class="comment">//即表名为users_authority</span></span><br><span class="line">    <span class="comment">//关联到主表的外键名：主表名+下划线+主表中的主键列名,即users_id</span></span><br><span class="line">    <span class="comment">//关联到从表的外键名：主表中用于关联的属性名+下划线+从表的主键列名,即authority_id</span></span><br><span class="line">    <span class="comment">//主表就是关系维护端对应的表，从表就是关系被维护端对应的表</span></span><br><span class="line">    <span class="meta">@ManyToMany</span> </span><br><span class="line">    <span class="meta">@JoinTable(name = &quot;users_authority&quot;,joinColumns = @JoinColumn(name = &quot;users_id&quot;),inverseJoinColumns = @JoinColumn(name = &quot;authority_id&quot;))</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Authority&gt; authorityList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>Authority</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@Entity</span></span><br><span class="line"><span class="meta">@Table(name = &quot;authority&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Authority</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="meta">@GeneratedValue(strategy = GenerationType.IDENTITY)</span></span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Column(nullable = false)</span></span><br><span class="line">    <span class="keyword">private</span> String name;    <span class="comment">//权限名</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@ManyToMany(mappedBy = &quot;authorityList&quot;)</span>  <span class="comment">//mappedBy属性指定了维护多对多关系的另一端的属性名称,authorityList是维护的端的属性名称</span></span><br><span class="line">    <span class="keyword">private</span> List&lt;Users&gt; usersList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行建表</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332499.png" alt="1691479693700"></p>
<p>关联表中的外键有两个</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302332318.png" alt="1691479810466"></p>
<h3 id="2、接口-2"><a href="#2、接口-2" class="headerlink" title="2、接口"></a>2、接口</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">AuthorityRepository</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Authority</span>, <span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UsersReposiory</span> <span class="keyword">extends</span> <span class="title">JpaRepository</span>&lt;<span class="title">Users</span>,<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h3 id="3、测试-2"><a href="#3、测试-2" class="headerlink" title="3、测试"></a>3、测试</h3><p>注入</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多对多：新增</span></span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> UsersReposiory usersReposiory;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> AuthorityRepository authorityRepository;</span><br></pre></td></tr></table></figure>

<h4 id="3-1-新增-2"><a href="#3-1-新增-2" class="headerlink" title="3.1 新增"></a>3.1 新增</h4><p>先运行 saveAuthority 添加一条权限记录，然后运行 saveUser 添加一条用户记录，与此同时，users_authority 表中也自动插入了一条记录。</p>
<p><strong>新增权限</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//测试添加权限</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToMany</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Authority authority = <span class="keyword">new</span> Authority();</span><br><span class="line">    authority.setId(<span class="number">1</span>);</span><br><span class="line">    authority.setName(<span class="string">&quot;评论权限&quot;</span>);</span><br><span class="line">    authorityRepository.save(authority);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select authority<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">4</span>_<span class="number">0</span>_, authority<span class="number">0</span>_.name as name<span class="number">2</span>_<span class="number">4</span>_<span class="number">0</span>_ from authority authority<span class="number">0</span>_ where authority<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: insert into authority (name) values (?)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333323.png" alt="1691480176119"></p>
<p><strong>新增users并设置权限</strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyToManyInsert</span><span class="params">()</span></span>&#123;</span><br><span class="line">    Users users = <span class="keyword">new</span> Users();</span><br><span class="line">    users.setUsername(<span class="string">&quot;yagote&quot;</span>);</span><br><span class="line">    users.setPassword(<span class="string">&quot;123&quot;</span>);</span><br><span class="line"></span><br><span class="line">    Authority authority = authorityRepository.findById(<span class="number">1</span>).get();	<span class="comment">//获取权限</span></span><br><span class="line">    List&lt;Authority&gt;  authorityList= <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    authorityList.add(authority);</span><br><span class="line">    users.setAuthorityList(authorityList);</span><br><span class="line">    usersRepository.save(users);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Hibernate: <span class="keyword">select</span> authority0_.id <span class="keyword">as</span> id1_4_0_, authority0_.name <span class="keyword">as</span> name2_4_0_ <span class="keyword">from</span> authority authority0_ <span class="keyword">where</span> authority0_.id=?</span><br><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> users (<span class="keyword">password</span>, username) <span class="keyword">values</span> (?, ?)</span><br><span class="line">Hibernate: <span class="keyword">insert</span> <span class="keyword">into</span> users_authority (users_id, authority_id) <span class="keyword">values</span> (?, ?)</span><br></pre></td></tr></table></figure>

<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333316.png" alt="1691480836066"></p>
<p>关联表中也有数据</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333094.png" alt="1691480859592"></p>
<h4 id="3-2-删除-2"><a href="#3-2-删除-2" class="headerlink" title="3.2 删除"></a>3.2 删除</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//多对多：删除用户</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testManyTOManyDel</span><span class="params">()</span></span>&#123;</span><br><span class="line">    usersRepository.deleteById(<span class="number">1</span>);	<span class="comment">//由关系维护端的表进行操作</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight apache"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attribute">Hibernate</span>: select users<span class="number">0</span>_.id as id<span class="number">1</span>_<span class="number">6</span>_<span class="number">0</span>_, users<span class="number">0</span>_.password as password<span class="number">2</span>_<span class="number">6</span>_<span class="number">0</span>_, users<span class="number">0</span>_.username as username<span class="number">3</span>_<span class="number">6</span>_<span class="number">0</span>_ from users users<span class="number">0</span>_ where users<span class="number">0</span>_.id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: delete from users_authority where users_id=?</span><br><span class="line"><span class="attribute">Hibernate</span>: delete from users where id=?</span><br></pre></td></tr></table></figure>

<p>users 表中删除一条记录，同时 users_authority 能够级联删除一条记录，被维护端的记录没被删除。</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302323689.png" alt="1691483527768"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333921.png" alt="1691483557095"></p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333673.png" alt="1691483575186"></p>
<blockquote>
<p>完成了，最终的目录结构</p>
<p><img src="https://raw.githubusercontent.com/yagote/blog-image/master/202309302333734.png" alt="1691483866702"></p>
</blockquote>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="http://yagote.github.io">虾壳</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://yagote.github.io/2023/08/08/spring-data-jpa/">http://yagote.github.io/2023/08/08/spring-data-jpa/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://yagote.github.io" target="_blank">虾壳</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/%E6%95%99%E7%A8%8B/">教程</a><a class="post-meta__tags" href="/tags/Java/">Java</a><a class="post-meta__tags" href="/tags/JPA/">JPA</a><a class="post-meta__tags" href="/tags/Spring-Data-JPA/">Spring Data JPA</a></div><div class="post_share"></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2023/08/12/linux-chang-yong-ming-ling/" title="Linux常用命令"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Linux常用命令</div></div></a></div><div class="next-post pull-right"><a href="/2023/08/06/spring-rong-qi-yuan-li/" title="Spring容器原理"><div class="cover" style="background: var(--default-bg-color)"></div><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Spring容器原理</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span>相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2023/08/01/jpa-he-mybatis/" title="JPA和MyBatis"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-01</div><div class="title">JPA和MyBatis</div></div></a></div><div><a href="/2023/08/12/git-jiao-cheng/" title="Git教程"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-08-12</div><div class="title">Git教程</div></div></a></div><div><a href="/2023/04/15/suan-fa-lian-xi-ha-xi-biao/" title="算法练习-哈希表"><div class="cover" style="background: var(--default-bg-color)"></div><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2023-04-15</div><div class="title">算法练习-哈希表</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content is-expand"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%9B%AE%E5%BD%95"><span class="toc-text">目录</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%80%E3%80%81ORM"><span class="toc-text">一、ORM</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFORM"><span class="toc-text">1、什么是ORM</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E5%B8%B8%E8%A7%81ORM%E6%A1%86%E6%9E%B6"><span class="toc-text">2、常见ORM框架</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8C%E3%80%81JPA"><span class="toc-text">二、JPA</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E4%BB%80%E4%B9%88%E6%98%AFJPA"><span class="toc-text">1、什么是JPA</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81JPA%E4%B8%8EHibernate%E7%9A%84%E5%85%B3%E7%B3%BB"><span class="toc-text">2、JPA与Hibernate的关系</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%89%E3%80%81JAP%E6%A1%88%E4%BE%8B"><span class="toc-text">三、JAP案例</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E6%96%B0%E5%BB%BA%E9%A1%B9%E7%9B%AE"><span class="toc-text">1、新建项目</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A1%A8"><span class="toc-text">2、访问数据库表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#2-1-%E5%88%9B%E5%BB%BA%E6%8E%A5%E5%8F%A3%E6%96%87%E4%BB%B6"><span class="toc-text">2.1 创建接口文件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-2-%E6%9F%A5%E6%89%BE"><span class="toc-text">2.2 查找</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-3-%E6%96%B0%E5%A2%9E"><span class="toc-text">2.3 新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-4-%E5%88%A0%E9%99%A4"><span class="toc-text">2.4 删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-5-%E5%88%86%E9%A1%B5%E6%9F%A5%E8%AF%A2"><span class="toc-text">2.5 分页查询</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-6-%E5%85%B6%E4%BB%96%E8%87%AA%E5%B8%A6%E6%96%B9%E6%B3%95"><span class="toc-text">2.6 其他自带方法</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E3%80%81%E6%96%B9%E6%B3%95%E5%91%BD%E5%90%8D%E8%A7%84%E5%88%99%E6%9F%A5%E8%AF%A2"><span class="toc-text">四、方法命名规则查询</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%94%E3%80%81%E4%BD%BF%E7%94%A8JPQL%E7%9A%84%E6%96%B9%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="toc-text">五、使用JPQL的方式查询</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E7%AE%80%E5%8D%95%E6%9F%A5%E8%AF%A2"><span class="toc-text">1、简单查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E7%AD%9B%E9%80%89%E6%9D%A1%E4%BB%B6"><span class="toc-text">2、筛选条件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%8A%95%E5%BD%B1%E7%BB%93%E6%9E%9C"><span class="toc-text">3、投影结果</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4%E3%80%81%E8%81%9A%E5%90%88%E6%9F%A5%E8%AF%A2"><span class="toc-text">4、聚合查询</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#5%E3%80%81%E4%BC%A0%E5%8F%82"><span class="toc-text">5、传参</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AD%E3%80%81%E4%BD%BF%E7%94%A8%E5%8E%9F%E7%94%9FSQL"><span class="toc-text">六、使用原生SQL</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%83%E3%80%81%E4%B8%80%E5%AF%B9%E4%B8%80%E5%85%B3%E7%B3%BB"><span class="toc-text">七、一对一关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E4%BD%93%E7%B1%BB"><span class="toc-text">1、实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%A3"><span class="toc-text">2、接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95"><span class="toc-text">3、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%96%B0%E5%A2%9E"><span class="toc-text">3.1 新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4"><span class="toc-text">3.2 删除</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%AB%E3%80%81%E4%B8%80%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-text">八、一对多关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E4%BD%93%E7%B1%BB-1"><span class="toc-text">1、实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%A3-1"><span class="toc-text">2、接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95-1"><span class="toc-text">3、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%96%B0%E5%A2%9E-1"><span class="toc-text">3.1 新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4-1"><span class="toc-text">3.2 删除</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-3-%E6%9F%A5%E8%AF%A2"><span class="toc-text">3.3 查询</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B9%9D%E3%80%81%E5%A4%9A%E5%AF%B9%E5%A4%9A%E5%85%B3%E7%B3%BB"><span class="toc-text">九、多对多关系</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%E3%80%81%E5%AE%9E%E4%BD%93%E7%B1%BB-2"><span class="toc-text">1、实体类</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%E3%80%81%E6%8E%A5%E5%8F%A3-2"><span class="toc-text">2、接口</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3%E3%80%81%E6%B5%8B%E8%AF%95-2"><span class="toc-text">3、测试</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#3-1-%E6%96%B0%E5%A2%9E-2"><span class="toc-text">3.1 新增</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-2-%E5%88%A0%E9%99%A4-2"><span class="toc-text">3.2 删除</span></a></li></ol></li></ol></li></ol></div></div></div></div></main><footer id="footer" style="background: black"><div id="footer-wrap"><div class="footer_custom_text">Copyright © 2021 - 2023 <a href="https://yagote.github.io/">虾壳</a></div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>